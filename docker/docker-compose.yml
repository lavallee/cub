# Docker Compose for Cub Sandbox Testing
#
# Usage:
#   cd docker
#   docker compose build
#   docker compose run --rm cub cub status
#
# For interactive shell:
#   docker compose run --rm cub bash

services:
  cub:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: cub:latest
    container_name: cub-sandbox
    volumes:
      # Mount current project as workspace
      - ..:/workspace:rw
      # Persist cub logs across runs (optional)
      - cub-logs:/home/cub/.local/share/cub
    working_dir: /workspace
    # Resource limits for safety
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 4G
    # Security hardening
    security_opt:
      - no-new-privileges:true
    # Network isolation (optional, uncomment for full isolation)
    # network_mode: none
    environment:
      - TERM=xterm-256color
      # Pass through API keys if needed
      - ANTHROPIC_API_KEY
      - OPENAI_API_KEY
    stdin_open: true
    tty: true

volumes:
  cub-logs:
