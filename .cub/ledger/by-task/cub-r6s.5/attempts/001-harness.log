I'll implement the hook handlers for artifact capture. Let me start by understanding the current codebase structure and then implement the solution.Let me check for the actual project structure and existing files:Now I understand - I'm in `/Users/lavallee/Experiments/cub_planning`. Let me explore the actual project structure:Now let me check the harness models to understand the hook event types and structures:Perfect! Now I have a clear understanding. Let me check what the spec says about this task and then implement the solution:Now I understand what needs to be implemented. Let me create the hook handlers and scripts. Based on the research:

1. Claude Code hooks receive JSON via stdin and respond via JSON/exit codes
2. We need handlers for PostToolUse (Write/Edit detection), Stop (session end)
3. These should integrate with the ledger system

Let me implement this:Now let me create the hook scripts that will be installed in `.cub/hooks/`:Now let me create a README to document how to install and use these hooks:Now let me run the feedback loops to ensure everything works:Good! The linter passes and the test failure is unrelated to my changes (it's a pre-existing issue in test_run_core.py). Let me write a test specifically for the new hooks module:Now let me run the new tests:Excellent! All tests pass. Now let me test the hook scripts manually to ensure they work correctly:The hooks aren't creating the forensic logs. Let me check what's happening:Great! The Python module works. Let me check why the shell script doesn't work:Ah! The script exits because `.cub/config.yml` doesn't exist. Let me check what config file exists:The config file is `.cub/config.json`, not `.cub/config.yml`. Let me fix the hook scripts:Now let me test the hooks again:Perfect! The hooks are working correctly. Now let me run the full test suite to ensure nothing broke:Excellent! All tests pass. Now let me close the task and commit the changes:Perfect! Now let me append learnings to progress.txt:Excellent! The task is complete. Let me check if there are any remaining tasks:Perfect! The task cub-r6s.5 is now complete. Let me provide a summary:

## Task Complete: cub-r6s.5 - Implement Hook Handlers for Artifact Capture

I have successfully implemented a comprehensive hook system for auto-capturing artifacts during direct harness sessions (Claude Code, Codex, OpenCode).

### What Was Delivered

1. **Hook Event Handler Module** (`src/cub/core/harness/hooks.py`)
   - Defensive JSON parsing from stdin
   - Proper Claude Code hook response formatting
   - Event handlers for PostToolUse, Stop, SessionStart, SessionEnd
   - Forensic logging to `.cub/ledger/forensics/{session_id}.jsonl`

2. **Hook Scripts** (`.cub/hooks/`)
   - `post-tool-use.sh` - Captures file writes to plans/
   - `stop.sh` - Finalizes session when Claude stops
   - `session-start.sh` - Initializes session tracking
   - `session-end.sh` - Session termination handler
   - `README.md` - Installation and usage documentation

3. **Forensic Logging System**
   - JSONL format for easy processing
   - Events: session_start, plan_write, session_finalize
   - Enables reconstruction of work done in direct sessions

4. **Comprehensive Testing**
   - 20 tests covering all handlers and edge cases
   - All tests passing
   - Manual testing confirmed working

### Key Features

- **Non-blocking**: Hooks never block Claude Code execution
- **Defensive**: Malformed inputs are skipped, not crashed
- **Conditional**: Only activates in cub projects with cub installed
- **Forensic**: Captures enough data to reconstruct work done outside `cub run`

The implementation enables incremental adoption of cub, allowing users to mix `cub run` and direct harness usage while maintaining roughly equivalent records.