I'll implement the InstructionGenerator to generate CLAUDE.md and AGENTS.md files with workflow instructions. Let me start by understanding the current codebase structure and then implement the solution.Now let me read the key files to understand the existing patterns and the escape hatch language:Now let me check existing test patterns and look at examples from the codebase:Let me check for test patterns and see what AGENTS.md and CLAUDE.md currently look like:Let me look at a couple of test files to understand the testing pattern:Perfect! Now I have all the context I need. Let me implement the InstructionGenerator module. I'll create the implementation and tests based on the patterns I've seen in the codebase.Now let me create comprehensive tests for the instruction generator:Now let's run the tests to make sure everything works:Perfect! All tests pass. Now let's run the type checker to make sure there are no type issues:The mypy error is unrelated to our code (it's in another module). Let's check our module specifically with the strict flag:Excellent! Let's also run the linter:Let's fix these linting issues. The long lines are in the escape hatch section which is a multi-line string, so we need to break them up. Also need to remove the unused pytest import:Now let's run the linter again:Perfect! Let's also format the code to make sure it's consistent:Great! Now let's run all the tests again to make sure everything still works after formatting:Excellent! All tests pass. Now let's run a broader test suite to make sure we didn't break anything:Great! Tests are passing. Now let's close the task and commit our changes:Now let's commit the changes:Perfect! Now let's append our learnings to progress.txt:Perfect! Let's verify the progress was written and commit it:Excellent! Now let's commit the progress file:Perfect! Task completed successfully. Let me create a summary of what was accomplished:

## Summary

I successfully implemented the **InstructionGenerator** module for task `cub-r6s.2`. Here's what was delivered:

### Files Created
1. **src/cub/core/instructions.py** - Core implementation with:
   - `generate_agents_md()` - Creates harness-agnostic workflow instructions (AGENTS.md)
   - `generate_claude_md()` - Creates Claude Code-specific instructions (CLAUDE.md)
   - `ESCAPE_HATCH_SECTION` - Reusable escape hatch language from E5 spec

2. **tests/test_instructions.py** - Comprehensive test suite with 25 tests covering:
   - Content validation
   - Configuration integration
   - Integration scenarios
   - Cross-file consistency

### Key Features
- **Harness-agnostic design**: AGENTS.md works with Claude Code, Codex, OpenCode, etc.
- **Configuration-aware**: Reads `circuit_breaker.timeout_minutes` from CubConfig
- **Complete workflow guidance**: Finding tasks (`bd ready`), claiming work (`bd update`), completing tasks (`bd close`), logging sessions (`cub log`)
- **Escape hatch integration**: Includes E5 escape hatch language for signaling when stuck
- **Plan mode support**: CLAUDE.md includes specific guidance for saving plans to `plans/` directory

### Quality Metrics
- ✅ All 25 tests passing
- ✅ mypy type checking clean
- ✅ ruff linting passed
- ✅ Code formatted with ruff
- ✅ Task closed in beads
- ✅ Changes committed with conventional commit format
- ✅ Learnings documented in @progress.txt

The implementation is complete and ready for integration with the `cub init` command in the next task.