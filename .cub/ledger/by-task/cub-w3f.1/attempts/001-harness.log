I'll implement the shell hook filter script according to the specifications. Let me start by understanding the project structure and then implement the solution.Let me check the existing templates directory structure and understand the project better.Now let me check the scripts directory and look at examples of hook-related code:Let me check the hooks.py file to understand the Python handler and the architecture:Perfect! Now I have a complete understanding. Let me check the plan for this specific task:Perfect! Now I understand the task completely. Let me create the shell hook filter script. First, let me check if there are any existing examples to follow patterns from:Good! Now I have enough context. Let me create the shell hook filter script according to the specifications:Now let me create comprehensive tests for the hook filter script:Now let me make the script executable and run the tests:Excellent! All 36 tests pass. Now let's run the full feedback loop to make sure everything is working correctly:Good! The mypy errors are pre-existing (in other files). Let me verify the shell script doesn't have any syntax errors and test it manually:Perfect! The shell script is working correctly. Now let me run the broader test suite to make sure I haven't broken anything:Excellent! All tests pass. Now let me close the task and commit the changes:I notice the file is in the wrong location (templates/ instead of src/cub/templates/). Let me check:The git status output is misleading - it's showing templates/scripts/ but the actual file is in src/cub/templates/scripts/. Let me commit the changes:I see - there's a symlink issue. Let me investigate:Ah! So `src/cub/templates` is a symlink to `../../templates` (which is the project root `templates/` directory). So the file was actually created in the right place. Let me commit it properly:Perfect! Now let me update the progress.txt file with learnings from this task:Now let me commit the progress update and verify the task is complete:Perfect! The task is closed successfully. Let me create a final summary:

## Summary

I successfully completed task **cub-w3f.1: Implement shell hook filter script**.

### What was implemented:

1. **Fast-path shell filter** (`templates/scripts/cub-hook.sh`):
   - Bash script that acts as entry point for Claude Code hooks
   - Performs quick relevance checks before invoking Python
   - Keeps latency under 50ms by filtering out 90%+ of irrelevant events
   - 165 lines with comprehensive error handling

2. **Key features**:
   - **Double-tracking prevention**: Exits immediately if `CUB_RUN_ACTIVE` is set
   - **Tool filtering**: Only processes Write/Edit/NotebookEdit/Bash tools
   - **Path filtering**: Tracks plans/, specs/, captures/, src/, .cub/ directories
   - **Command pattern matching**: Detects cub, git commit, git add commands
   - **Session lifecycle**: Always passes through SessionStart/Stop/PreCompact/UserPromptSubmit
   - **Graceful degradation**: Handles malformed JSON and missing fields
   - **jq fallback**: Works with or without jq using grep/sed

3. **Comprehensive test suite** (`tests/test_hook_filter.py`):
   - 36 tests organized into 9 test classes
   - Covers all filtering scenarios, edge cases, and error conditions
   - Tests both jq and fallback parsing paths
   - All tests passing

### Test Results:
- ✅ All 36 new hook filter tests pass
- ✅ All 3941 existing tests still pass (3977 total)
- ✅ Bash syntax validation passes
- ✅ Manual smoke tests confirm correct behavior
- ✅ Ruff linting passes

### Files Created:
- `templates/scripts/cub-hook.sh` (165 lines, executable)
- `tests/test_hook_filter.py` (340 lines, 36 tests)

The implementation follows all acceptance criteria from the task specification and is ready for the next phase of hook integration.