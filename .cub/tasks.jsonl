{"id": "cub-b1a", "title": "bare-cub #1: Core Run Extraction", "status": "closed", "priority": "P0", "issue_type": "epic", "description": "Extract ~2500 lines of business logic from `cli/run.py` into a new `core/run/` package. This is the highest-risk, highest-impact phase — it establishes the pattern that every subsequent phase follows. All existing tests must continue passing after each extraction step.", "assignee": null, "labels": ["phase-1", "core", "refactor", "risk:high"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.407838", "updated_at": "2026-01-28T18:57:22.732005", "closed_at": "2026-01-28T18:57:22.732002", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T18:57:22.732007] All tasks completed", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 0}
{"id": "cub-b1b", "title": "bare-cub #2: Rich Boundary Cleanup", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Remove all Rich imports from `cub.core` modules. Core returns structured data; CLI renders it. This establishes the architectural rule that enables non-CLI interfaces.", "assignee": null, "labels": ["phase-2", "core", "refactor", "cleanup"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.407983", "updated_at": "2026-01-28T19:20:21.672421", "closed_at": "2026-01-28T19:20:21.672417", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T19:20:21.672422] All tasks completed", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1c", "title": "bare-cub #3: Service Layer", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Introduce `cub.core.services` as the public API surface. Services are thin orchestrators that compose domain operations. CLI modules are refactored to call services.", "assignee": null, "labels": ["phase-3", "core", "architecture"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.408044", "updated_at": "2026-01-28T19:59:09.455587", "closed_at": "2026-01-28T19:59:09.455581", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T19:59:09.455589] All tasks completed", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1d", "title": "bare-cub #4: Suggestion Engine", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Build the smart recommendation system that analyzes project state and produces ranked, opinionated suggestions for what to do next.", "assignee": null, "labels": ["phase-4", "core", "feature"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.408089", "updated_at": "2026-01-28T20:22:42.124609", "closed_at": "2026-01-28T20:22:42.124605", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T20:22:42.124610] All tasks completed", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1e", "title": "bare-cub #5: Bare Cub Command", "status": "closed", "priority": "P0", "issue_type": "epic", "description": "Implement the default command handler — the user-facing deliverable. When someone types `cub` with no subcommand, it launches the default harness with an opinionated welcome.", "assignee": null, "labels": ["phase-5", "cli", "feature"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.408186", "updated_at": "2026-01-28T20:46:13.750875", "closed_at": "2026-01-28T20:46:13.750871", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T20:46:13.750876] All tasks completed", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 0}
{"id": "cub-b1f", "title": "bare-cub #6: Skill Discovery & Documentation", "status": "open", "priority": "P2", "issue_type": "epic", "description": "Make cub capabilities discoverable from within a harness session and document the new architecture.", "assignee": null, "labels": ["phase-6", "docs", "feature"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.408236", "updated_at": "2026-01-28T17:54:44.408236", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2}
{"id": "cub-b1a.1", "title": "Create core/run package with prompt builder extraction", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The prompt builder (system prompt generation, task context injection, AGENT.md reading) is the most self-contained piece of `cli/run.py` and the safest to extract first. It establishes the `core/run/` package structure.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/__init__.py` package\n2. Create `src/cub/core/run/prompt_builder.py` — extract `generate_system_prompt()`, `_build_task_context()`, `_read_agent_md()`, and related functions from `cli/run.py`\n3. Define `PromptConfig` and `TaskPrompt` data models for inputs/outputs\n4. Update `cli/run.py` to import from `core/run/prompt_builder` instead of using local functions\n5. Ensure all existing run tests pass unchanged\n6. Add unit tests for prompt builder in isolation\n\n**Files:** src/cub/core/run/__init__.py, src/cub/core/run/prompt_builder.py, src/cub/cli/run.py, tests/test_run_prompt_builder.py", "assignee": "cub-20260128-175601", "labels": ["phase-1", "core", "refactor", "model:opus", "complexity:high", "blocking"], "dependsOn": [], "blocks": ["cub-b1a.2", "cub-b1a.3", "cub-b1a.4", "cub-b1a.5"], "parent": "cub-b1a", "created_at": "2026-01-28T17:54:46.169146", "updated_at": "2026-01-28T18:04:02.242112", "closed_at": "2026-01-28T18:04:02.242086", "acceptanceCriteria": ["`core/run/prompt_builder.py` exists with all prompt generation logic", "`cli/run.py` calls prompt builder from core, no local prompt logic remains", "`pytest tests/` passes with no regressions", "`mypy src/cub` passes clean", "No Rich imports in `core/run/`"], "notes": "[Closed: 2026-01-28T18:04:02.242114] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0}
{"id": "cub-b1a.2", "title": "Extract budget tracking to core/run/budget.py", "status": "closed", "priority": "P0", "issue_type": "task", "description": "Budget tracking (token counting, cost accounting, limit enforcement) is business logic embedded in the run loop. It needs to be accessible to any interface that runs tasks.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/budget.py` with `BudgetManager` class\n2. Extract token tracking, cost accumulation, and limit checking from `cli/run.py`\n3. Define `BudgetConfig` (limits) and `BudgetState` (current usage) models\n4. Add `check_limit()` method that returns whether to continue or stop\n5. Update `cli/run.py` to use `BudgetManager` instead of inline tracking\n6. Write tests for budget limit enforcement\n\n**Files:** src/cub/core/run/budget.py, src/cub/cli/run.py, tests/test_run_budget.py", "assignee": "cub-20260128-175601", "labels": ["phase-1", "core", "refactor", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1a", "created_at": "2026-01-28T17:54:46.169250", "updated_at": "2026-01-28T18:09:17.082589", "closed_at": "2026-01-28T18:09:17.082585", "acceptanceCriteria": ["`BudgetManager` handles all token/cost tracking", "Budget limits trigger clean stops with clear reasons", "`cli/run.py` has no inline budget math", "Tests cover: under budget, at budget, over budget, no budget set"], "notes": "[Closed: 2026-01-28T18:09:17.082592] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-b1a.3", "title": "Extract loop state machine to core/run/loop.py", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The run loop state machine (pick task → execute → record → next) is the core of cub. Extracting it cleanly is the hardest part of this phase — it touches task selection, harness invocation, result recording, and error handling.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/loop.py` with `RunLoop` class\n2. Define `RunConfig` model (all loop configuration: once, epic, harness, etc.)\n3. Define `RunEvent` enum/model for loop events (task_start, task_end, budget_update, error, complete)\n4. Implement `execute()` as a generator that yields `RunEvent` objects\n5. Move task selection, harness invocation coordination, and result recording into `RunLoop`\n6. Keep signal handling and Rich rendering in `cli/run.py`\n7. `cli/run.py` becomes: parse args → create `RunConfig` → iterate `RunLoop.execute()` → render events\n\n**Files:** src/cub/core/run/loop.py, src/cub/core/run/models.py, src/cub/cli/run.py, tests/test_run_loop.py", "assignee": "cub-20260128-183943", "labels": ["phase-1", "core", "refactor", "model:opus", "complexity:high", "risk:high"], "dependsOn": [], "blocks": [], "parent": "cub-b1a", "created_at": "2026-01-28T17:54:46.169288", "updated_at": "2026-01-28T18:41:42.743657", "closed_at": "2026-01-28T18:41:42.743618", "acceptanceCriteria": ["`RunLoop.execute()` yields `RunEvent` stream, no print/console output", "`cli/run.py` reduced to <500 lines (arg parsing + event rendering)", "`cub run --once` works end-to-end through the new architecture", "`cub run` (multi-task) works end-to-end", "All existing run tests pass", "`mypy` passes clean"], "notes": "[Closed: 2026-01-28T18:41:42.743661] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0}
{"id": "cub-b1a.4", "title": "Extract interrupt handling to core/run/interrupt.py", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Signal handling (SIGINT/SIGTERM) for clean shutdown needs to work regardless of which interface is driving the run loop. The interrupt handler should coordinate with the loop state machine.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/interrupt.py` with `InterruptHandler` class\n2. Extract signal registration and `_interrupted` flag logic from `cli/run.py`\n3. Implement cooperative interruption: handler sets flag, loop checks flag between tasks\n4. Add `on_interrupt` callback for cleanup (artifact finalization, ledger entry)\n5. Update `RunLoop` to check interrupt state between iterations\n\n**Files:** src/cub/core/run/interrupt.py, src/cub/core/run/loop.py, src/cub/cli/run.py, tests/test_run_interrupt.py", "assignee": "cub-20260128-183943", "labels": ["phase-1", "core", "refactor", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1a", "created_at": "2026-01-28T17:54:46.169329", "updated_at": "2026-01-28T18:47:30.640522", "closed_at": "2026-01-28T18:47:30.640516", "acceptanceCriteria": ["`InterruptHandler` manages SIGINT/SIGTERM registration", "Interrupts cause clean shutdown between tasks (not mid-task)", "Artifacts and ledger entries are finalized on interrupt", "Works when called from CLI or programmatically"], "notes": "[Closed: 2026-01-28T18:47:30.640526] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1a.5", "title": "Extract git operations to core/run/git_ops.py", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Branch creation, commit tracking, and other git operations during `cub run` are business logic that should be accessible from any interface.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/git_ops.py` with run-specific git functions\n2. Extract `_create_branch_from_base()`, `_get_gh_issue_title()`, `_get_epic_title()` from `cli/run.py`\n3. Define clear interfaces: `create_run_branch(config) -> str`, `get_epic_context(epic_id) -> EpicContext`\n4. Update `RunLoop` to call git_ops functions instead of inline logic\n5. Write tests with mocked git operations\n\n**Files:** src/cub/core/run/git_ops.py, src/cub/cli/run.py, tests/test_run_git_ops.py", "assignee": "cub-20260128-183943", "labels": ["phase-1", "core", "refactor", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1a", "created_at": "2026-01-28T17:54:46.169369", "updated_at": "2026-01-28T18:57:10.834668", "closed_at": "2026-01-28T18:57:10.834664", "acceptanceCriteria": ["All git operations during run extracted to `core/run/git_ops.py`", "No git subprocess calls remain in `cli/run.py`", "Branch naming convention preserved", "Tests cover branch creation, epic title resolution"], "notes": "[Closed: 2026-01-28T18:57:10.834670] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1b.1", "title": "Move review reporter rendering to CLI layer", "status": "closed", "priority": "P1", "issue_type": "task", "description": "`core/review/reporter.py` is the heaviest Rich violator — it's ~90% Rich rendering. The data models already exist in `core/review/models.py`. We need to split data preparation from rendering.\n\n**Implementation Steps:**\n1. Audit `core/review/reporter.py` to identify data preparation vs rendering\n2. Keep any data transformation logic in core; move to `core/review/formatter.py` if needed (returns structured data)\n3. Create `cli/review/display.py` with all Rich rendering (Panel, Table, Text)\n4. Update `cli/review.py` to call display functions instead of core reporter\n5. Remove Rich imports from `core/review/reporter.py` (or delete if fully moved)\n6. Update tests to verify data output, not rendered output\n\n**Files:** src/cub/core/review/reporter.py, src/cub/cli/review/display.py, src/cub/cli/review.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": ["cub-b1b.5"], "parent": "cub-b1b", "created_at": "2026-01-28T17:54:46.169408", "updated_at": "2026-01-28T19:02:20.690087", "closed_at": "2026-01-28T19:02:20.690062", "acceptanceCriteria": ["Zero Rich imports in `core/review/`", "`cli/review/display.py` handles all review rendering", "`cub review` command output unchanged from user's perspective", "Tests pass"], "notes": "[Closed: 2026-01-28T19:02:20.690089] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1b.2", "title": "Remove Rich from core/pr/service.py and core/worktree/parallel.py", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Both modules use Rich Console for progress/status output. They should emit events or return data, letting the CLI layer handle display.\n\n**Implementation Steps:**\n1. In `core/pr/service.py`: replace `Console` usage with return values or Python logging\n2. In `core/worktree/parallel.py`: replace progress output with callback/event pattern\n3. Define callback protocols: `on_worker_start(task_id)`, `on_worker_complete(task_id, result)`\n4. Update `cli/pr.py` and `cli/worktree.py` to provide Rich-based callbacks\n5. Verify all PR and worktree commands work unchanged\n\n**Files:** src/cub/core/pr/service.py, src/cub/core/worktree/parallel.py, src/cub/cli/pr.py, src/cub/cli/worktree.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": ["cub-b1b.5"], "parent": "cub-b1b", "created_at": "2026-01-28T17:54:46.169430", "updated_at": "2026-01-28T19:12:49.833208", "closed_at": "2026-01-28T19:12:49.833201", "acceptanceCriteria": ["Zero Rich imports in `core/pr/` and `core/worktree/`", "PR and worktree commands produce identical output", "Core modules use callbacks or return data for progress"], "notes": "[Closed: 2026-01-28T19:12:49.833211] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1b.3", "title": "Move bash_delegate to CLI layer", "status": "closed", "priority": "P1", "issue_type": "task", "description": "`core/bash_delegate.py` imports Rich Console and calls `sys.exit()`. It's purely a CLI concern — delegating commands to the bash version of cub.\n\n**Implementation Steps:**\n1. Move `core/bash_delegate.py` to `cli/delegated/runner.py`\n2. Update imports in `cli/delegated.py` and `cli/__init__.py`\n3. Remove `core/bash_delegate.py`\n4. Verify delegated commands (prep, branch, etc.) still work\n\n**Files:** src/cub/core/bash_delegate.py, src/cub/cli/delegated/runner.py, src/cub/cli/delegated.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:sonnet", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-b1b", "created_at": "2026-01-28T17:54:46.169447", "updated_at": "2026-01-28T19:16:59.892654", "closed_at": "2026-01-28T19:16:59.892650", "acceptanceCriteria": ["`core/bash_delegate.py` no longer exists", "Delegated commands work unchanged", "No Rich or sys.exit in any `core/` module"], "notes": "[Closed: 2026-01-28T19:16:59.892655] Completed by autonomous execution", "complexity_label": "low", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1b.4", "title": "Replace Rich logging in core/harness/hooks.py", "status": "closed", "priority": "P1", "issue_type": "task", "description": "`core/harness/hooks.py` uses Rich for logging. It should use Python's standard `logging` module — hooks run in subprocess contexts where Rich may not be appropriate.\n\n**Implementation Steps:**\n1. Replace `from rich.console import Console` with `import logging`\n2. Replace `console.print()` calls with `logger.info()`, `logger.debug()`, etc.\n3. Configure logging format in hook entry point\n4. Verify hook forensics still work correctly\n\n**Files:** src/cub/core/harness/hooks.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-b1b", "created_at": "2026-01-28T17:54:46.169467", "updated_at": "2026-01-28T19:18:27.819752", "closed_at": "2026-01-28T19:18:27.819748", "acceptanceCriteria": ["Zero Rich imports in `core/harness/hooks.py`", "Hook logging works in subprocess contexts", "Forensics JSONL output unchanged"], "notes": "[Closed: 2026-01-28T19:18:27.819754] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1b.5", "title": "Verify zero Rich imports in core and add CI gate", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Final verification that the boundary is clean, plus a CI check to prevent regression.\n\n**Implementation Steps:**\n1. Run `grep -r \"from rich\" src/cub/core/` and verify zero results\n2. Run `grep -r \"import rich\" src/cub/core/` and verify zero results\n3. Add a test that programmatically checks no Rich imports in core\n4. Verify `mypy src/cub` passes clean\n\n**Files:** tests/test_architecture.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-b1b", "created_at": "2026-01-28T17:54:46.169492", "updated_at": "2026-01-28T19:20:10.863075", "closed_at": "2026-01-28T19:20:10.863070", "acceptanceCriteria": ["`grep -r \"from rich\\|import rich\" src/cub/core/` returns nothing", "Automated test enforces the boundary", "All commands work unchanged from user's perspective"], "notes": "[Closed: 2026-01-28T19:20:10.863078] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1c.1", "title": "Create service layer foundation and RunService", "status": "closed", "priority": "P1", "issue_type": "task", "description": "RunService wraps the newly-extracted `core/run/` package, providing the clean API that CLI and future interfaces call. This establishes the service layer pattern.\n\n**Implementation Steps:**\n1. Create `src/cub/core/services/__init__.py` package\n2. Create `src/cub/core/services/run.py` with `RunService` class\n3. `RunService.from_config(config)` factory method\n4. `RunService.execute(run_config) -> Iterator[RunEvent]` delegates to `core/run/loop.py`\n5. `RunService.run_once(task_id) -> RunResult` convenience method\n6. Refactor `cli/run.py` to use `RunService` instead of calling `core/run/` directly\n7. Write service-level integration tests\n\n**Files:** src/cub/core/services/__init__.py, src/cub/core/services/run.py, src/cub/cli/run.py, tests/test_service_run.py", "assignee": "cub-20260128-192025", "labels": ["phase-3", "core", "architecture", "model:opus", "complexity:high", "blocking"], "dependsOn": [], "blocks": ["cub-b1c.2", "cub-b1c.3", "cub-b1c.4"], "parent": "cub-b1c", "created_at": "2026-01-28T17:54:46.169509", "updated_at": "2026-01-28T19:30:32.960816", "closed_at": "2026-01-28T19:30:32.960778", "acceptanceCriteria": ["`RunService` provides the complete API for task execution", "`cli/run.py` only calls `RunService`, not domain modules directly", "Service is stateless — configuration passed in, no globals", "Tests verify service orchestration"], "notes": "[Closed: 2026-01-28T19:30:32.960820] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1c.2", "title": "Create StatusService and LedgerService", "status": "closed", "priority": "P1", "issue_type": "task", "description": "StatusService aggregates project state from multiple sources. LedgerService wraps ledger reader/writer. Both are needed by the suggestion engine.\n\n**Implementation Steps:**\n1. Create `src/cub/core/services/status.py` with `StatusService`\n2. `summary() -> ProjectStats` — aggregate from tasks, ledger, git\n3. `progress(epic_id) -> EpicProgress` — epic-level progress\n4. Create `src/cub/core/services/ledger.py` with `LedgerService`\n5. `query(filters) -> list[LedgerEntry]`, `recent(n) -> list[LedgerEntry]`, `stats(period) -> LedgerStats`\n6. Define `ProjectStats`, `EpicProgress`, `LedgerStats` models\n7. Refactor `cli/status.py` and `cli/ledger.py` to use services\n\n**Files:** src/cub/core/services/status.py, src/cub/core/services/ledger.py, src/cub/core/services/models.py, src/cub/cli/status.py, src/cub/cli/ledger.py", "assignee": "cub-20260128-192025", "labels": ["phase-3", "core", "architecture", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1c", "created_at": "2026-01-28T17:54:46.169529", "updated_at": "2026-01-28T19:43:16.990826", "closed_at": "2026-01-28T19:43:16.990819", "acceptanceCriteria": ["`StatusService.summary()` returns structured project stats", "`LedgerService` wraps all ledger operations", "`cub status` and `cub ledger` commands work via services", "Models are Pydantic, serializable"], "notes": "[Closed: 2026-01-28T19:43:16.990832] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1c.3", "title": "Create LaunchService for environment detection and harness launch", "status": "closed", "priority": "P1", "issue_type": "task", "description": "LaunchService handles the core logic for bare `cub`: detect environment, determine if nested, launch harness with context. This is the service that `cli/default.py` will call.\n\n**Implementation Steps:**\n1. Create `src/cub/core/launch/__init__.py` package\n2. Create `src/cub/core/launch/detector.py` with `detect_environment() -> EnvironmentInfo`\n3. Check `CUB_SESSION_ACTIVE`, `CLAUDE_CODE`, `CLAUDE_PROJECT_DIR` env vars\n4. Create `src/cub/core/launch/launcher.py` with `launch_harness(config, context)`\n5. Implement harness binary resolution, flag assembly, `exec` call\n6. Create `src/cub/core/launch/models.py` with `EnvironmentInfo`, `LaunchConfig`\n7. Create `src/cub/core/services/launch.py` with `LaunchService` wrapper\n8. Write tests with mocked environment variables\n\n**Files:** src/cub/core/launch/detector.py, src/cub/core/launch/launcher.py, src/cub/core/launch/models.py, src/cub/core/services/launch.py, tests/test_launch.py", "assignee": "cub-20260128-192025", "labels": ["phase-3", "core", "architecture", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1c", "created_at": "2026-01-28T17:54:46.169545", "updated_at": "2026-01-28T19:49:58.382182", "closed_at": "2026-01-28T19:49:58.382177", "acceptanceCriteria": ["`detect_environment()` correctly identifies terminal, harness, and nested contexts", "`launch_harness()` assembles correct `claude` CLI invocation", "`--resume` and `--continue` flags pass through correctly", "`CUB_SESSION_ACTIVE` and `CUB_SESSION_ID` set in child environment", "Tests cover all three environment contexts"], "notes": "[Closed: 2026-01-28T19:49:58.382184] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1c.4", "title": "Enhance TaskService with ready(), stale_epics(), and claims", "status": "closed", "priority": "P1", "issue_type": "task", "description": "TaskService already exists but needs additional methods for the suggestion engine and welcome message. `ready()` and `stale_epics()` are key data sources for suggestions.\n\n**Implementation Steps:**\n1. Add `ready() -> list[Task]` to TaskService — tasks with no blockers, ordered by priority\n2. Add `stale_epics() -> list[Epic]` — epics where all child tasks are closed but epic is open\n3. Add `claim(task_id, session_id) -> Task` — mark task as in-progress for a session\n4. Add `close(task_id, reason) -> Task` — close task with reason\n5. Ensure methods work with both beads and JSONL backends\n6. Write tests for each method with both backends\n\n**Files:** src/cub/core/tasks/service.py, tests/test_task_service.py", "assignee": "cub-20260128-192025", "labels": ["phase-3", "core", "architecture", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1c", "created_at": "2026-01-28T17:54:46.169561", "updated_at": "2026-01-28T19:58:57.828806", "closed_at": "2026-01-28T19:58:57.828802", "acceptanceCriteria": ["`TaskService.ready()` returns correctly filtered and ordered tasks", "`TaskService.stale_epics()` detects epics ready to close", "Works with beads and JSONL backends", "Tests cover edge cases (no tasks, all blocked, mixed states)"], "notes": "[Closed: 2026-01-28T19:58:57.828808] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1d.1", "title": "Create suggestion models and data sources", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Define the data models for suggestions and implement the four data source adapters (tasks, git, ledger, milestones) that feed the ranking engine.\n\n**Implementation Steps:**\n1. Create `src/cub/core/suggestions/__init__.py` package\n2. Create `src/cub/core/suggestions/models.py` with `Suggestion`, `ProjectSnapshot`, `SuggestionCategory` enum\n3. Create `src/cub/core/suggestions/sources.py` with source protocol and implementations:\n4. Each source implements `get_suggestions() -> list[Suggestion]`\n5. Write tests with fixture data mirroring current cub project state\n\n**Files:** src/cub/core/suggestions/models.py, src/cub/core/suggestions/sources.py, tests/test_suggestions_sources.py", "assignee": "cub-20260128-195914", "labels": ["phase-4", "core", "feature", "model:sonnet", "complexity:medium", "blocking"], "dependsOn": [], "blocks": ["cub-b1d.2", "cub-b1d.3"], "parent": "cub-b1d", "created_at": "2026-01-28T17:54:46.169582", "updated_at": "2026-01-28T20:09:46.523423", "closed_at": "2026-01-28T20:09:46.523370", "acceptanceCriteria": ["All four sources produce relevant suggestions from real project data", "`TaskSource` detects the 9 stale epics in current project", "`GitSource` detects unpushed work and stale branches", "`MilestoneSource` infers 0.30 alpha target from sketches/CHANGELOG", "Models are Pydantic, serializable"], "notes": "[Closed: 2026-01-28T20:09:46.523427] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1d.2", "title": "Implement ranking algorithm and engine", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The ranking algorithm scores and orders suggestions from all sources. The engine composes sources, applies ranking, and provides the public API.\n\n**Implementation Steps:**\n1. Create `src/cub/core/suggestions/ranking.py` with `rank_suggestions(suggestions) -> list[Suggestion]`\n2. Implement scoring: `base_priority × urgency_multiplier × recency_decay`\n3. Create `src/cub/core/suggestions/engine.py` with `SuggestionEngine` class\n4. `get_suggestions(limit) -> list[Suggestion]` — ranked list\n5. `get_welcome() -> WelcomeMessage` — stats + top suggestions + skills\n6. `get_next_action() -> Suggestion` — single best recommendation\n7. Write tests with deterministic fixture data to verify ranking order\n\n**Files:** src/cub/core/suggestions/ranking.py, src/cub/core/suggestions/engine.py, tests/test_suggestions_engine.py", "assignee": "cub-20260128-195914", "labels": ["phase-4", "core", "feature", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1d", "created_at": "2026-01-28T17:54:46.169599", "updated_at": "2026-01-28T20:15:09.194747", "closed_at": "2026-01-28T20:15:09.194743", "acceptanceCriteria": ["Stale epic closure ranks above low-priority ready tasks", "P0 tasks rank above P2 tasks", "Milestone blockers rank high when release target detected", "`get_welcome()` produces a complete `WelcomeMessage` with stats", "Ranking is deterministic for same input"], "notes": "[Closed: 2026-01-28T20:15:09.194749] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1d.3", "title": "Wire SuggestionEngine into services and dogfood", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Connect the engine to real project data via services and validate it produces useful suggestions for the cub project itself.\n\n**Implementation Steps:**\n1. Create `src/cub/core/services/suggestions.py` as the service wrapper\n2. Wire `SuggestionEngine` to use `TaskService`, `LedgerService`, `StatusService`\n3. Add a CLI command for testing: `cub suggest` (or add to `cub status`)\n4. Run against the current cub project and verify suggestions are sensible\n5. Iterate on ranking weights based on dogfooding results\n6. Document the suggestion categories and their use cases\n\n**Files:** src/cub/core/services/suggestions.py, src/cub/cli/suggest.py, tests/test_suggestions_integration.py", "assignee": "cub-20260128-195914", "labels": ["phase-4", "core", "feature", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1d", "created_at": "2026-01-28T17:54:46.169615", "updated_at": "2026-01-28T20:22:32.062910", "closed_at": "2026-01-28T20:22:32.062906", "acceptanceCriteria": ["`cub suggest` (or equivalent) produces useful output for cub project", "Suggestions include stale epics, ready tasks, and milestone awareness", "Output is human-readable and actionable", "Engine handles empty projects gracefully (new project with no tasks)"], "notes": "[Closed: 2026-01-28T20:22:32.062912] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1e.1", "title": "Implement bare cub default command handler", "status": "closed", "priority": "P0", "issue_type": "task", "description": "This is the primary user-facing deliverable. Bare `cub` detects the environment, generates a welcome message with suggestions, and either launches the harness (terminal) or shows inline status (nested/harness).\n\n**Implementation Steps:**\n1. Create `src/cub/cli/default.py` with the default command function\n2. Wire into `cli/__init__.py`: replace `no_args_is_help=True` with callback that invokes default\n3. Accept `--resume` and `--continue` flags\n4. Call `LaunchService.detect_environment()` to determine context\n5. If nested/harness: call `SuggestionEngine.get_welcome()`, render with Rich, exit\n6. If terminal: generate welcome, resolve harness, launch with `LaunchService.launch_harness()`\n7. Set `CUB_SESSION_ACTIVE=1` and `CUB_SESSION_ID` in launched harness environment\n8. Handle edge cases: no harness available, no project initialized, help flag\n\n**Files:** src/cub/cli/default.py, src/cub/cli/__init__.py, tests/test_default_command.py", "assignee": "cub-20260128-202245", "labels": ["phase-5", "cli", "feature", "model:opus", "complexity:high", "blocking"], "dependsOn": [], "blocks": ["cub-b1e.2", "cub-b1e.3"], "parent": "cub-b1e", "created_at": "2026-01-28T17:54:46.169633", "updated_at": "2026-01-28T20:31:26.493282", "closed_at": "2026-01-28T20:31:26.493257", "acceptanceCriteria": ["`cub` (no args) launches Claude Code with welcome context", "`cub --resume` passes `--resume` to Claude Code", "`cub --continue` passes `--continue` to Claude Code", "`cub` inside Claude Code shows inline status + suggestions (no nesting)", "`cub` with no harness available shows helpful error", "`cub --help` still works (shows help, not default action)", "Welcome message includes project stats and top suggestion"], "notes": "[Closed: 2026-01-28T20:31:26.493284] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0}
{"id": "cub-b1e.2", "title": "Design and implement welcome message format", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The welcome message is the first thing users see. It needs to be concise, opinionated, and immediately useful. It renders differently in terminal (Rich formatting) vs inline (plain text for harness context).\n\n**Implementation Steps:**\n1. Create `src/cub/core/launch/welcome.py` with `generate_welcome(snapshot) -> WelcomeMessage`\n2. Design terminal format (Rich):\n3. Design harness context format (plain text for system prompt injection)\n4. Create Rich renderer in `cli/default.py` for terminal output\n5. Test with current cub project state\n\n**Files:** src/cub/core/launch/welcome.py, src/cub/cli/default.py, tests/test_welcome.py", "assignee": "cub-20260128-202245", "labels": ["phase-5", "cli", "feature", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1e", "created_at": "2026-01-28T17:54:46.169652", "updated_at": "2026-01-28T20:37:11.972618", "closed_at": "2026-01-28T20:37:11.972614", "acceptanceCriteria": ["Welcome message shows version, task counts, and last activity", "Top suggestion is opinionated with rationale and command", "Available skills listed for discoverability", "Terminal and harness formats both look good", "Handles empty project gracefully (no tasks, no history)"], "notes": "[Closed: 2026-01-28T20:37:11.972622] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1e.3", "title": "Integration testing and edge cases", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The bare cub command has many edge cases that need testing: no project, no harness, nested sessions, resume/continue, different backends.\n\n**Implementation Steps:**\n1. Write integration test: bare cub in fresh directory (no `.cub/`)\n2. Write integration test: bare cub with JSONL backend\n3. Write integration test: bare cub with beads backend\n4. Write integration test: bare cub with `CUB_SESSION_ACTIVE=1` set\n5. Write integration test: bare cub with `--resume`\n6. Write integration test: bare cub when no harness available\n7. Test that `cub --help` still shows help text\n8. Test that `cub <subcommand>` still routes to subcommands normally\n\n**Files:** tests/test_default_command_integration.py", "assignee": "cub-20260128-202245", "labels": ["phase-5", "cli", "test", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1e", "created_at": "2026-01-28T17:54:46.169673", "updated_at": "2026-01-28T20:46:03.745287", "closed_at": "2026-01-28T20:46:03.745282", "acceptanceCriteria": ["All integration tests pass", "No regressions in existing subcommand routing", "Edge cases produce helpful error messages, not crashes", "`--help` behavior preserved"], "notes": "[Closed: 2026-01-28T20:46:03.745289] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-b1f.1", "title": "Create /cub meta-skill for in-session discovery", "status": "open", "priority": "P2", "issue_type": "task", "description": "Users inside a harness session need to discover what cub skills are available. A `/cub` meta-skill lists available skills, common commands, and current project status.\n\n**Implementation Steps:**\n1. Create `.claude/commands/cub.md` as the meta-skill\n2. Include: list of available `/cub:*` skills with one-line descriptions\n3. Include: common `cub` CLI commands runnable via Bash (task ready, status, run)\n4. Include: brief explanation of modes (conversational, structured, supervised, autonomous)\n5. Include: dynamic project state (injected via template variables or by running `cub status`)\n\n**Files:** .claude/commands/cub.md", "assignee": null, "labels": ["phase-6", "docs", "feature", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1f", "created_at": "2026-01-28T17:54:46.169693", "updated_at": "2026-01-28T17:54:46.169693", "closed_at": null, "acceptanceCriteria": ["`/cub` skill exists and is invocable from Claude Code", "Lists all available `/cub:*` skills", "Lists common CLI commands", "Provides enough context for a user to navigate cub's capabilities"], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 2}
{"id": "cub-b1f.2", "title": "Update CLAUDE.md with service architecture and skill reference", "status": "open", "priority": "P2", "issue_type": "task", "description": "CLAUDE.md needs to reflect the new core/interface architecture so that harness sessions (and agents) understand cub's structure. Also document available skills.\n\n**Implementation Steps:**\n1. Update CLAUDE.md architecture section to reflect service layer\n2. Add \"Available Skills\" section listing all `/cub:*` skills\n3. Add \"Cub Commands\" section with commonly-used CLI commands\n4. Update project structure diagram to show `core/services/`, `core/run/`, `core/suggestions/`, `core/launch/`\n5. Add note about bare `cub` behavior and nesting detection\n6. Remove any outdated references to old architecture\n\n**Files:** CLAUDE.md", "assignee": null, "labels": ["phase-6", "docs", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1f", "created_at": "2026-01-28T17:54:46.169709", "updated_at": "2026-01-28T17:54:46.169710", "closed_at": null, "acceptanceCriteria": ["CLAUDE.md reflects current service layer architecture", "Skills section lists all available skills with descriptions", "Project structure diagram is accurate", "A harness session loading CLAUDE.md gets accurate information"], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 2}
{"id": "cub-b1f.3", "title": "End-to-end validation of full flow", "status": "in_progress", "priority": "P1", "issue_type": "task", "description": "Final validation that the entire flow works: bare `cub` → harness → use skills → run tasks → exit. This is the acceptance test for the whole feature.\n\n**Implementation Steps:**\n1. Manual test: run `cub` from terminal, verify welcome + harness launch\n2. Manual test: inside harness, run `/cub` to see available skills\n3. Manual test: inside harness, run `/cub:spec` to start a spec\n4. Manual test: inside harness, run `cub task ready` to see tasks\n5. Manual test: inside harness, run `cub run --once` for foreground task\n6. Manual test: run `cub` inside the harness (verify nesting prevention)\n7. Document any issues found, create follow-up tasks if needed\n\n**Files:** (manual testing, no code changes expected)", "assignee": "cub-20260128-204617", "labels": ["phase-6", "test", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-b1f", "created_at": "2026-01-28T17:54:46.169724", "updated_at": "2026-01-28T20:46:18.265207", "closed_at": null, "acceptanceCriteria": ["Full flow works without crashes or confusing behavior", "Mode transitions feel natural", "Nesting prevention works correctly", "Any issues found are documented as follow-up tasks"], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
