{"id": "cub-orphan-00", "title": "bare-cub #1: Core Run Extraction", "status": "closed", "priority": "P0", "issue_type": "epic", "description": "Extract ~2500 lines of business logic from `cli/run.py` into a new `core/run/` package. This is the highest-risk, highest-impact phase \u2014 it establishes the pattern that every subsequent phase follows. All existing tests must continue passing after each extraction step.", "assignee": null, "labels": ["phase-1", "core", "refactor", "risk:high"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.407838", "updated_at": "2026-01-29T20:02:57.991703", "closed_at": "2026-01-29T20:02:57.991677", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T18:57:22.732007] All tasks completed\n\n[Closed: 2026-01-29T20:02:57.991708] Epic has no remaining child tasks", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 0, "_old_id": "cub-b1a"}
{"id": "cub-orphan-01", "title": "bare-cub #2: Rich Boundary Cleanup", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Remove all Rich imports from `cub.core` modules. Core returns structured data; CLI renders it. This establishes the architectural rule that enables non-CLI interfaces.", "assignee": null, "labels": ["phase-2", "core", "refactor", "cleanup"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.407983", "updated_at": "2026-01-29T20:03:04.678430", "closed_at": "2026-01-29T20:03:04.678383", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T19:20:21.672422] All tasks completed\n\n[Closed: 2026-01-29T20:03:04.678437] Epic has no remaining child tasks", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1b"}
{"id": "cub-orphan-02", "title": "bare-cub #3: Service Layer", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Introduce `cub.core.services` as the public API surface. Services are thin orchestrators that compose domain operations. CLI modules are refactored to call services.", "assignee": null, "labels": ["phase-3", "core", "architecture"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.408044", "updated_at": "2026-01-29T20:03:04.025307", "closed_at": "2026-01-29T20:03:04.025281", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T19:59:09.455589] All tasks completed\n\n[Closed: 2026-01-29T20:03:04.025313] Epic has no remaining child tasks", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1c"}
{"id": "cub-orphan-03", "title": "bare-cub #4: Suggestion Engine", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Build the smart recommendation system that analyzes project state and produces ranked, opinionated suggestions for what to do next.", "assignee": null, "labels": ["phase-4", "core", "feature"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.408089", "updated_at": "2026-01-29T20:03:03.337249", "closed_at": "2026-01-29T20:03:03.337227", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T20:22:42.124610] All tasks completed\n\n[Closed: 2026-01-29T20:03:03.337256] Epic has no remaining child tasks", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1d"}
{"id": "cub-orphan-04", "title": "bare-cub #5: Bare Cub Command", "status": "closed", "priority": "P0", "issue_type": "epic", "description": "Implement the default command handler \u2014 the user-facing deliverable. When someone types `cub` with no subcommand, it launches the default harness with an opinionated welcome.", "assignee": null, "labels": ["phase-5", "cli", "feature"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.408186", "updated_at": "2026-01-29T20:02:57.338135", "closed_at": "2026-01-29T20:02:57.338103", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T20:46:13.750876] All tasks completed\n\n[Closed: 2026-01-29T20:02:57.338140] Epic has no remaining child tasks", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 0, "_old_id": "cub-b1e"}
{"id": "cub-orphan-05", "title": "bare-cub #6: Skill Discovery & Documentation", "status": "closed", "priority": "P2", "issue_type": "epic", "description": "Make cub capabilities discoverable from within a harness session and document the new architecture.", "assignee": null, "labels": ["phase-6", "docs", "feature"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T17:54:44.408236", "updated_at": "2026-01-29T20:03:08.606496", "closed_at": "2026-01-29T20:03:08.606468", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-28T21:05:14.566953] All tasks completed\n\n[Closed: 2026-01-29T20:03:08.606501] Epic has no remaining child tasks", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-b1f"}
{"id": "cub-orphan-00.1", "title": "Create core/run package with prompt builder extraction", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The prompt builder (system prompt generation, task context injection, AGENT.md reading) is the most self-contained piece of `cli/run.py` and the safest to extract first. It establishes the `core/run/` package structure.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/__init__.py` package\n2. Create `src/cub/core/run/prompt_builder.py` \u2014 extract `generate_system_prompt()`, `_build_task_context()`, `_read_agent_md()`, and related functions from `cli/run.py`\n3. Define `PromptConfig` and `TaskPrompt` data models for inputs/outputs\n4. Update `cli/run.py` to import from `core/run/prompt_builder` instead of using local functions\n5. Ensure all existing run tests pass unchanged\n6. Add unit tests for prompt builder in isolation\n\n**Files:** src/cub/core/run/__init__.py, src/cub/core/run/prompt_builder.py, src/cub/cli/run.py, tests/test_run_prompt_builder.py", "assignee": "cub-20260128-175601", "labels": ["phase-1", "core", "refactor", "model:opus", "complexity:high", "blocking"], "dependsOn": [], "blocks": ["cub-orphan-00.2", "cub-orphan-00.3", "cub-orphan-00.4", "cub-orphan-00.5"], "parent": "cub-orphan-00", "created_at": "2026-01-28T17:54:46.169146", "updated_at": "2026-01-28T18:04:02.242112", "closed_at": "2026-01-28T18:04:02.242086", "acceptanceCriteria": ["`core/run/prompt_builder.py` exists with all prompt generation logic", "`cli/run.py` calls prompt builder from core, no local prompt logic remains", "`pytest tests/` passes with no regressions", "`mypy src/cub` passes clean", "No Rich imports in `core/run/`"], "notes": "[Closed: 2026-01-28T18:04:02.242114] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-b1a.1"}
{"id": "cub-orphan-00.2", "title": "Extract budget tracking to core/run/budget.py", "status": "closed", "priority": "P0", "issue_type": "task", "description": "Budget tracking (token counting, cost accounting, limit enforcement) is business logic embedded in the run loop. It needs to be accessible to any interface that runs tasks.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/budget.py` with `BudgetManager` class\n2. Extract token tracking, cost accumulation, and limit checking from `cli/run.py`\n3. Define `BudgetConfig` (limits) and `BudgetState` (current usage) models\n4. Add `check_limit()` method that returns whether to continue or stop\n5. Update `cli/run.py` to use `BudgetManager` instead of inline tracking\n6. Write tests for budget limit enforcement\n\n**Files:** src/cub/core/run/budget.py, src/cub/cli/run.py, tests/test_run_budget.py", "assignee": "cub-20260128-175601", "labels": ["phase-1", "core", "refactor", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-00", "created_at": "2026-01-28T17:54:46.169250", "updated_at": "2026-01-28T18:09:17.082589", "closed_at": "2026-01-28T18:09:17.082585", "acceptanceCriteria": ["`BudgetManager` handles all token/cost tracking", "Budget limits trigger clean stops with clear reasons", "`cli/run.py` has no inline budget math", "Tests cover: under budget, at budget, over budget, no budget set"], "notes": "[Closed: 2026-01-28T18:09:17.082592] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-b1a.2"}
{"id": "cub-orphan-00.3", "title": "Extract loop state machine to core/run/loop.py", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The run loop state machine (pick task \u2192 execute \u2192 record \u2192 next) is the core of cub. Extracting it cleanly is the hardest part of this phase \u2014 it touches task selection, harness invocation, result recording, and error handling.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/loop.py` with `RunLoop` class\n2. Define `RunConfig` model (all loop configuration: once, epic, harness, etc.)\n3. Define `RunEvent` enum/model for loop events (task_start, task_end, budget_update, error, complete)\n4. Implement `execute()` as a generator that yields `RunEvent` objects\n5. Move task selection, harness invocation coordination, and result recording into `RunLoop`\n6. Keep signal handling and Rich rendering in `cli/run.py`\n7. `cli/run.py` becomes: parse args \u2192 create `RunConfig` \u2192 iterate `RunLoop.execute()` \u2192 render events\n\n**Files:** src/cub/core/run/loop.py, src/cub/core/run/models.py, src/cub/cli/run.py, tests/test_run_loop.py", "assignee": "cub-20260128-183943", "labels": ["phase-1", "core", "refactor", "model:opus", "complexity:high", "risk:high"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-00", "created_at": "2026-01-28T17:54:46.169288", "updated_at": "2026-01-28T18:41:42.743657", "closed_at": "2026-01-28T18:41:42.743618", "acceptanceCriteria": ["`RunLoop.execute()` yields `RunEvent` stream, no print/console output", "`cli/run.py` reduced to <500 lines (arg parsing + event rendering)", "`cub run --once` works end-to-end through the new architecture", "`cub run` (multi-task) works end-to-end", "All existing run tests pass", "`mypy` passes clean"], "notes": "[Closed: 2026-01-28T18:41:42.743661] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-b1a.3"}
{"id": "cub-orphan-00.4", "title": "Extract interrupt handling to core/run/interrupt.py", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Signal handling (SIGINT/SIGTERM) for clean shutdown needs to work regardless of which interface is driving the run loop. The interrupt handler should coordinate with the loop state machine.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/interrupt.py` with `InterruptHandler` class\n2. Extract signal registration and `_interrupted` flag logic from `cli/run.py`\n3. Implement cooperative interruption: handler sets flag, loop checks flag between tasks\n4. Add `on_interrupt` callback for cleanup (artifact finalization, ledger entry)\n5. Update `RunLoop` to check interrupt state between iterations\n\n**Files:** src/cub/core/run/interrupt.py, src/cub/core/run/loop.py, src/cub/cli/run.py, tests/test_run_interrupt.py", "assignee": "cub-20260128-183943", "labels": ["phase-1", "core", "refactor", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-00", "created_at": "2026-01-28T17:54:46.169329", "updated_at": "2026-01-28T18:47:30.640522", "closed_at": "2026-01-28T18:47:30.640516", "acceptanceCriteria": ["`InterruptHandler` manages SIGINT/SIGTERM registration", "Interrupts cause clean shutdown between tasks (not mid-task)", "Artifacts and ledger entries are finalized on interrupt", "Works when called from CLI or programmatically"], "notes": "[Closed: 2026-01-28T18:47:30.640526] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1a.4"}
{"id": "cub-orphan-00.5", "title": "Extract git operations to core/run/git_ops.py", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Branch creation, commit tracking, and other git operations during `cub run` are business logic that should be accessible from any interface.\n\n**Implementation Steps:**\n1. Create `src/cub/core/run/git_ops.py` with run-specific git functions\n2. Extract `_create_branch_from_base()`, `_get_gh_issue_title()`, `_get_epic_title()` from `cli/run.py`\n3. Define clear interfaces: `create_run_branch(config) -> str`, `get_epic_context(epic_id) -> EpicContext`\n4. Update `RunLoop` to call git_ops functions instead of inline logic\n5. Write tests with mocked git operations\n\n**Files:** src/cub/core/run/git_ops.py, src/cub/cli/run.py, tests/test_run_git_ops.py", "assignee": "cub-20260128-183943", "labels": ["phase-1", "core", "refactor", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-00", "created_at": "2026-01-28T17:54:46.169369", "updated_at": "2026-01-28T18:57:10.834668", "closed_at": "2026-01-28T18:57:10.834664", "acceptanceCriteria": ["All git operations during run extracted to `core/run/git_ops.py`", "No git subprocess calls remain in `cli/run.py`", "Branch naming convention preserved", "Tests cover branch creation, epic title resolution"], "notes": "[Closed: 2026-01-28T18:57:10.834670] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1a.5"}
{"id": "cub-orphan-01.1", "title": "Move review reporter rendering to CLI layer", "status": "closed", "priority": "P1", "issue_type": "task", "description": "`core/review/reporter.py` is the heaviest Rich violator \u2014 it's ~90% Rich rendering. The data models already exist in `core/review/models.py`. We need to split data preparation from rendering.\n\n**Implementation Steps:**\n1. Audit `core/review/reporter.py` to identify data preparation vs rendering\n2. Keep any data transformation logic in core; move to `core/review/formatter.py` if needed (returns structured data)\n3. Create `cli/review/display.py` with all Rich rendering (Panel, Table, Text)\n4. Update `cli/review.py` to call display functions instead of core reporter\n5. Remove Rich imports from `core/review/reporter.py` (or delete if fully moved)\n6. Update tests to verify data output, not rendered output\n\n**Files:** src/cub/core/review/reporter.py, src/cub/cli/review/display.py, src/cub/cli/review.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": ["cub-orphan-01.5"], "parent": "cub-orphan-01", "created_at": "2026-01-28T17:54:46.169408", "updated_at": "2026-01-28T19:02:20.690087", "closed_at": "2026-01-28T19:02:20.690062", "acceptanceCriteria": ["Zero Rich imports in `core/review/`", "`cli/review/display.py` handles all review rendering", "`cub review` command output unchanged from user's perspective", "Tests pass"], "notes": "[Closed: 2026-01-28T19:02:20.690089] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1b.1"}
{"id": "cub-orphan-01.2", "title": "Remove Rich from core/pr/service.py and core/worktree/parallel.py", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Both modules use Rich Console for progress/status output. They should emit events or return data, letting the CLI layer handle display.\n\n**Implementation Steps:**\n1. In `core/pr/service.py`: replace `Console` usage with return values or Python logging\n2. In `core/worktree/parallel.py`: replace progress output with callback/event pattern\n3. Define callback protocols: `on_worker_start(task_id)`, `on_worker_complete(task_id, result)`\n4. Update `cli/pr.py` and `cli/worktree.py` to provide Rich-based callbacks\n5. Verify all PR and worktree commands work unchanged\n\n**Files:** src/cub/core/pr/service.py, src/cub/core/worktree/parallel.py, src/cub/cli/pr.py, src/cub/cli/worktree.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": ["cub-orphan-01.5"], "parent": "cub-orphan-01", "created_at": "2026-01-28T17:54:46.169430", "updated_at": "2026-01-28T19:12:49.833208", "closed_at": "2026-01-28T19:12:49.833201", "acceptanceCriteria": ["Zero Rich imports in `core/pr/` and `core/worktree/`", "PR and worktree commands produce identical output", "Core modules use callbacks or return data for progress"], "notes": "[Closed: 2026-01-28T19:12:49.833211] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1b.2"}
{"id": "cub-orphan-01.3", "title": "Move bash_delegate to CLI layer", "status": "closed", "priority": "P1", "issue_type": "task", "description": "`core/bash_delegate.py` imports Rich Console and calls `sys.exit()`. It's purely a CLI concern \u2014 delegating commands to the bash version of cub.\n\n**Implementation Steps:**\n1. Move `core/bash_delegate.py` to `cli/delegated/runner.py`\n2. Update imports in `cli/delegated.py` and `cli/__init__.py`\n3. Remove `core/bash_delegate.py`\n4. Verify delegated commands (prep, branch, etc.) still work\n\n**Files:** src/cub/core/bash_delegate.py, src/cub/cli/delegated/runner.py, src/cub/cli/delegated.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:sonnet", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-01", "created_at": "2026-01-28T17:54:46.169447", "updated_at": "2026-01-28T19:16:59.892654", "closed_at": "2026-01-28T19:16:59.892650", "acceptanceCriteria": ["`core/bash_delegate.py` no longer exists", "Delegated commands work unchanged", "No Rich or sys.exit in any `core/` module"], "notes": "[Closed: 2026-01-28T19:16:59.892655] Completed by autonomous execution", "complexity_label": "low", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1b.3"}
{"id": "cub-orphan-01.4", "title": "Replace Rich logging in core/harness/hooks.py", "status": "closed", "priority": "P1", "issue_type": "task", "description": "`core/harness/hooks.py` uses Rich for logging. It should use Python's standard `logging` module \u2014 hooks run in subprocess contexts where Rich may not be appropriate.\n\n**Implementation Steps:**\n1. Replace `from rich.console import Console` with `import logging`\n2. Replace `console.print()` calls with `logger.info()`, `logger.debug()`, etc.\n3. Configure logging format in hook entry point\n4. Verify hook forensics still work correctly\n\n**Files:** src/cub/core/harness/hooks.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-01", "created_at": "2026-01-28T17:54:46.169467", "updated_at": "2026-01-28T19:18:27.819752", "closed_at": "2026-01-28T19:18:27.819748", "acceptanceCriteria": ["Zero Rich imports in `core/harness/hooks.py`", "Hook logging works in subprocess contexts", "Forensics JSONL output unchanged"], "notes": "[Closed: 2026-01-28T19:18:27.819754] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1b.4"}
{"id": "cub-orphan-01.5", "title": "Verify zero Rich imports in core and add CI gate", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Final verification that the boundary is clean, plus a CI check to prevent regression.\n\n**Implementation Steps:**\n1. Run `grep -r \"from rich\" src/cub/core/` and verify zero results\n2. Run `grep -r \"import rich\" src/cub/core/` and verify zero results\n3. Add a test that programmatically checks no Rich imports in core\n4. Verify `mypy src/cub` passes clean\n\n**Files:** tests/test_architecture.py", "assignee": "cub-20260128-185726", "labels": ["phase-2", "core", "cleanup", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-01", "created_at": "2026-01-28T17:54:46.169492", "updated_at": "2026-01-28T19:20:10.863075", "closed_at": "2026-01-28T19:20:10.863070", "acceptanceCriteria": ["`grep -r \"from rich\\|import rich\" src/cub/core/` returns nothing", "Automated test enforces the boundary", "All commands work unchanged from user's perspective"], "notes": "[Closed: 2026-01-28T19:20:10.863078] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1b.5"}
{"id": "cub-orphan-02.1", "title": "Create service layer foundation and RunService", "status": "closed", "priority": "P1", "issue_type": "task", "description": "RunService wraps the newly-extracted `core/run/` package, providing the clean API that CLI and future interfaces call. This establishes the service layer pattern.\n\n**Implementation Steps:**\n1. Create `src/cub/core/services/__init__.py` package\n2. Create `src/cub/core/services/run.py` with `RunService` class\n3. `RunService.from_config(config)` factory method\n4. `RunService.execute(run_config) -> Iterator[RunEvent]` delegates to `core/run/loop.py`\n5. `RunService.run_once(task_id) -> RunResult` convenience method\n6. Refactor `cli/run.py` to use `RunService` instead of calling `core/run/` directly\n7. Write service-level integration tests\n\n**Files:** src/cub/core/services/__init__.py, src/cub/core/services/run.py, src/cub/cli/run.py, tests/test_service_run.py", "assignee": "cub-20260128-192025", "labels": ["phase-3", "core", "architecture", "model:opus", "complexity:high", "blocking"], "dependsOn": [], "blocks": ["cub-orphan-02.2", "cub-orphan-02.3", "cub-orphan-02.4"], "parent": "cub-orphan-02", "created_at": "2026-01-28T17:54:46.169509", "updated_at": "2026-01-28T19:30:32.960816", "closed_at": "2026-01-28T19:30:32.960778", "acceptanceCriteria": ["`RunService` provides the complete API for task execution", "`cli/run.py` only calls `RunService`, not domain modules directly", "Service is stateless \u2014 configuration passed in, no globals", "Tests verify service orchestration"], "notes": "[Closed: 2026-01-28T19:30:32.960820] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1c.1"}
{"id": "cub-orphan-02.2", "title": "Create StatusService and LedgerService", "status": "closed", "priority": "P1", "issue_type": "task", "description": "StatusService aggregates project state from multiple sources. LedgerService wraps ledger reader/writer. Both are needed by the suggestion engine.\n\n**Implementation Steps:**\n1. Create `src/cub/core/services/status.py` with `StatusService`\n2. `summary() -> ProjectStats` \u2014 aggregate from tasks, ledger, git\n3. `progress(epic_id) -> EpicProgress` \u2014 epic-level progress\n4. Create `src/cub/core/services/ledger.py` with `LedgerService`\n5. `query(filters) -> list[LedgerEntry]`, `recent(n) -> list[LedgerEntry]`, `stats(period) -> LedgerStats`\n6. Define `ProjectStats`, `EpicProgress`, `LedgerStats` models\n7. Refactor `cli/status.py` and `cli/ledger.py` to use services\n\n**Files:** src/cub/core/services/status.py, src/cub/core/services/ledger.py, src/cub/core/services/models.py, src/cub/cli/status.py, src/cub/cli/ledger.py", "assignee": "cub-20260128-192025", "labels": ["phase-3", "core", "architecture", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-02", "created_at": "2026-01-28T17:54:46.169529", "updated_at": "2026-01-28T19:43:16.990826", "closed_at": "2026-01-28T19:43:16.990819", "acceptanceCriteria": ["`StatusService.summary()` returns structured project stats", "`LedgerService` wraps all ledger operations", "`cub status` and `cub ledger` commands work via services", "Models are Pydantic, serializable"], "notes": "[Closed: 2026-01-28T19:43:16.990832] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1c.2"}
{"id": "cub-orphan-02.3", "title": "Create LaunchService for environment detection and harness launch", "status": "closed", "priority": "P1", "issue_type": "task", "description": "LaunchService handles the core logic for bare `cub`: detect environment, determine if nested, launch harness with context. This is the service that `cli/default.py` will call.\n\n**Implementation Steps:**\n1. Create `src/cub/core/launch/__init__.py` package\n2. Create `src/cub/core/launch/detector.py` with `detect_environment() -> EnvironmentInfo`\n3. Check `CUB_SESSION_ACTIVE`, `CLAUDE_CODE`, `CLAUDE_PROJECT_DIR` env vars\n4. Create `src/cub/core/launch/launcher.py` with `launch_harness(config, context)`\n5. Implement harness binary resolution, flag assembly, `exec` call\n6. Create `src/cub/core/launch/models.py` with `EnvironmentInfo`, `LaunchConfig`\n7. Create `src/cub/core/services/launch.py` with `LaunchService` wrapper\n8. Write tests with mocked environment variables\n\n**Files:** src/cub/core/launch/detector.py, src/cub/core/launch/launcher.py, src/cub/core/launch/models.py, src/cub/core/services/launch.py, tests/test_launch.py", "assignee": "cub-20260128-192025", "labels": ["phase-3", "core", "architecture", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-02", "created_at": "2026-01-28T17:54:46.169545", "updated_at": "2026-01-28T19:49:58.382182", "closed_at": "2026-01-28T19:49:58.382177", "acceptanceCriteria": ["`detect_environment()` correctly identifies terminal, harness, and nested contexts", "`launch_harness()` assembles correct `claude` CLI invocation", "`--resume` and `--continue` flags pass through correctly", "`CUB_SESSION_ACTIVE` and `CUB_SESSION_ID` set in child environment", "Tests cover all three environment contexts"], "notes": "[Closed: 2026-01-28T19:49:58.382184] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1c.3"}
{"id": "cub-orphan-02.4", "title": "Enhance TaskService with ready(), stale_epics(), and claims", "status": "closed", "priority": "P1", "issue_type": "task", "description": "TaskService already exists but needs additional methods for the suggestion engine and welcome message. `ready()` and `stale_epics()` are key data sources for suggestions.\n\n**Implementation Steps:**\n1. Add `ready() -> list[Task]` to TaskService \u2014 tasks with no blockers, ordered by priority\n2. Add `stale_epics() -> list[Epic]` \u2014 epics where all child tasks are closed but epic is open\n3. Add `claim(task_id, session_id) -> Task` \u2014 mark task as in-progress for a session\n4. Add `close(task_id, reason) -> Task` \u2014 close task with reason\n5. Ensure methods work with both beads and JSONL backends\n6. Write tests for each method with both backends\n\n**Files:** src/cub/core/tasks/service.py, tests/test_task_service.py", "assignee": "cub-20260128-192025", "labels": ["phase-3", "core", "architecture", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-02", "created_at": "2026-01-28T17:54:46.169561", "updated_at": "2026-01-28T19:58:57.828806", "closed_at": "2026-01-28T19:58:57.828802", "acceptanceCriteria": ["`TaskService.ready()` returns correctly filtered and ordered tasks", "`TaskService.stale_epics()` detects epics ready to close", "Works with beads and JSONL backends", "Tests cover edge cases (no tasks, all blocked, mixed states)"], "notes": "[Closed: 2026-01-28T19:58:57.828808] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1c.4"}
{"id": "cub-orphan-03.1", "title": "Create suggestion models and data sources", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Define the data models for suggestions and implement the four data source adapters (tasks, git, ledger, milestones) that feed the ranking engine.\n\n**Implementation Steps:**\n1. Create `src/cub/core/suggestions/__init__.py` package\n2. Create `src/cub/core/suggestions/models.py` with `Suggestion`, `ProjectSnapshot`, `SuggestionCategory` enum\n3. Create `src/cub/core/suggestions/sources.py` with source protocol and implementations:\n4. Each source implements `get_suggestions() -> list[Suggestion]`\n5. Write tests with fixture data mirroring current cub project state\n\n**Files:** src/cub/core/suggestions/models.py, src/cub/core/suggestions/sources.py, tests/test_suggestions_sources.py", "assignee": "cub-20260128-195914", "labels": ["phase-4", "core", "feature", "model:sonnet", "complexity:medium", "blocking"], "dependsOn": [], "blocks": ["cub-orphan-03.2", "cub-orphan-03.3"], "parent": "cub-orphan-03", "created_at": "2026-01-28T17:54:46.169582", "updated_at": "2026-01-28T20:09:46.523423", "closed_at": "2026-01-28T20:09:46.523370", "acceptanceCriteria": ["All four sources produce relevant suggestions from real project data", "`TaskSource` detects the 9 stale epics in current project", "`GitSource` detects unpushed work and stale branches", "`MilestoneSource` infers 0.30 alpha target from sketches/CHANGELOG", "Models are Pydantic, serializable"], "notes": "[Closed: 2026-01-28T20:09:46.523427] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1d.1"}
{"id": "cub-orphan-03.2", "title": "Implement ranking algorithm and engine", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The ranking algorithm scores and orders suggestions from all sources. The engine composes sources, applies ranking, and provides the public API.\n\n**Implementation Steps:**\n1. Create `src/cub/core/suggestions/ranking.py` with `rank_suggestions(suggestions) -> list[Suggestion]`\n2. Implement scoring: `base_priority \u00d7 urgency_multiplier \u00d7 recency_decay`\n3. Create `src/cub/core/suggestions/engine.py` with `SuggestionEngine` class\n4. `get_suggestions(limit) -> list[Suggestion]` \u2014 ranked list\n5. `get_welcome() -> WelcomeMessage` \u2014 stats + top suggestions + skills\n6. `get_next_action() -> Suggestion` \u2014 single best recommendation\n7. Write tests with deterministic fixture data to verify ranking order\n\n**Files:** src/cub/core/suggestions/ranking.py, src/cub/core/suggestions/engine.py, tests/test_suggestions_engine.py", "assignee": "cub-20260128-195914", "labels": ["phase-4", "core", "feature", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-03", "created_at": "2026-01-28T17:54:46.169599", "updated_at": "2026-01-28T20:15:09.194747", "closed_at": "2026-01-28T20:15:09.194743", "acceptanceCriteria": ["Stale epic closure ranks above low-priority ready tasks", "P0 tasks rank above P2 tasks", "Milestone blockers rank high when release target detected", "`get_welcome()` produces a complete `WelcomeMessage` with stats", "Ranking is deterministic for same input"], "notes": "[Closed: 2026-01-28T20:15:09.194749] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1d.2"}
{"id": "cub-orphan-03.3", "title": "Wire SuggestionEngine into services and dogfood", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Connect the engine to real project data via services and validate it produces useful suggestions for the cub project itself.\n\n**Implementation Steps:**\n1. Create `src/cub/core/services/suggestions.py` as the service wrapper\n2. Wire `SuggestionEngine` to use `TaskService`, `LedgerService`, `StatusService`\n3. Add a CLI command for testing: `cub suggest` (or add to `cub status`)\n4. Run against the current cub project and verify suggestions are sensible\n5. Iterate on ranking weights based on dogfooding results\n6. Document the suggestion categories and their use cases\n\n**Files:** src/cub/core/services/suggestions.py, src/cub/cli/suggest.py, tests/test_suggestions_integration.py", "assignee": "cub-20260128-195914", "labels": ["phase-4", "core", "feature", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-03", "created_at": "2026-01-28T17:54:46.169615", "updated_at": "2026-01-28T20:22:32.062910", "closed_at": "2026-01-28T20:22:32.062906", "acceptanceCriteria": ["`cub suggest` (or equivalent) produces useful output for cub project", "Suggestions include stale epics, ready tasks, and milestone awareness", "Output is human-readable and actionable", "Engine handles empty projects gracefully (new project with no tasks)"], "notes": "[Closed: 2026-01-28T20:22:32.062912] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1d.3"}
{"id": "cub-orphan-04.1", "title": "Implement bare cub default command handler", "status": "closed", "priority": "P0", "issue_type": "task", "description": "This is the primary user-facing deliverable. Bare `cub` detects the environment, generates a welcome message with suggestions, and either launches the harness (terminal) or shows inline status (nested/harness).\n\n**Implementation Steps:**\n1. Create `src/cub/cli/default.py` with the default command function\n2. Wire into `cli/__init__.py`: replace `no_args_is_help=True` with callback that invokes default\n3. Accept `--resume` and `--continue` flags\n4. Call `LaunchService.detect_environment()` to determine context\n5. If nested/harness: call `SuggestionEngine.get_welcome()`, render with Rich, exit\n6. If terminal: generate welcome, resolve harness, launch with `LaunchService.launch_harness()`\n7. Set `CUB_SESSION_ACTIVE=1` and `CUB_SESSION_ID` in launched harness environment\n8. Handle edge cases: no harness available, no project initialized, help flag\n\n**Files:** src/cub/cli/default.py, src/cub/cli/__init__.py, tests/test_default_command.py", "assignee": "cub-20260128-202245", "labels": ["phase-5", "cli", "feature", "model:opus", "complexity:high", "blocking"], "dependsOn": [], "blocks": ["cub-orphan-04.2", "cub-orphan-04.3"], "parent": "cub-orphan-04", "created_at": "2026-01-28T17:54:46.169633", "updated_at": "2026-01-28T20:31:26.493282", "closed_at": "2026-01-28T20:31:26.493257", "acceptanceCriteria": ["`cub` (no args) launches Claude Code with welcome context", "`cub --resume` passes `--resume` to Claude Code", "`cub --continue` passes `--continue` to Claude Code", "`cub` inside Claude Code shows inline status + suggestions (no nesting)", "`cub` with no harness available shows helpful error", "`cub --help` still works (shows help, not default action)", "Welcome message includes project stats and top suggestion"], "notes": "[Closed: 2026-01-28T20:31:26.493284] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-b1e.1"}
{"id": "cub-orphan-04.2", "title": "Design and implement welcome message format", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The welcome message is the first thing users see. It needs to be concise, opinionated, and immediately useful. It renders differently in terminal (Rich formatting) vs inline (plain text for harness context).\n\n**Implementation Steps:**\n1. Create `src/cub/core/launch/welcome.py` with `generate_welcome(snapshot) -> WelcomeMessage`\n2. Design terminal format (Rich):\n3. Design harness context format (plain text for system prompt injection)\n4. Create Rich renderer in `cli/default.py` for terminal output\n5. Test with current cub project state\n\n**Files:** src/cub/core/launch/welcome.py, src/cub/cli/default.py, tests/test_welcome.py", "assignee": "cub-20260128-202245", "labels": ["phase-5", "cli", "feature", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-04", "created_at": "2026-01-28T17:54:46.169652", "updated_at": "2026-01-28T20:37:11.972618", "closed_at": "2026-01-28T20:37:11.972614", "acceptanceCriteria": ["Welcome message shows version, task counts, and last activity", "Top suggestion is opinionated with rationale and command", "Available skills listed for discoverability", "Terminal and harness formats both look good", "Handles empty project gracefully (no tasks, no history)"], "notes": "[Closed: 2026-01-28T20:37:11.972622] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1e.2"}
{"id": "cub-orphan-04.3", "title": "Integration testing and edge cases", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The bare cub command has many edge cases that need testing: no project, no harness, nested sessions, resume/continue, different backends.\n\n**Implementation Steps:**\n1. Write integration test: bare cub in fresh directory (no `.cub/`)\n2. Write integration test: bare cub with JSONL backend\n3. Write integration test: bare cub with beads backend\n4. Write integration test: bare cub with `CUB_SESSION_ACTIVE=1` set\n5. Write integration test: bare cub with `--resume`\n6. Write integration test: bare cub when no harness available\n7. Test that `cub --help` still shows help text\n8. Test that `cub <subcommand>` still routes to subcommands normally\n\n**Files:** tests/test_default_command_integration.py", "assignee": "cub-20260128-202245", "labels": ["phase-5", "cli", "test", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-04", "created_at": "2026-01-28T17:54:46.169673", "updated_at": "2026-01-28T20:46:03.745287", "closed_at": "2026-01-28T20:46:03.745282", "acceptanceCriteria": ["All integration tests pass", "No regressions in existing subcommand routing", "Edge cases produce helpful error messages, not crashes", "`--help` behavior preserved"], "notes": "[Closed: 2026-01-28T20:46:03.745289] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1e.3"}
{"id": "cub-orphan-05.1", "title": "Create /cub meta-skill for in-session discovery", "status": "closed", "priority": "P2", "issue_type": "task", "description": "Users inside a harness session need to discover what cub skills are available. A `/cub` meta-skill lists available skills, common commands, and current project status.\n\n**Implementation Steps:**\n1. Create `.claude/commands/cub.md` as the meta-skill\n2. Include: list of available `/cub:*` skills with one-line descriptions\n3. Include: common `cub` CLI commands runnable via Bash (task ready, status, run)\n4. Include: brief explanation of modes (conversational, structured, supervised, autonomous)\n5. Include: dynamic project state (injected via template variables or by running `cub status`)\n\n**Files:** .claude/commands/cub.md", "assignee": "cub-20260128-204617", "labels": ["phase-6", "docs", "feature", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-05", "created_at": "2026-01-28T17:54:46.169693", "updated_at": "2026-01-28T20:54:38.292608", "closed_at": "2026-01-28T20:54:38.292604", "acceptanceCriteria": ["`/cub` skill exists and is invocable from Claude Code", "Lists all available `/cub:*` skills", "Lists common CLI commands", "Provides enough context for a user to navigate cub's capabilities"], "notes": "[Closed: 2026-01-28T20:54:38.292610] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 2, "_old_id": "cub-b1f.1"}
{"id": "cub-orphan-05.2", "title": "Update CLAUDE.md with service architecture and skill reference", "status": "closed", "priority": "P2", "issue_type": "task", "description": "CLAUDE.md needs to reflect the new core/interface architecture so that harness sessions (and agents) understand cub's structure. Also document available skills.\n\n**Implementation Steps:**\n1. Update CLAUDE.md architecture section to reflect service layer\n2. Add \"Available Skills\" section listing all `/cub:*` skills\n3. Add \"Cub Commands\" section with commonly-used CLI commands\n4. Update project structure diagram to show `core/services/`, `core/run/`, `core/suggestions/`, `core/launch/`\n5. Add note about bare `cub` behavior and nesting detection\n6. Remove any outdated references to old architecture\n\n**Files:** CLAUDE.md", "assignee": "cub-20260128-204617", "labels": ["phase-6", "docs", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-05", "created_at": "2026-01-28T17:54:46.169709", "updated_at": "2026-01-28T21:05:03.067296", "closed_at": "2026-01-28T21:05:03.067292", "acceptanceCriteria": ["CLAUDE.md reflects current service layer architecture", "Skills section lists all available skills with descriptions", "Project structure diagram is accurate", "A harness session loading CLAUDE.md gets accurate information"], "notes": "[Closed: 2026-01-28T21:05:03.067297] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 2, "_old_id": "cub-b1f.2"}
{"id": "cub-orphan-05.3", "title": "End-to-end validation of full flow", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Final validation that the entire flow works: bare `cub` \u2192 harness \u2192 use skills \u2192 run tasks \u2192 exit. This is the acceptance test for the whole feature.\n\n**Implementation Steps:**\n1. Manual test: run `cub` from terminal, verify welcome + harness launch\n2. Manual test: inside harness, run `/cub` to see available skills\n3. Manual test: inside harness, run `/cub:spec` to start a spec\n4. Manual test: inside harness, run `cub task ready` to see tasks\n5. Manual test: inside harness, run `cub run --once` for foreground task\n6. Manual test: run `cub` inside the harness (verify nesting prevention)\n7. Document any issues found, create follow-up tasks if needed\n\n**Files:** (manual testing, no code changes expected)", "assignee": "cub-20260128-204617", "labels": ["phase-6", "test", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-05", "created_at": "2026-01-28T17:54:46.169724", "updated_at": "2026-01-28T20:52:34.691040", "closed_at": "2026-01-28T20:52:34.691014", "acceptanceCriteria": ["Full flow works without crashes or confusing behavior", "Mode transitions feel natural", "Nesting prevention works correctly", "Any issues found are documented as follow-up tasks"], "notes": "[Closed: 2026-01-28T20:52:34.691043] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-b1f.3"}
{"id": "cub-orphan-06", "title": "cub-task-parity #1: Protocol Extensions & DependencyGraph", "status": "closed", "priority": "P0", "issue_type": "epic", "description": "Extend the TaskBackend protocol with 7 new methods, implement them in BeadsBackend and JsonlBackend, extend `update_task` signature, and build the DependencyGraph class. This is the foundation that everything else depends on.", "assignee": null, "labels": ["phase-1", "complexity:high", "model:sonnet"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T11:45:10.091591", "updated_at": "2026-01-29T20:02:56.689086", "closed_at": "2026-01-29T20:02:56.689059", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-29T12:47:24.167151] All tasks completed\n\n[Closed: 2026-01-29T20:02:56.689091] Epic has no remaining child tasks", "complexity_label": "high", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-p1t"}
{"id": "cub-orphan-07", "title": "cub-task-parity #2: CLI Subcommands", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Add CLI commands for all new protocol operations. Each command supports three output modes: Rich (default), `--json`, `--agent`.", "assignee": null, "labels": ["phase-2", "complexity:medium", "model:sonnet"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T11:45:10.092044", "updated_at": "2026-01-29T20:03:02.563848", "closed_at": "2026-01-29T20:03:02.563825", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-29T14:25:21.844119] All tasks completed\n\n[Closed: 2026-01-29T20:03:02.563853] Epic has no remaining child tasks", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-p2c"}
{"id": "cub-orphan-08", "title": "cub-task-parity #3: Skill & Documentation Updates", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Update all skills, router, and documentation to reference `cub task` exclusively. Remove `bd` from user-facing content.", "assignee": null, "labels": ["phase-3", "complexity:low", "model:haiku"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T11:45:10.092066", "updated_at": "2026-01-29T20:03:01.905356", "closed_at": "2026-01-29T20:03:01.905334", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-29T15:28:05.779326] All tasks completed\n\n[Closed: 2026-01-29T20:03:01.905361] Epic has no remaining child tasks", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-p3s"}
{"id": "cub-orphan-06.1", "title": "Extend TaskBackend protocol with 7 new methods", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The protocol needs 7 new methods for full lifecycle coverage. Also extend `update_task` to accept `title`, `priority`, and `notes` parameters. Create a `TaskBackendDefaults` mixin with default implementations for methods that can be derived from existing operations.\n\n**Implementation Steps:**\n1. Add 7 new method signatures to `TaskBackend` protocol in `backend.py`: `add_dependency`, `remove_dependency`, `list_blocked_tasks`, `reopen_task`, `delete_task`, `add_label`, `remove_label`\n2. Extend `update_task` signature with optional `title: str | None`, `priority: int | None`, `notes: str | None` parameters\n3. Create `TaskBackendDefaults` mixin class with default implementations:\n4. Add `blocked: int = 0` field to `TaskCounts` model\n5. Update type annotations and docstrings for all new methods\n\n**Files:** src/cub/core/tasks/backend.py, src/cub/core/tasks/models.py", "assignee": "cub-20260129-115503", "labels": ["phase-1", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": ["cub-orphan-06.2", "cub-orphan-06.3", "cub-orphan-06.4"], "parent": "cub-orphan-06", "created_at": "2026-01-29T11:46:17.463297", "updated_at": "2026-01-29T12:04:59.972632", "closed_at": "2026-01-29T12:04:59.972586", "acceptanceCriteria": ["`TaskBackend` protocol has 19 methods (12 existing + 7 new)", "`update_task` accepts `title`, `priority`, `notes` optional params", "`TaskBackendDefaults` mixin has working default implementations", "`TaskCounts.blocked` field exists", "mypy passes with strict mode", "All new methods have complete docstrings"], "notes": "[Closed: 2026-01-29T12:04:59.972635] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-p1t.1"}
{"id": "cub-orphan-06.2", "title": "Implement new protocol methods in BeadsBackend", "status": "closed", "priority": "P0", "issue_type": "task", "description": "BeadsBackend wraps the `bd` CLI. Each new protocol method needs a corresponding `bd` command wrapper. Follow the existing `_run_bd` pattern \u2014 bd commands that don't return JSON need a follow-up `get_task()` call.\n\n**Implementation Steps:**\n1. `add_dependency(task_id, depends_on)` \u2014 run `bd dep add <task_id> <depends_on>`, then `get_task(task_id)`\n2. `remove_dependency(task_id, depends_on)` \u2014 run `bd dep remove <task_id> <depends_on>`, then `get_task(task_id)`\n3. `list_blocked_tasks(parent?)` \u2014 run `bd blocked --json` (or `bd list --status open --json` and filter), parse JSON output\n4. `reopen_task(task_id)` \u2014 run `bd update <id> --status open`, then `get_task(task_id)`\n5. `delete_task(task_id)` \u2014 run `bd delete <id>`, return True on success\n6. `add_label(task_id, label)` \u2014 run `bd label add <id> <label>`, then `get_task(task_id)`\n7. `remove_label(task_id, label)` \u2014 run `bd label remove <id> <label>`, then `get_task(task_id)`\n8. Extend `update_task` to pass `--title`, `--priority`, `--notes` flags when provided\n9. Update `get_task_counts` to include blocked count\n\n**Files:** src/cub/core/tasks/beads.py, tests/test_beads_backend.py", "assignee": "cub-20260129-122038", "labels": ["phase-1", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": ["cub-orphan-06.5"], "parent": "cub-orphan-06", "created_at": "2026-01-29T11:46:17.463498", "updated_at": "2026-01-29T12:26:32.401999", "closed_at": "2026-01-29T12:26:32.401959", "acceptanceCriteria": ["All 7 new methods implemented and callable", "`update_task` supports title, priority, notes parameters", "`get_task_counts` includes blocked count", "Error handling follows existing pattern (ValueError on not found)", "Unit tests pass for all new methods (mocked bd subprocess)"], "notes": "[Closed: 2026-01-29T12:26:32.402002] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-p1t.2"}
{"id": "cub-orphan-06.3", "title": "Implement new protocol methods in JsonlBackend", "status": "closed", "priority": "P0", "issue_type": "task", "description": "JsonlBackend operates on an in-memory task list with atomic file writes. New methods manipulate task fields directly using existing Task model methods (`add_label()`, `remove_label()`, `reopen()`).\n\n**Implementation Steps:**\n1. `add_dependency(task_id, depends_on)` \u2014 find task, append to `depends_on` list, save\n2. `remove_dependency(task_id, depends_on)` \u2014 find task, remove from `depends_on` list, save\n3. `list_blocked_tasks(parent?)` \u2014 filter: status=OPEN, has depends_on, not all deps closed\n4. `reopen_task(task_id)` \u2014 find task, call `task.reopen()`, save\n5. `delete_task(task_id)` \u2014 remove task from list, save, return True\n6. `add_label(task_id, label)` \u2014 find task, call `task.add_label(label)`, save\n7. `remove_label(task_id, label)` \u2014 find task, call `task.remove_label(label)`, save\n8. Extend `update_task` to handle title, priority, notes field updates\n9. Update `get_task_counts` to include blocked count\n10. All mutations use existing atomic write pattern (temp file \u2192 rename)\n\n**Files:** src/cub/core/tasks/jsonl.py, tests/test_jsonl_backend.py", "assignee": "cub-20260129-122038", "labels": ["phase-1", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": ["cub-orphan-06.5"], "parent": "cub-orphan-06", "created_at": "2026-01-29T11:46:17.463520", "updated_at": "2026-01-29T12:32:41.078321", "closed_at": "2026-01-29T12:32:41.078307", "acceptanceCriteria": ["All 7 new methods implemented and callable", "`update_task` supports title, priority, notes parameters", "`get_task_counts` includes blocked count", "Atomic writes for all mutations (no partial state)", "Unit tests pass for all new methods"], "notes": "[Closed: 2026-01-29T12:32:41.078323] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-p1t.3"}
{"id": "cub-orphan-06.4", "title": "Build DependencyGraph class", "status": "closed", "priority": "P0", "issue_type": "task", "description": "Pure query object for dependency analysis. Built from a task list snapshot, immutable after construction. Used by AgentFormatter (agent-output spec) and `cub task blocked --agent` for impact analysis and recommendations. This is the critical piece that unblocks the agent-output spec.\n\n**Implementation Steps:**\n1. Create `src/cub/core/tasks/graph.py` with `DependencyGraph` class\n2. Constructor takes `list[Task]`, builds:\n3. `direct_unblocks(task_id) -> list[str]` \u2014 reverse edge lookup\n4. `transitive_unblocks(task_id) -> set[str]` \u2014 BFS from task through reverse edges\n5. `root_blockers(limit=5) -> list[tuple[str, int]]` \u2014 compute transitive_unblocks for all open tasks, sort by count descending\n6. `chains(limit=5) -> list[list[str]]` \u2014 DFS to find longest paths in forward graph\n7. `would_become_ready(task_id) -> list[str]` \u2014 for each task in `direct_unblocks()`, check if ALL other deps are in `_closed`\n8. `has_cycle() -> bool` \u2014 DFS with three-color marking (white/gray/black)\n9. `stats` property \u2014 return dict with node count, edge count, max chain depth\n10. Write comprehensive tests with topologies: empty, single task, linear chain, diamond, forest, cycle, mixed open/closed\n\n**Files:** src/cub/core/tasks/graph.py, tests/test_dependency_graph.py", "assignee": "cub-20260129-122038", "labels": ["phase-1", "model:opus", "complexity:high"], "dependsOn": [], "blocks": ["cub-orphan-06.5"], "parent": "cub-orphan-06", "created_at": "2026-01-29T11:46:17.463535", "updated_at": "2026-01-29T12:36:55.279963", "closed_at": "2026-01-29T12:36:55.279948", "acceptanceCriteria": ["All 6 query methods return correct results for test topologies", "Cycle detection works and doesn't cause infinite loops in other methods", "Closed tasks are correctly excluded from graph (treated as resolved)", "`would_become_ready` checks ALL deps, not just the given task", "`root_blockers` correctly ranks by transitive impact", "`chains` returns paths sorted by length descending", "mypy passes with strict mode", "Tests cover: empty graph, single node, linear chain (5 deep), diamond dependency, forest (disconnected), cycle, mixed open/closed states"], "notes": "[Closed: 2026-01-29T12:36:55.279966] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-p1t.4"}
{"id": "cub-orphan-06.5", "title": "Update BothBackend and write cross-backend tests", "status": "closed", "priority": "P1", "issue_type": "task", "description": "BothBackend delegates to primary and secondary backends. It needs to delegate all 7 new methods and log divergences. Also write parametrized tests that verify the same operations work identically across both backends.\n\n**Implementation Steps:**\n1. Update `BothBackend` to delegate all 7 new methods (follow existing delegation pattern)\n2. Inherit from `TaskBackendDefaults` as fallback\n3. Add divergence logging for new methods\n4. Write parametrized pytest tests that run the same test cases against BeadsBackend (mocked) and JsonlBackend (temp files)\n5. Test scenarios: add/remove dependency, list blocked, reopen, delete, add/remove label\n6. Verify `DependencyGraph` produces consistent results from both backend outputs\n\n**Files:** src/cub/core/tasks/both.py, tests/test_task_backends.py", "assignee": "cub-20260129-122038", "labels": ["phase-1", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-06", "created_at": "2026-01-29T11:46:17.463550", "updated_at": "2026-01-29T12:46:37.958238", "closed_at": "2026-01-29T12:46:37.958218", "acceptanceCriteria": ["BothBackend delegates all 7 new methods", "Divergence logging works for new methods", "Parametrized tests pass against both backends", "DependencyGraph produces same results regardless of backend", "mypy passes"], "notes": "[Closed: 2026-01-29T12:46:37.958240] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-p1t.5"}
{"id": "cub-orphan-07.1", "title": "Add cub task blocked command", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The most common gap \u2014 the router currently maps \"what's blocked\" to `bd blocked`. This command shows blocked tasks with optional epic filter. With `--agent`, it includes root blocker analysis and chain lengths from DependencyGraph.\n\n**Implementation Steps:**\n1. Add `blocked` command to task app in `cli/task.py`\n2. Parameters: `--epic` (filter), `--json`, `--agent`\n3. Rich output: table with ID, Priority, Title, Blocked By columns\n4. JSON output: task model dumps\n5. Agent output: call `AgentFormatter.format_blocked()` if available, otherwise fall back to a simple markdown table\n6. Build DependencyGraph from all tasks for analysis hints\n7. Show root blockers and chain summary in agent output\n\n**Files:** src/cub/cli/task.py", "assignee": "cub-20260129-124742", "labels": ["phase-2", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-07", "created_at": "2026-01-29T11:46:17.463571", "updated_at": "2026-01-29T13:13:48.865927", "closed_at": "2026-01-29T13:13:48.865885", "acceptanceCriteria": ["`cub task blocked` shows blocked tasks in Rich table", "`--epic` filter works", "`--json` outputs task list as JSON", "`--agent` outputs structured markdown with analysis", "Empty result shows helpful message (\"No blocked tasks\")", "CLI test covers all three output modes"], "notes": "[Closed: 2026-01-29T13:13:48.865930] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-p2c.1"}
{"id": "cub-orphan-07.2", "title": "Add cub task dep add/remove and cub task label add/remove/list commands", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Dependency and label management subcommands. These are simple CRUD wrappers around protocol methods with confirmation output.\n\n**Implementation Steps:**\n1. Create `dep` sub-app with `add` and `remove` commands\n2. `cub task dep add <task> <depends-on>` \u2014 calls `add_dependency()`, prints confirmation\n3. `cub task dep remove <task> <depends-on>` \u2014 calls `remove_dependency()`, prints confirmation\n4. Enhance existing `dep list` to show both directions (what this task depends on AND what depends on it)\n5. Create `label` sub-app with `add`, `remove`, `list` commands\n6. `cub task label add <task> <label>` \u2014 calls `add_label()`, prints confirmation\n7. `cub task label remove <task> <label>` \u2014 calls `remove_label()`, prints confirmation\n8. `cub task label list <task>` \u2014 calls `get_task()`, displays labels\n9. All commands support `--json` for machine output\n\n**Files:** src/cub/cli/task.py", "assignee": "cub-20260129-124742", "labels": ["phase-2", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-07", "created_at": "2026-01-29T11:46:17.463585", "updated_at": "2026-01-29T13:18:39.201110", "closed_at": "2026-01-29T13:18:39.201093", "acceptanceCriteria": ["`cub task dep add/remove` work and confirm the operation", "`cub task dep list <id>` shows both directions", "`cub task label add/remove/list` work and confirm operations", "`--json` output works for all commands", "Error handling for invalid task IDs", "CLI tests for each command"], "notes": "[Closed: 2026-01-29T13:18:39.201114] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-p2c.2"}
{"id": "cub-orphan-07.3", "title": "Add cub task reopen and cub task delete commands", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Lifecycle management commands. Reopen is straightforward. Delete is destructive and needs a confirmation prompt (skippable with `--force`).\n\n**Implementation Steps:**\n1. Add `reopen` command \u2014 calls `reopen_task()`, prints confirmation with task title\n2. Add `delete` command \u2014 prompts \"Delete task {id} '{title}'? [y/N]\" unless `--force` is passed\n3. Both support `--json` for machine output\n4. Error handling: task not found, task not in correct state (e.g., reopen a non-closed task)\n\n**Files:** src/cub/cli/task.py", "assignee": "cub-20260129-124742", "labels": ["phase-2", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-07", "created_at": "2026-01-29T11:46:17.463596", "updated_at": "2026-01-29T13:44:22.658654", "closed_at": "2026-01-29T13:44:22.658638", "acceptanceCriteria": ["`cub task reopen <id>` reopens a closed task", "`cub task delete <id>` prompts for confirmation", "`cub task delete <id> --force` skips confirmation", "Error messages for invalid states (reopen non-closed, delete non-existent)", "CLI tests"], "notes": "[Closed: 2026-01-29T13:44:22.658658] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-p2c.3"}
{"id": "cub-orphan-07.4", "title": "Enhance existing cub task list, ready, create, update commands", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Existing commands need additional filters and flags to reach parity. `list` and `ready` need `--epic` and `--assignee` filters. `create` needs full flag exposure. `update` needs `--title`, `--priority`, `--notes`.\n\n**Implementation Steps:**\n1. `cub task list`: add `--epic` (filter by parent), `--assignee` (filter by assignee) options\n2. `cub task ready`: add `--epic` filter, add `--by impact|priority` ordering option (impact uses DependencyGraph)\n3. `cub task create`: ensure CLI exposes `--type`, `--priority`, `--epic` (as `--parent`), `--description`, `--depends-on` (comma-separated list)\n4. `cub task update`: add `--title`, `--priority`, `--notes` flags alongside existing `--description`, `--assignee`, `--status`\n5. For `ready --by impact`: build DependencyGraph, sort tasks by `transitive_unblocks` count descending\n\n**Files:** src/cub/cli/task.py", "assignee": "cub-20260129-124742", "labels": ["phase-2", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-07", "created_at": "2026-01-29T11:46:17.463607", "updated_at": "2026-01-29T14:12:32.693907", "closed_at": "2026-01-29T14:12:32.693887", "acceptanceCriteria": ["`cub task list --epic <id>` filters correctly", "`cub task list --assignee <name>` filters correctly", "`cub task ready --epic <id>` filters correctly", "`cub task ready --by impact` sorts by unblock count", "`cub task create` exposes all flags", "`cub task update` supports title, priority, notes", "CLI tests for new filters and flags"], "notes": "[Closed: 2026-01-29T14:12:32.693910] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-p2c.4"}
{"id": "cub-orphan-07.5", "title": "Add cub task search command", "status": "closed", "priority": "P2", "issue_type": "task", "description": "Full-text search across task titles and descriptions. BeadsBackend wraps `bd search`. JsonlBackend does substring match on title + description in memory. This is P2 but included since we're not excluding anything.\n\n**Implementation Steps:**\n1. Add `search_tasks(query: str) -> list[Task]` to `TaskBackend` protocol\n2. Implement in BeadsBackend: run `bd search <query> --json`, parse results\n3. Implement in JsonlBackend: case-insensitive substring match on title and description\n4. Add `search` command to task CLI: `cub task search <query>`\n5. Support `--json` and `--agent` output modes\n6. Show match count and results table\n\n**Files:** src/cub/core/tasks/backend.py, src/cub/core/tasks/beads.py, src/cub/core/tasks/jsonl.py, src/cub/cli/task.py", "assignee": "cub-20260129-124742", "labels": ["phase-2", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-07", "created_at": "2026-01-29T11:46:17.463618", "updated_at": "2026-01-29T14:18:05.587895", "closed_at": "2026-01-29T14:18:05.587879", "acceptanceCriteria": ["`cub task search \"auth\"` finds tasks with \"auth\" in title or description", "Works with both backends", "`--json` and Rich output modes work", "Empty results show helpful message", "Tests for both backends"], "notes": "[Closed: 2026-01-29T14:18:05.587899] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 2, "_old_id": "cub-p2c.5"}
{"id": "cub-orphan-08.1", "title": "Update router skill and passthrough skills", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The router skill (`.claude/commands/cub.md`) currently maps \"what's blocked\" to `bd blocked`. Passthrough skills reference `bd` commands. Update all to use `cub task` equivalents with `--agent` flag.\n\n**Implementation Steps:**\n1. In `.claude/commands/cub.md`:\n2. In `.claude/commands/cub:tasks.md`:\n3. Review other skill files for any remaining `bd` references\n\n**Files:** .claude/commands/cub.md, .claude/commands/cub:tasks.md", "assignee": "cub-20260129-142540", "labels": ["phase-3", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-08", "created_at": "2026-01-29T11:46:17.463629", "updated_at": "2026-01-29T15:21:22.063401", "closed_at": "2026-01-29T15:21:22.063351", "acceptanceCriteria": ["Router skill has no `bd` references (except in \"power user\" context if desired)", "All task intent patterns route to `cub task` commands", "New subcommands (blocked, dep, label, reopen, delete, search) are in routing table", "`--agent` flag used in all command invocations within skills"], "notes": "[Closed: 2026-01-29T15:21:22.063404] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-p3s.1"}
{"id": "cub-orphan-08.2", "title": "Update CLAUDE.md and PROMPT.md documentation", "status": "closed", "priority": "P2", "issue_type": "task", "description": "CLAUDE.md (agent instructions) and `.cub/PROMPT.md` (runloop instructions) reference `bd` commands in examples. Update all examples to use `cub task` equivalents. Keep `bd` mentioned only in the \"Pre-approved Commands\" section (bd is still available for power users).\n\n**Implementation Steps:**\n1. In CLAUDE.md:\n2. In `.cub/PROMPT.md`:\n3. Audit all `.md` files in `.cub/` directory for stale `bd` references\n\n**Files:** CLAUDE.md, .cub/PROMPT.md", "assignee": "cub-20260129-142540", "labels": ["phase-3", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-08", "created_at": "2026-01-29T11:46:17.463639", "updated_at": "2026-01-29T15:27:52.047336", "closed_at": "2026-01-29T15:27:52.047320", "acceptanceCriteria": ["CLAUDE.md examples use `cub task` not `bd` (except Pre-approved section)", "PROMPT.md task instructions use `cub task`", "No stale `bd` references in user-facing documentation", "`bd` still listed as pre-approved for power users"], "notes": "[Closed: 2026-01-29T15:27:52.047338] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 2, "_old_id": "cub-p3s.2"}
{"id": "cub-orphan-09", "title": "agent-output #1: AgentFormatter & --agent Flag", "status": "closed", "priority": "P0", "issue_type": "epic", "description": "Build the AgentFormatter module and wire `--agent` flags into Phase 1 CLI commands (task ready, task show, status, suggest). This is the core value \u2014 Claude gets structured, compact markdown with pre-computed analysis hints instead of raw Rich output.", "assignee": null, "labels": ["phase-1", "complexity:high", "model:sonnet"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T11:46:50.492408", "updated_at": "2026-01-29T20:02:56.019088", "closed_at": "2026-01-29T20:02:56.019061", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-29T15:39:50.061775] All tasks completed\n\n[Closed: 2026-01-29T20:02:56.019093] Epic has no remaining child tasks", "complexity_label": "high", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-a1f"}
{"id": "cub-orphan-10", "title": "agent-output #2: Skill Updates & Router Integration", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Update all passthrough skill files and the router skill to use `--agent` flag in their CLI invocations. This closes the loop: `/cub` \u2192 router \u2192 `cub task ready --agent` \u2192 structured markdown \u2192 Claude interprets.", "assignee": null, "labels": ["phase-2", "complexity:low", "model:haiku"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T11:46:50.492616", "updated_at": "2026-01-29T20:03:01.256213", "closed_at": "2026-01-29T20:03:01.256186", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-29T15:43:49.088706] All tasks completed\n\n[Closed: 2026-01-29T20:03:01.256218] Epic has no remaining child tasks", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-a2s"}
{"id": "cub-orphan-11", "title": "agent-output #3: Route Learning", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Build the hook-based route learning system: observe cub command usage via hooks, compile frequency data at session end, surface compiled routes to the router skill via file reference.", "assignee": null, "labels": ["phase-3", "complexity:medium", "model:sonnet"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T11:46:50.492636", "updated_at": "2026-01-29T20:03:00.606009", "closed_at": "2026-01-29T20:03:00.605987", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-29T15:56:23.936863] All tasks completed\n\n[Closed: 2026-01-29T20:03:00.606015] Epic has no remaining child tasks", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-a3r"}
{"id": "cub-orphan-12", "title": "agent-output #4: Extended Commands", "status": "closed", "priority": "P2", "issue_type": "epic", "description": "Add `--agent` support to Phase 2 and Phase 3 commands. These depend on task parity (cub-task-parity) landing for `blocked` and `list`, and doctor refactor for `doctor`.", "assignee": null, "labels": ["phase-4", "complexity:medium", "model:sonnet"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T11:46:50.492652", "updated_at": "2026-01-29T20:03:07.956431", "closed_at": "2026-01-29T20:03:07.956400", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-29T16:20:00.973195] All tasks completed\n\n[Closed: 2026-01-29T20:03:07.956437] Epic has no remaining child tasks", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 2, "_old_id": "cub-a4e"}
{"id": "cub-orphan-09.1", "title": "Build AgentFormatter module with Phase 1 format methods", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The AgentFormatter is a collection of static methods that transform service-layer data into structured markdown for LLM consumption. Each method follows the envelope template: heading, summary line, data tables, truncation notice, analysis section. The formatter returns plain strings \u2014 no Rich, no console. DependencyGraph is an optional parameter; when None, analysis hints that require graph queries are omitted.\n\n**Implementation Steps:**\n1. Create `src/cub/core/services/agent_format.py` with `AgentFormatter` class\n2. Implement shared helpers:\n3. Implement `format_ready(tasks, graph=None)`:\n4. Implement `format_task_detail(task, graph=None, epic_progress=None)`:\n5. Implement `format_status(stats, epic_progress=None)`:\n6. Implement `format_suggestions(suggestions)`:\n7. Write snapshot tests for each method with representative inputs (0, 1, 10, 20 items)\n8. Write token budget test: assert output character count < 2000 for representative inputs\n\n**Files:** src/cub/core/services/agent_format.py, tests/test_agent_format.py", "assignee": "cub-20260129-152809", "labels": ["phase-1", "model:sonnet", "complexity:high"], "dependsOn": [], "blocks": ["cub-orphan-09.2"], "parent": "cub-orphan-09", "created_at": "2026-01-29T11:47:42.431379", "updated_at": "2026-01-29T15:32:33.814279", "closed_at": "2026-01-29T15:32:33.814236", "acceptanceCriteria": ["All 4 format methods return valid markdown strings", "Output follows the envelope template (heading, summary, tables, truncation, analysis)", "Truncation works: shows all if \u2264 15 items, truncates to 10 with notice if > 15", "Analysis section omits graph-dependent hints when graph is None", "Analysis section includes graph-dependent hints when graph is provided", "No Rich or console dependencies \u2014 pure string operations", "Token budget: all representative outputs < 2000 characters", "mypy passes with strict mode", "Snapshot tests pass for each method"], "notes": "[Closed: 2026-01-29T15:32:33.814282] Completed by autonomous execution", "complexity_label": "high", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-a1f.1"}
{"id": "cub-orphan-09.2", "title": "Wire --agent flag into Phase 1 CLI commands", "status": "closed", "priority": "P0", "issue_type": "task", "description": "Add `--agent` flag to `cub task ready`, `cub task show`, `cub status`, and `cub suggest`. Follow the existing `--json` pattern. When `--agent` is passed, call the corresponding AgentFormatter method and print the result. `--agent` wins silently over `--json` if both are passed. Include `_try_build_graph` helper that attempts to import DependencyGraph (returns None if not available yet).\n\n**Implementation Steps:**\n1. Create `_try_build_graph(backend)` helper function in `cli/task.py`:\n2. In `cub task ready`:\n3. In `cub task show`:\n4. In `cub status` (status.py):\n5. In `cub suggest` (suggest.py):\n6. Write CLI integration tests for each command with `--agent` flag\n\n**Files:** src/cub/cli/task.py, src/cub/cli/status.py, src/cub/cli/suggest.py", "assignee": "cub-20260129-152809", "labels": ["phase-1", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-09", "created_at": "2026-01-29T11:47:42.431536", "updated_at": "2026-01-29T15:39:34.942049", "closed_at": "2026-01-29T15:39:34.942037", "acceptanceCriteria": ["`cub task ready --agent` outputs structured markdown", "`cub task show <id> --agent` outputs structured markdown", "`cub status --agent` outputs structured markdown", "`cub suggest --agent` outputs structured markdown", "`--agent` takes precedence over `--json` silently", "`_try_build_graph` returns None gracefully when DependencyGraph not available", "`_try_build_graph` returns working graph when DependencyGraph is available", "CLI tests pass for all four commands"], "notes": "[Closed: 2026-01-29T15:39:34.942052] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0, "_old_id": "cub-a1f.2"}
{"id": "cub-orphan-10.1", "title": "Update passthrough skills and router to use --agent", "status": "closed", "priority": "P1", "issue_type": "task", "description": "Seven passthrough skills exist and the router skill maps intent to CLI commands. Update all command invocations to include `--agent` so Claude always gets structured output when routing through skills. The router skill needs `--agent` on all CLI command mappings.\n\n**Implementation Steps:**\n1. Update `.claude/commands/cub:tasks.md`:\n2. Update `.claude/commands/cub:status.md`:\n3. Update `.claude/commands/cub:suggest.md`:\n4. Update `.claude/commands/cub:ledger.md`:\n5. Update `.claude/commands/cub:doctor.md`:\n6. Update `.claude/commands/cub.md` (router):\n7. Add instruction in router skill about how Claude should treat `--agent` output:\n\n**Files:** .claude/commands/cub.md, .claude/commands/cub:tasks.md, .claude/commands/cub:status.md, .claude/commands/cub:suggest.md, .claude/commands/cub:ledger.md, .claude/commands/cub:doctor.md", "assignee": "cub-20260129-153952", "labels": ["phase-2", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-10", "created_at": "2026-01-29T11:47:42.431554", "updated_at": "2026-01-29T15:43:35.882747", "closed_at": "2026-01-29T15:43:35.882701", "acceptanceCriteria": ["All Phase 1 commands in skill files use `--agent`", "Router skill intent table uses `--agent` for all supported commands", "Router skill includes instruction on treating analysis hints", "Skills for commands without `--agent` support are left unchanged", "No broken command invocations"], "notes": "[Closed: 2026-01-29T15:43:35.882750] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-a2s.1"}
{"id": "cub-orphan-11.1", "title": "Add route observation to cub-hook.sh", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The existing `cub-hook.sh` fast-path filter fires on every Bash tool use. It already detects `cub` commands for the symbiotic workflow. Extend it to log command usage to `.cub/route-log.jsonl`. This is 4 lines of shell \u2014 minimal latency impact.\n\n**Implementation Steps:**\n1. In `.cub/scripts/hooks/cub-hook.sh`, in the PostToolUse/Bash handler where `cub ` commands are detected:\n2. Add `.cub/route-log.jsonl` to `.gitignore` (raw log is local-only)\n3. Ensure the logging doesn't interfere with existing hook behavior (the line is additive)\n4. Test manually: run a `cub task ready` in Claude Code, verify log entry appears\n\n**Files:** .cub/scripts/hooks/cub-hook.sh, .gitignore", "assignee": "cub-20260129-154351", "labels": ["phase-3", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": ["cub-orphan-11.2"], "parent": "cub-orphan-11", "created_at": "2026-01-29T11:47:42.431572", "updated_at": "2026-01-29T15:47:40.125343", "closed_at": "2026-01-29T15:47:40.125298", "acceptanceCriteria": ["Every `cub *` command executed via Bash tool use is logged to `.cub/route-log.jsonl`", "Log entries have ISO timestamp and full command string", "`.cub/route-log.jsonl` is in `.gitignore`", "Existing hook behavior is unchanged", "No measurable latency impact (shell echo + redirect)"], "notes": "[Closed: 2026-01-29T15:47:40.125346] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-a3r.1"}
{"id": "cub-orphan-11.2", "title": "Build route compiler and cub routes CLI", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The route compiler reads the raw log, normalizes commands (strips task IDs, file paths), aggregates by frequency, filters noise (count < 3), and writes a markdown table to `.cub/learned-routes.md`. This compiled file is git-tracked and shared with the team. The compiler is triggered by the Stop hook at session end.\n\n**Implementation Steps:**\n1. Create `src/cub/core/routes/compiler.py`:\n2. Create `src/cub/core/routes/__init__.py`\n3. Create `src/cub/cli/routes.py`:\n4. Register routes app in `src/cub/cli/__init__.py`\n5. Add Stop hook trigger in `cub-hook.sh`:\n6. Write tests for `normalize_command` with edge cases (various command patterns)\n7. Write tests for `compile_routes` with sample JSONL input\n8. Write tests for `render_learned_routes` output format\n\n**Files:** src/cub/core/routes/__init__.py, src/cub/core/routes/compiler.py, src/cub/cli/routes.py, src/cub/cli/__init__.py, .cub/scripts/hooks/cub-hook.sh, tests/test_route_compiler.py", "assignee": "cub-20260129-154351", "labels": ["phase-3", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": ["cub-orphan-11.3"], "parent": "cub-orphan-11", "created_at": "2026-01-29T11:47:42.431583", "updated_at": "2026-01-29T15:54:15.468327", "closed_at": "2026-01-29T15:54:15.468314", "acceptanceCriteria": ["`normalize_command` correctly strips IDs and values from 10+ command patterns", "`compile_routes` aggregates correctly, filters count < 3, sorts by frequency", "`compile_routes` handles max_entries truncation for large logs", "`render_learned_routes` produces valid markdown table", "`cub routes compile` writes `.cub/learned-routes.md`", "`cub routes show` displays the compiled routes", "`cub routes clear` deletes both files", "Stop hook triggers compilation in background", "mypy passes", "Tests pass for normalizer, compiler, and renderer"], "notes": "[Closed: 2026-01-29T15:54:15.468331] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-a3r.2"}
{"id": "cub-orphan-11.3", "title": "Add learned routes section to router skill", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The router skill needs to reference the compiled routes file so Claude can use frequency data as a tiebreaker for ambiguous intent. This is the only point where LLM judgment enters the route learning system.\n\n**Implementation Steps:**\n1. Add a \"Learned Routes\" section to `.claude/commands/cub.md`:\n2. Place this section after the \"Execution Rules\" section and before \"Examples\"\n3. The `@` prefix ensures Claude Code injects the file content into context\n\n**Files:** .claude/commands/cub.md", "assignee": "cub-20260129-154351", "labels": ["phase-3", "model:haiku", "complexity:low"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-11", "created_at": "2026-01-29T11:47:42.431594", "updated_at": "2026-01-29T15:56:09.924046", "closed_at": "2026-01-29T15:56:09.924033", "acceptanceCriteria": ["Router skill references `@.cub/learned-routes.md`", "Instructions tell Claude to use learned routes as tiebreaker, not override", "Section is positioned logically in the skill file", "Skill still works correctly when learned-routes.md doesn't exist yet"], "notes": "[Closed: 2026-01-29T15:56:09.924049] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1, "_old_id": "cub-a3r.3"}
{"id": "cub-orphan-12.1", "title": "Add AgentFormatter methods for blocked, list, and ledger", "status": "closed", "priority": "P2", "issue_type": "task", "description": "Three more commands get `--agent` support. `format_blocked` uses DependencyGraph heavily (root blockers, chain visualization). `format_list` is a general-purpose task table. `format_ledger` shows recent completions with cost summary. These depend on the task parity spec having landed `cub task blocked` and `cub task list` enhancements.\n\n**Implementation Steps:**\n1. Add `format_blocked(tasks, graph=None)` to AgentFormatter:\n2. Add `format_list(tasks)` to AgentFormatter:\n3. Add `format_ledger(entries, stats=None)` to AgentFormatter:\n4. Write snapshot tests for each method\n5. Write token budget tests\n\n**Files:** src/cub/core/services/agent_format.py, tests/test_agent_format.py", "assignee": "cub-20260129-155626", "labels": ["phase-4", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": ["cub-orphan-12.2"], "parent": "cub-orphan-12", "created_at": "2026-01-29T11:47:42.431604", "updated_at": "2026-01-29T16:02:09.319924", "closed_at": "2026-01-29T16:02:09.319884", "acceptanceCriteria": ["`format_blocked` produces correct output with and without graph", "`format_blocked` with graph shows root blockers and chains", "`format_list` produces correct output with truncation", "`format_ledger` produces correct output with cost summary", "All outputs < 2000 characters for representative inputs", "Snapshot tests pass"], "notes": "[Closed: 2026-01-29T16:02:09.319926] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 2, "_old_id": "cub-a4e.1"}
{"id": "cub-orphan-12.2", "title": "Wire --agent flag into blocked, list, and ledger CLI commands", "status": "closed", "priority": "P2", "issue_type": "task", "description": "Add `--agent` flag to `cub task blocked`, `cub task list`, and `cub ledger show`. These commands should already exist from the task parity spec. Wire in the AgentFormatter methods.\n\n**Implementation Steps:**\n1. In `cub task blocked` (cli/task.py):\n2. In `cub task list` (cli/task.py):\n3. In `cub ledger show` (cli/ledger.py):\n4. Update corresponding skill files to use `--agent`\n5. Write CLI tests\n\n**Files:** src/cub/cli/task.py, src/cub/cli/ledger.py, .claude/commands/cub:tasks.md, .claude/commands/cub:ledger.md", "assignee": "cub-20260129-155626", "labels": ["phase-4", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-12", "created_at": "2026-01-29T11:47:42.431614", "updated_at": "2026-01-29T16:07:24.438890", "closed_at": "2026-01-29T16:07:24.438872", "acceptanceCriteria": ["`cub task blocked --agent` outputs structured markdown", "`cub task list --agent` outputs structured markdown", "`cub ledger show --agent` outputs structured markdown", "Skill files updated to use `--agent` for these commands", "CLI tests pass"], "notes": "[Closed: 2026-01-29T16:07:24.438894] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 2, "_old_id": "cub-a4e.2"}
{"id": "cub-orphan-12.3", "title": "Add --agent support for doctor command (requires refactor)", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The doctor command currently prints directly via Rich console. To support `--agent`, it needs to return structured diagnostic results instead. This is a refactor of the existing doctor command internals, not just adding a flag.\n\n**Implementation Steps:**\n1. Define `DiagnosticResult` model (or use existing if one exists):\n2. Refactor doctor command to collect `list[DiagnosticResult]` before rendering\n3. Add `format_doctor(checks: list[DiagnosticResult])` to AgentFormatter:\n4. Add `--agent` flag to `cub doctor` command\n5. If agent: call `AgentFormatter.format_doctor(checks)`, print\n6. Ensure existing Rich output is unchanged when `--agent` is not passed\n7. Update `cub:doctor.md` skill to use `--agent`\n8. Write tests for both the refactored data collection and agent formatting\n\n**Files:** src/cub/cli/doctor.py, src/cub/core/services/agent_format.py, .claude/commands/cub:doctor.md, tests/test_agent_format.py", "assignee": "cub-20260129-155626", "labels": ["phase-4", "model:sonnet", "complexity:medium"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-12", "created_at": "2026-01-29T11:47:42.431624", "updated_at": "2026-01-29T16:19:45.782091", "closed_at": "2026-01-29T16:19:45.782077", "acceptanceCriteria": ["Doctor command collects structured `DiagnosticResult` list before rendering", "Existing Rich output is unchanged (no regression)", "`cub doctor --agent` outputs structured markdown", "`format_doctor` produces correct output", "Skill file updated", "Tests pass for both output modes"], "notes": "[Closed: 2026-01-29T16:19:45.782093] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 2, "_old_id": "cub-a4e.3"}
{"id": "cub-s001", "title": "Create direct session CLI commands", "status": "open", "priority": "P0", "issue_type": "task", "description": "Direct sessions need commands to record work. These are the integration layer between harness and ledger.\n\n**Implementation Steps:**\n1. Create `src/cub/cli/session.py` with Typer app\n2. Implement `cub log <message>` - adds timestamped entry to session log\n3. Implement `cub done <task-id> [--reason]` - marks task complete, creates ledger entry\n4. Implement `cub wip <task-id>` - marks task in-progress\n5. Register commands in main CLI app\n6. Add `source: \"direct_session\"` to ledger entries created by these commands\n\n**Files:** src/cub/cli/session.py, src/cub/cli/__init__.py", "assignee": null, "labels": ["cli", "complexity:medium", "epic:cub-r6s", "model:sonnet", "phase-3"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923630Z", "updated_at": "2026-01-29T20:11:29.875610", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 0, "_old_id": "cub-r6s.1"}
{"id": "cub-s002", "title": "Integrate circuit breaker into run.py", "status": "open", "priority": "P0", "issue_type": "task", "description": "Wire the circuit breaker into the run loop so harness invocations are timeout-protected.\n\n**Implementation Steps:**\n1. Import CircuitBreaker in `src/cub/cli/run.py`\n2. Create CircuitBreaker instance from config in run initialization\n3. Wrap `_invoke_harness()` call with `circuit_breaker.execute()`\n4. Handle `CircuitBreakerTripped` exception: log, update status, exit cleanly with artifacts\n5. Add circuit breaker status to run summary output\n\n**Files:** src/cub/cli/run.py", "assignee": null, "labels": ["complexity:medium", "epic:cub-r5c", "integration", "model:sonnet", "phase-2"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923591Z", "updated_at": "2026-01-29T20:11:29.876038", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 0, "_old_id": "cub-r5c.3"}
{"id": "cub-s003", "title": "Implement CircuitBreaker class", "status": "open", "priority": "P0", "issue_type": "task", "description": "The core circuit breaker logic. Uses asyncio timeout to detect hung harness execution.\n\n**Implementation Steps:**\n1. Create `src/cub/core/circuit_breaker.py`\n2. Implement `CircuitBreaker` class with:\n3. On timeout: raise `CircuitBreakerTripped` exception with clear message\n4. Handle graceful cancellation of the wrapped coroutine\n5. Write unit tests\n\n**Files:** src/cub/core/circuit_breaker.py, tests/unit/test_circuit_breaker.py", "assignee": null, "labels": ["complexity:medium", "core", "epic:cub-r5c", "model:sonnet", "phase-2"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923575Z", "updated_at": "2026-01-29T20:11:29.876101", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 0, "_old_id": "cub-r5c.2"}
{"id": "cub-s004", "title": "Add CircuitBreakerConfig", "status": "open", "priority": "P0", "issue_type": "task", "description": "Configuration must exist before we can implement the circuit breaker. This adds the config model and wires it into CubConfig.\n\n**Implementation Steps:**\n1. Add `CircuitBreakerConfig` class to `src/cub/core/config/models.py`\n2. Fields: `enabled: bool = True`, `timeout_minutes: int = 30`\n3. Add `circuit_breaker: CircuitBreakerConfig` field to `CubConfig`\n4. Add environment variable support: `CUB_CIRCUIT_BREAKER_ENABLED`, `CUB_CIRCUIT_BREAKER_TIMEOUT`\n5. Update config documentation\n\n**Files:** src/cub/core/config/models.py, docs/CONFIG.md", "assignee": null, "labels": ["complexity:low", "config", "epic:cub-r5c", "model:haiku", "phase-2"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923564Z", "updated_at": "2026-01-29T20:11:29.876122", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 0, "_old_id": "cub-r5c.1"}
{"id": "cub-s005", "title": "Ensure artifacts on all exits", "status": "open", "priority": "P0", "issue_type": "task", "description": "Based on audit findings, fix any exit paths that don't preserve artifacts. This is the core deliverable of E4.\n\n**Implementation Steps:**\n1. Review gaps identified in cub-r4h.1 audit\n2. Add try/finally blocks where needed to ensure `write_run_artifact()` is called\n3. Ensure `StatusWriter.write()` is called before any exit\n4. Handle edge cases: exceptions during artifact write, partial state\n5. Run integration tests to verify fixes\n\n**Files:** src/cub/cli/run.py, src/cub/core/status/writer.py", "assignee": null, "labels": ["complexity:medium", "epic:cub-r4h", "fix", "model:sonnet", "phase-1"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923537Z", "updated_at": "2026-01-29T20:11:29.876138", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 0, "_old_id": "cub-r4h.3"}
{"id": "cub-s006", "title": "Integration tests for exit scenarios", "status": "open", "priority": "P0", "issue_type": "task", "description": "We need automated tests that verify clean exits on all paths. These tests ensure regressions are caught early.\n\n**Implementation Steps:**\n1. Add `pytest-timeout` to dev dependencies if not present\n2. Create `tests/integration/test_run_exits.py`\n3. Write tests for: Ctrl+C (SIGINT), SIGTERM, budget exhaustion, iteration limit reached, task failure\n4. Each test should verify: clean exit (no crash), status.json updated, run artifact created\n5. Use subprocess to run `cub run` and send signals\n\n**Files:** tests/integration/test_run_exits.py, pyproject.toml", "assignee": null, "labels": ["complexity:medium", "epic:cub-r4h", "model:sonnet", "phase-1", "test"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923515Z", "updated_at": "2026-01-29T20:11:29.876152", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 0, "_old_id": "cub-r4h.2"}
{"id": "cub-s007", "title": "Audit run.py exit paths", "status": "open", "priority": "P0", "issue_type": "task", "description": "Before adding tests, we need to document current behavior. This audit identifies all exit paths and their current artifact-preservation status.\n\n**Implementation Steps:**\n1. Read through `src/cub/cli/run.py` and identify all exit points (return statements, sys.exit, exceptions)\n2. For each exit path, document: trigger condition, whether `write_run_artifact()` is called, whether status is persisted\n3. Identify gaps where artifacts might not be created\n4. Create a markdown document in `.cub/docs/` summarizing findings\n\n**Files:** src/cub/cli/run.py, .cub/docs/run-exit-paths.md", "assignee": null, "labels": ["audit", "complexity:medium", "epic:cub-r4h", "model:sonnet", "phase-1"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923445Z", "updated_at": "2026-01-29T20:11:29.876166", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 0, "_old_id": "cub-r4h.1"}
{"id": "cub-orphan-13", "title": "reliability-phase #2: Circuit Breaker", "status": "open", "priority": "P0", "issue_type": "epic", "description": "Add timeout monitoring to harness execution. If no harness activity for 30 minutes, trip breaker and stop run with clear message. Prevents overnight runs from wasting hours on stuck tasks.", "assignee": null, "labels": ["circuit-breaker", "e5", "phase-2"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:34.004210Z", "updated_at": "2026-01-29T20:11:29.876179", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 0, "_old_id": "cub-r5c"}
{"id": "cub-orphan-14", "title": "reliability-phase #1: Core Loop Hardening", "status": "open", "priority": "P0", "issue_type": "epic", "description": "Verify and strengthen existing exit handling in `cub run`. The foundation is solid\u2014this is primarily testing, documentation, and edge case fixes. Goal: `cub run` exits cleanly on all paths with artifacts preserved.", "assignee": null, "labels": ["e4", "hardening", "phase-1"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:34.004176Z", "updated_at": "2026-01-29T20:11:29.876202", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 0, "_old_id": "cub-r4h"}
{"id": "cub-s008", "title": "Use uv run for all cub self-invocations when dev_mode is active", "status": "open", "priority": "P1", "issue_type": "task", "description": "When dev_mode is true, cub should use 'uv run' to invoke itself everywhere, not just in hook scripts. Currently the hook script (.cub/scripts/hooks/cub-hook.sh) correctly uses 'uv run cub-hooks' in dev mode, but other self-invocation sites use the system-installed cub:\n\n**Already handled:**\n- .cub/scripts/hooks/cub-hook.sh (invoke_python_handler + route compile)\n\n**Needs fixing:**\n- src/cub/cli/delegated/runner.py - delegates to bash cub via subprocess without uv run prefix\n- src/cub/core/sandbox/docker.py - invokes 'cub run' in Docker without dev_mode awareness\n- templates/scripts/cub-hook.sh - template uses 'python -m' instead of dev_mode-aware invocation\n\n**Approach:** Add a utility function (e.g., core/config/runtime.py or similar) that returns the correct command prefix based on dev_mode config. Use it in all Python subprocess invocations of cub. For the delegated runner, prepend 'uv run' when dev_mode is active.", "assignee": null, "labels": [], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T19:38:41.387223-05:00", "updated_at": "2026-01-29T20:11:29.876217", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-yqqf"}
{"id": "cub-s009", "title": "Fix --agent flag: not recognized on cub task ready and other commands", "status": "open", "priority": "P1", "issue_type": "bug", "description": "Running 'cub task ready --agent' fails with 'No such option: --agent'. The AgentFormatter module was built (cub-a1f.1) and wired in (cub-a1f.2), but the --agent flag is not actually recognized by the CLI. Need to investigate whether the flag was never added to the Typer command definitions or if it regressed.", "assignee": null, "labels": [], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T19:29:26.777267-05:00", "updated_at": "2026-01-29T20:11:29.876230", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-t471"}
{"id": "cub-s010", "title": "Manual testing: direct session workflow", "status": "open", "priority": "P1", "issue_type": "task", "description": "The ultimate validation: Marc runs Claude Code directly and verifies the ledger captures work naturally.\n\n**Implementation Steps:**\n1. Create test protocol in `plans/reliability-phase/e6-manual-tests.md`\n2. Scenarios: start direct session, claim task with `cub wip`, do work, complete with `cub done`\n3. Verify: ledger entry created, task status updated, session log captured\n4. Test friction: is the workflow natural? What's awkward?\n5. Document findings and iterate\n\n**Files:** plans/reliability-phase/e6-manual-tests.md", "assignee": null, "labels": ["checkpoint", "complexity:low", "epic:cub-r6s", "model:haiku", "phase-3", "test"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923692Z", "updated_at": "2026-01-29T20:11:29.876243", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 1, "_old_id": "cub-r6s.6"}
{"id": "cub-s011", "title": "Research Claude Code hooks", "status": "open", "priority": "P1", "issue_type": "task", "description": "Understand what hooks Claude Code exposes for artifact capture. This informs whether we can auto-capture or must rely on instructions.\n\n**Implementation Steps:**\n1. Review Claude Code documentation for hooks system\n2. Test available hook events: PreToolUse, PostToolUse, Stop, PermissionRequest\n3. Document payload structure for each relevant event\n4. Identify: can we detect session start/end? Can we capture plan content?\n5. Write findings to `.cub/docs/claude-code-hooks.md`\n\n**Files:** .cub/docs/claude-code-hooks.md", "assignee": null, "labels": ["complexity:medium", "epic:cub-r6s", "model:sonnet", "phase-3", "research"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923670Z", "updated_at": "2026-01-29T20:11:29.876257", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 1, "_old_id": "cub-r6s.4"}
{"id": "cub-s012", "title": "Update cub init for AGENTS.md", "status": "open", "priority": "P1", "issue_type": "task", "description": "`cub init` should create AGENTS.md at project root for cross-harness compatibility.\n\n**Implementation Steps:**\n1. Update `src/cub/cli/init_cmd.py` to call InstructionGenerator\n2. Generate AGENTS.md at project root (not in .cub/)\n3. Generate/update CLAUDE.md at project root\n4. Don't overwrite if files exist (or prompt user)\n5. Add success message mentioning the files created\n\n**Files:** src/cub/cli/init_cmd.py", "assignee": null, "labels": ["cli", "complexity:low", "epic:cub-r6s", "model:sonnet", "phase-3"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923654Z", "updated_at": "2026-01-29T20:11:29.876273", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "low", "model_label": "sonnet", "is_ready": true, "priority_numeric": 1, "_old_id": "cub-r6s.3"}
{"id": "cub-s013", "title": "Implement InstructionGenerator", "status": "open", "priority": "P1", "issue_type": "task", "description": "Generate CLAUDE.md and AGENTS.md with workflow instructions that guide agents to use cub commands.\n\n**Implementation Steps:**\n1. Create `src/cub/core/instructions.py`\n2. Implement `generate_agents_md(project_dir, config)` - harness-agnostic instructions\n3. Implement `generate_claude_md(project_dir, config)` - Claude-specific additions\n4. Include sections: finding tasks (`cub status`), claiming work (`cub wip`), completing (`cub done`), logging (`cub log`)\n5. Include escape hatch language from E5\n6. Make output customizable via config (future: templates)\n\n**Files:** src/cub/core/instructions.py, tests/unit/test_instructions.py", "assignee": null, "labels": ["complexity:medium", "core", "epic:cub-r6s", "model:sonnet", "phase-3"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923641Z", "updated_at": "2026-01-29T20:11:29.876286", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 1, "_old_id": "cub-r6s.2"}
{"id": "cub-s014", "title": "Add \"giving up\" escape hatch to prompts", "status": "open", "priority": "P1", "issue_type": "task", "description": "Complement time-based detection with agent self-awareness. Add instruction letting agents signal when they're stuck.\n\n**Implementation Steps:**\n1. Update `templates/PROMPT.md` with escape hatch section\n2. Add instruction: \"If you are stuck and cannot make progress, output: <stuck>REASON</stuck>\"\n3. Document that this complements (doesn't replace) circuit breaker\n4. Consider: should run.py detect this signal? (Future enhancement, document but don't implement)\n\n**Files:** templates/PROMPT.md", "assignee": null, "labels": ["checkpoint", "complexity:low", "epic:cub-r5c", "model:haiku", "phase-2", "prompt"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923617Z", "updated_at": "2026-01-29T20:11:29.876300", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 1, "_old_id": "cub-r5c.5"}
{"id": "cub-s015", "title": "Add --no-circuit-breaker CLI flag", "status": "open", "priority": "P1", "issue_type": "task", "description": "Users need ability to disable circuit breaker for legitimately long operations.\n\n**Implementation Steps:**\n1. Add `--no-circuit-breaker` flag to `cub run` command\n2. Flag sets `config.circuit_breaker.enabled = False`\n3. Document flag in `cub run --help`\n4. Add example to README showing when to use it\n\n**Files:** src/cub/cli/run.py, README.md", "assignee": null, "labels": ["cli", "complexity:low", "epic:cub-r5c", "model:haiku", "phase-2"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923605Z", "updated_at": "2026-01-29T20:11:29.876320", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 1, "_old_id": "cub-r5c.4"}
{"id": "cub-s016", "title": "Manual testing protocol for E4", "status": "open", "priority": "P1", "issue_type": "task", "description": "Automated tests can't catch everything. Create a checklist for Marc to manually validate exit behavior.\n\n**Implementation Steps:**\n1. Create manual test checklist in `plans/reliability-phase/e4-manual-tests.md`\n2. Include scenarios: overnight run, Ctrl+C at various points, kill -9, budget warning then exhaustion\n3. Document expected behavior and what to check (files created, messages shown)\n4. Include recovery steps if something goes wrong\n\n**Files:** plans/reliability-phase/e4-manual-tests.md", "assignee": null, "labels": ["checkpoint", "complexity:low", "docs", "epic:cub-r4h", "model:haiku", "phase-1"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923553Z", "updated_at": "2026-01-29T20:11:29.876337", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 1, "_old_id": "cub-r4h.4"}
{"id": "cub-orphan-15", "title": "reliability-phase #3: Symbiotic Workflow", "status": "open", "priority": "P1", "issue_type": "epic", "description": "Unified audit trail for direct harness sessions. When users run Claude Code/Codex directly, CLAUDE.md/AGENTS.md instructions + hooks ensure ledger captures equivalent records to `cub run`.", "assignee": null, "labels": ["e6", "phase-3", "symbiotic"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:34.004222Z", "updated_at": "2026-01-29T20:11:29.876352", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-r6s"}
{"id": "cub-s017", "title": "Fix bootstrap: detect ID collisions before import", "status": "open", "priority": "P1", "issue_type": "task", "description": "When bootstrap imports tasks, it silently fails if IDs already exist in the database. The import reports '0 created, 0 updated, N unchanged' with no warning about the collision.\n\n**Root cause**: cmd_bootstrap() in cmd_prep.sh calls bd import without checking for existing IDs first.\n\n**Fix**: Before import, query existing IDs and compare against plan.jsonl. If collisions found, either:\n1. Error with a clear message listing conflicting IDs\n2. Offer --force flag to overwrite\n3. Offer --rename-on-import to use fresh IDs\n\n**Files**: src/cub/bash/lib/cmd_prep.sh (lines 1194-1387)", "assignee": null, "labels": ["bootstrap-fix"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T22:08:19.917655-05:00", "updated_at": "2026-01-29T20:11:29.876408", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-jm48"}
{"id": "cub-s018", "title": "Enable parallel test execution with pytest-xdist", "status": "open", "priority": "P1", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-6jpc"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:55:55.544262-05:00", "updated_at": "2026-01-29T20:11:29.876440", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-4wwm"}
{"id": "cub-s019", "title": "Create contract tests for harness CLIs", "status": "open", "priority": "P1", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-6jpc"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:55:50.349806-05:00", "updated_at": "2026-01-29T20:11:29.876456", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-k5sk"}
{"id": "cub-s020", "title": "Add tests for core/harness/codex.py", "status": "open", "priority": "P1", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-6jpc"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:55:45.154242-05:00", "updated_at": "2026-01-29T20:11:29.876469", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-b305"}
{"id": "cub-s021", "title": "Add tests for core/pr/service.py", "status": "open", "priority": "P1", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-6jpc"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:55:39.963466-05:00", "updated_at": "2026-01-29T20:11:29.876482", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-l6fi"}
{"id": "cub-s022", "title": "Add tests for core/tasks/service.py", "status": "open", "priority": "P1", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-6jpc"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:55:34.770810-05:00", "updated_at": "2026-01-29T20:11:29.876494", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-4laj"}
{"id": "cub-orphan-16", "title": "Phase 2: Coverage Expansion", "status": "open", "priority": "P1", "issue_type": "epic", "description": "", "assignee": null, "labels": [], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:55:24.407514-05:00", "updated_at": "2026-01-29T20:11:29.876506", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 1, "_old_id": "cub-6jpc"}
{"id": "cub-s023", "title": "Add newlines between streamed messages in cub run", "status": "open", "priority": "P2", "issue_type": "task", "description": "When `cub run --stream` is enabled, consecutive messages from the AI harness are concatenated without visual separation, making output difficult to read. Each message should be followed by a newline for clarity.\n\n**Current behavior:**\n```\nRunning claude...\nI'll help you implement...Good! Now let me check...Perfect! Now let me explore...\n```\n\n**Expected behavior:**\n```\nRunning claude...\nI'll help you implement...\n\nGood! Now let me check...\n\nPerfect! Now let me explore...\n```\n\n**Acceptance Criteria:**\n- Each streamed message is followed by a newline character\n- Output remains readable and properly formatted\n- Does not affect non-stream output\n- Works with all harness backends (claude, codex, gemini, etc.)", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:49:00.029599-05:00", "updated_at": "2026-01-29T20:11:29.876518", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-ezpv"}
{"id": "cub-s024", "title": "Add harness and model info to task headline", "status": "open", "priority": "P2", "issue_type": "task", "description": "When starting a task iteration, the headline box should display the harness backend, model, and any other explicitly configured specs alongside the existing task metadata.\n\n**Current behavior:**\nThe headline box shows: Task ID, Title, Priority, Type, Iteration\n\n**Desired behavior:**\nInclude additional configuration details in the headline, such as:\n- Harness backend (e.g., \"claude\", \"gemini\")\n- Model (e.g., \"claude-opus-4.5\", \"gemini-2.0\")\n- Any other explicit specs from the task config or run context\n\n**Acceptance criteria:**\n- [ ] Headline box displays harness backend when available\n- [ ] Headline box displays model name when available\n- [ ] Other explicit specs are included if applicable\n- [ ] Layout remains readable (no excessive line wrapping)\n- [ ] Specs are omitted gracefully if not configured (no \"None\" values displayed)\n- [ ] Changes apply to both `cub run` and direct session contexts", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:48:39.101778-05:00", "updated_at": "2026-01-29T20:11:29.876532", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-wz1m"}
{"id": "cub-s025", "title": "Remove deprecated cub:triage and cub:plan commands", "status": "open", "priority": "P2", "issue_type": "task", "description": "Remove the `cub:triage` and `cub:plan` skill commands from the codebase. These commands are no longer needed and don't require backward compatibility maintenance.\n\n**Changes needed:**\n1. Remove `cub:triage` and `cub:plan` from skill/command templates\n2. Remove these commands from `.claude/commands` configuration\n3. Remove any references or registrations in the codebase that support these skills\n\n**Acceptance criteria:**\n- `cub:triage` and `cub:plan` no longer appear in any templates or configuration files\n- No skill registration or command routing code supports these commands\n- Remaining skills and commands continue to function correctly\n- No broken references to removed commands", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:48:18.010514-05:00", "updated_at": "2026-01-29T20:11:29.876544", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-n57z"}
{"id": "cub-s026", "title": "Ensure plan.json is created at pipeline start, not after orient begins", "status": "open", "priority": "P2", "issue_type": "task", "description": "plan.json is currently first written during the orient stage (after start_stage() is called), rather than when the plan context is initially created. This means if orient fails before that point, there's no plan.json to recover from.\n\n**Current behavior:**\n- PlanContext.create() initializes a Plan object in memory\n- Pipeline runs orient stage, which calls ctx.save_plan() at line 484\n- plan.json is written at that point\n\n**Proposed improvement:**\n- Call ctx.save_plan() immediately after creating or loading the plan context in PipelineConfig.run()\n- Ensures plan.json exists before any stage runs\n- Improves fault tolerance and allows resuming even if orient fails early\n\n**Acceptance criteria:**\n- plan.json is created when plan context is first created\n- plan.json exists before orient stage runs\n- Existing pipeline behavior unchanged (all tests pass)\n- Plan data is accessible for recovery/resumption even if stages fail early", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:47:56.958004-05:00", "updated_at": "2026-01-29T20:11:29.876556", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-rcei"}
{"id": "cub-s027", "title": "Add build failure detection and retry logic to cub pr", "status": "open", "priority": "P2", "issue_type": "task", "description": "The `cub pr` command should monitor PR checks (CI messages, build failures) and automatically retry or re-trigger them after a configurable timeout when failures are detected.\n\n**Context:**\nCurrently, `cub pr` creates a pull request but doesn't actively monitor the status of CI checks and build results. This means failures that could be transient (flaky tests, rate limits, temporary service issues) require manual intervention to retry.\n\n**Requirements:**\n- Monitor PR checks via `gh pr checks` after creating a PR\n- Detect build failures, CI errors, and other check failures\n- When failures are detected, start a 10-minute timer (configurable via flag or config)\n- After timer expires, automatically retry failed checks or re-trigger CI\n- Continue monitoring until checks pass or max retries reached\n- Log all check statuses and retry attempts to session ledger\n- Gracefully handle network errors and API rate limiting\n\n**Acceptance Criteria:**\n- [ ] `cub pr` detects and logs PR check failures\n- [ ] Automatic 10-minute retry timer kicks off when failures detected\n- [ ] `--retry-timeout` flag allows customization (e.g., `--retry-timeout 5m`)\n- [ ] `--no-retry` flag disables auto-retry behavior\n- [ ] Checks are re-triggered via `gh pr checks --rerun` or similar\n- [ ] Session ledger captures retry history with timestamps\n- [ ] Max retries (default 3) prevents infinite loops\n- [ ] Works with both draft and regular PRs", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:47:35.895643-05:00", "updated_at": "2026-01-29T20:11:29.876568", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-tmrm"}
{"id": "cub-s028", "title": "Check completed steps before launching architect in plan run exit", "status": "open", "priority": "P2", "issue_type": "task", "description": "When exiting `cub plan run`, the system should inspect which steps have already been completed in the prep pipeline (triage, architect, plan, bootstrap) instead of automatically launching into architect mode.\n\n**Context:**\nCurrently, when a user exits the plan command, the tool assumes the next step should be architect mode. This breaks the workflow when:\n- Some steps have already been completed\n- The user wants to re-run or skip a particular step\n- Multiple iterations through the pipeline are needed\n\n**Acceptance Criteria:**\n- [ ] Detect which prep steps have been completed (check for artifacts: triage output, architect output, plan.jsonl, beads state)\n- [ ] Display a summary of completed steps before prompting next action\n- [ ] Offer user a choice: continue from next incomplete step, re-run a specific step, or exit\n- [ ] Don't automatically jump to architect if earlier steps are incomplete\n- [ ] Handle partial completion gracefully (e.g., architect started but not finished)", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:47:14.625064-05:00", "updated_at": "2026-01-29T20:11:29.876580", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-zpxr"}
{"id": "cub-s029", "title": "Ensure build-plan sets git upstream on push", "status": "open", "priority": "P2", "issue_type": "task", "description": "When creating a feature branch during build-plan, the upstream tracking should be automatically configured so subsequent `git push` commands work without requiring `--set-upstream`.\n\n**Context:**\nAfter running build-plan and creating a feature branch, users encounter: \"fatal: The current branch has no upstream branch\" when attempting to push. This requires manual intervention with `git push --set-upstream origin <branch>`.\n\n**Acceptance Criteria:**\n- Build-plan creates feature branches with upstream tracking configured (equivalent to `git push -u origin <branch>` on first push)\n- Subsequent `git push` commands work without additional flags\n- Works with both initial branch creation and when pushing existing local branches\n- Alternative: Configure `push.autoSetupRemote = true` in git config as part of `cub init`", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:46:53.533575-05:00", "updated_at": "2026-01-29T20:11:29.876592", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-i4x9"}
{"id": "cub-s030", "title": "Add post-command guidance messages to cub workflow", "status": "open", "priority": "P2", "issue_type": "task", "description": "Improve user experience by providing contextual next-step guidance after key cub commands execute.\n\n**Context:**\nUsers new to cub need clear direction on what to do after running commands. Currently, commands complete silently or with minimal output, leaving users uncertain about the next workflow step.\n\n**Acceptance Criteria:**\n\n1. **`cub init` command**\n   - After successful initialization, display a bulleted list of suggested next steps\n   - Include: creating first capture, running interview, starting first task\n   - Link to relevant documentation or show example commands\n\n2. **`cub capture` command**\n   - After successfully creating a capture, suggest next steps\n   - Recommend: review capture, start interview, organize into spec\n\n3. **`cub spec` command** (if creating new spec)\n   - After spec creation, guide user to next phase\n   - Suggest: detailed requirements, link to parent epic, schedule for planning\n\n4. **General pattern**\n   - Guidance should be concise (3-5 bullet points max)\n   - Include actual command examples users can copy/paste\n   - Use Rich formatting for readability\n   - Respect `--quiet` flag if present (suppress guidance)\n\n**Out of scope:**\n- Changes to existing command behavior\n- New commands beyond what's listed\n- Modifying beads (`bd`) output (it's separate tool)", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:46:32.528118-05:00", "updated_at": "2026-01-29T20:11:29.876604", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-zlfs"}
{"id": "cub-s031", "title": "Fix monitor command to work with beads backend", "status": "open", "priority": "P2", "issue_type": "task", "description": "The `cub monitor` command currently fails with \"No active session found\" error. This appears to be due to changes in the codebase that have shifted from session-based monitoring to task-based execution using the beads backend.\n\n**Context:**\n- `cub monitor` is designed to provide a live dashboard during task execution\n- The error suggests it's looking for an \"active session\" concept that may no longer exist or is stored differently\n- The project now uses beads as the primary task backend\n\n**Acceptance Criteria:**\n- `cub monitor` command executes without error\n- It displays task progress in real-time (or shows appropriate status if no tasks are running)\n- It works with the current beads backend task management system\n- Help text accurately describes what the command does\n\n**Investigation needed:**\n- Check how session state is tracked with beads backend\n- Review what \"active session\" means in current architecture\n- Determine if monitor should show beads task progress or if it needs refactoring for the new task model", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:46:11.486911-05:00", "updated_at": "2026-01-29T20:11:29.876616", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-bets"}
{"id": "cub-s032", "title": "Fix label order comparison in backend divergence checks", "status": "open", "priority": "P2", "issue_type": "task", "description": "The backend divergence detection is comparing task labels as ordered lists, causing false positives when the same labels appear in different orders. This occurs in `close_task()` and `get_task()` operations where the beads backend returns labels in a different order than the in-memory state.\n\n**Context:**\nLabels are semantically unordered and should be compared as sets, not lists. The current list comparison fails when:\n- Beads sorts labels alphabetically: `['complexity:medium', 'core', 'epic:cub-b1a', ...]`\n- In-memory state has different sort order: `['phase-1', 'core', 'refactor', ...]`\n\n**Acceptance Criteria:**\n1. Backend divergence checks compare labels as sets (order-independent)\n2. False positives from label reordering are eliminated\n3. Real divergences (actual label additions/removals) are still detected\n4. No warnings logged when only label order differs\n5. Tests verify set-based comparison with various label orderings", "assignee": null, "labels": ["epic:cub-8av0", "punchlist"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:45:50.519188-05:00", "updated_at": "2026-01-29T20:11:29.876628", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-nejt"}
{"id": "cub-orphan-17", "title": "2026-01-28-assorted Bug Fixes", "status": "open", "priority": "P2", "issue_type": "epic", "description": "Punchlist tasks from: 2026-01-28-assorted-bugs.md\n\nSource: plans/_punchlists/2026-01-28-assorted-bugs.md", "assignee": null, "labels": ["punchlist", "punchlist:2026-01-28-assorted-bugs"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-28T19:45:29.422306-05:00", "updated_at": "2026-01-29T20:11:29.876641", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-8av0"}
{"id": "cub-s033", "title": "Implement hook handlers for artifact capture", "status": "open", "priority": "P2", "issue_type": "task", "description": "Based on hook research, implement handlers to auto-capture artifacts when possible.\n\n**Implementation Steps:**\n1. Create `src/cub/core/harness/hooks.py`\n2. Implement `handle_hook_event(event_type, payload)` dispatcher\n3. For PostToolUse/Write: detect writes to plans/, log to ledger\n4. For Stop: capture session end, finalize any open ledger entries\n5. Parse payloads defensively (malformed \u2192 skip, don't crash)\n6. Create hook scripts for `.cub/hooks/` that call these handlers\n\n**Files:** src/cub/core/harness/hooks.py, .cub/hooks/", "assignee": null, "labels": ["complexity:medium", "epic:cub-r6s", "hooks", "model:sonnet", "phase-3"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-26T21:31:54.923682Z", "updated_at": "2026-01-29T20:11:29.876653", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 2, "_old_id": "cub-r6s.5"}
{"id": "cub-s034", "title": "Add test status badge to README", "status": "open", "priority": "P2", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-ck1z"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:57:54.738546-05:00", "updated_at": "2026-01-29T20:11:29.876667", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-vxg3"}
{"id": "cub-s035", "title": "Add coverage trend gate to CI", "status": "open", "priority": "P2", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-ck1z"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:57:49.523611-05:00", "updated_at": "2026-01-29T20:11:29.876679", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-dsl4"}
{"id": "cub-s036", "title": "Split CI workflow into separate jobs", "status": "open", "priority": "P2", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-ck1z"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:57:44.333093-05:00", "updated_at": "2026-01-29T20:11:29.876691", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-sylz"}
{"id": "cub-orphan-18", "title": "Phase 4: CI Hardening", "status": "open", "priority": "P2", "issue_type": "epic", "description": "", "assignee": null, "labels": [], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:57:33.956036-05:00", "updated_at": "2026-01-29T20:11:29.876703", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-ck1z"}
{"id": "cub-s037", "title": "Add make test-fast target", "status": "open", "priority": "P2", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-e2h9"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:57:02.898015-05:00", "updated_at": "2026-01-29T20:11:29.876719", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-gah6"}
{"id": "cub-s038", "title": "Create pre-commit hook for affected tests", "status": "open", "priority": "P2", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-e2h9"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:56:57.715668-05:00", "updated_at": "2026-01-29T20:11:29.876734", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-bg5k"}
{"id": "cub-s039", "title": "Add pytest-testmon for smart test selection", "status": "open", "priority": "P2", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-e2h9"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:56:52.516256-05:00", "updated_at": "2026-01-29T20:11:29.876749", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-qrnl"}
{"id": "cub-orphan-19", "title": "Phase 3: Smart Local Testing", "status": "open", "priority": "P2", "issue_type": "epic", "description": "", "assignee": null, "labels": [], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:56:42.144734-05:00", "updated_at": "2026-01-29T20:11:29.876761", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-e2h9"}
{"id": "cub-s040", "title": "can remove curb reference in CHANGELOG.md", "status": "open", "priority": "P2", "issue_type": "task", "description": "", "assignee": null, "labels": ["quick-fix"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-16T21:25:17.751722-05:00", "updated_at": "2026-01-29T20:11:29.876773", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 2, "_old_id": "cub-3bx"}
{"id": "cub-s041", "title": "Add cub upgrade command for pipx-based updates", "status": "open", "priority": "P2", "issue_type": "task", "description": "## Context\nWith the hybrid CLI installed via pipx, users need an easy way to upgrade to new releases.\n\n## Implementation\nAdd `cub upgrade` command that:\n1. Detects installation method (pipx, pip --user, editable)\n2. For pipx: runs `pipx upgrade cub` or reinstall from tag\n3. Shows current vs available version\n4. Supports `--version X.Y.Z` to install specific version\n\n## Example Usage\n```bash\ncub upgrade              # Upgrade to latest release\ncub upgrade --version 0.23.2  # Install specific version\ncub upgrade --check      # Just show if update available\n```\n\n## Files\n- src/cub/cli/upgrade.py (new)\n- src/cub/cli/__init__.py (register command)", "assignee": null, "labels": ["complexity:low", "enhancement"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-15T10:44:33.816090-05:00", "updated_at": "2026-01-29T20:11:29.876785", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 2, "_old_id": "cub-ht4"}
{"id": "cub-s042", "title": "Add performance regression tests", "status": "open", "priority": "P3", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-i8b6"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:58:46.612153-05:00", "updated_at": "2026-01-29T20:11:29.876823", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 3, "_old_id": "cub-d0z5"}
{"id": "cub-s043", "title": "Add Docker integration tests for sandbox", "status": "open", "priority": "P3", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-i8b6"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:58:41.422467-05:00", "updated_at": "2026-01-29T20:11:29.876843", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 3, "_old_id": "cub-rr7p"}
{"id": "cub-s044", "title": "Add Hypothesis property-based tests", "status": "open", "priority": "P3", "issue_type": "task", "description": "", "assignee": null, "labels": ["epic:cub-i8b6"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:58:36.212716-05:00", "updated_at": "2026-01-29T20:11:29.876855", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 3, "_old_id": "cub-jwm1"}
{"id": "cub-orphan-20", "title": "Phase 5: Refinement", "status": "open", "priority": "P3", "issue_type": "epic", "description": "", "assignee": null, "labels": [], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-18T21:58:25.819537-05:00", "updated_at": "2026-01-29T20:11:29.876870", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": null, "model_label": null, "is_ready": true, "priority_numeric": 3, "_old_id": "cub-i8b6"}
{"id": "cub-s045", "title": "Fix tree-sitter test dependencies so test_map_code_intel passes", "status": "closed", "priority": "P2", "issue_type": "bug", "description": "", "assignee": null, "labels": [], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-01-29T20:18:12.585837", "updated_at": "2026-01-29T20:46:24.410953", "closed_at": "2026-01-29T20:46:24.410926", "acceptanceCriteria": [], "notes": "[Closed: 2026-01-29T20:46:24.410959] Already fixed: tree-sitter-language-pack is declared in pyproject.toml and all test_map_code_intel tests pass (5093 passed, 0 failures)", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-001"}
{"id": "cub-orphan-21", "title": "2026 02 03", "status": "closed", "priority": "P2", "issue_type": "epic", "description": "Punchlist tasks from: 2026-02-03.md", "assignee": null, "labels": ["punchlist", "punchlist:2026-02-03"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-02-03T22:12:53.634542", "updated_at": "2026-02-04T08:49:54.280853", "closed_at": "2026-02-04T08:49:54.280847", "acceptanceCriteria": [], "notes": "[Closed: 2026-02-04T08:49:54.280855] All tasks completed", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44"}
{"id": "cub-orphan-21.1", "title": "Fix statusline to support JSONL task backend", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The statusline script hardcodes reading task counts from the Beads backend (`.beads/issues.jsonl`) and ignores the JSONL backend (`.cub/tasks.jsonl`). This causes projects using the JSONL backend to show 0/0/0 task counts in their statusline, providing no visibility into task progress. The fix should detect the available backend at runtime using the same logic as the core tasks module, ensuring statusline works consistently across both backends.\n\n**Implementation Steps:**\n1. Examine `src/cub/core/tasks/backend.py` to understand the `get_backend()` detection logic and how it determines which backend is available\n2. Review `templates/scripts/statusline.py` line 35 and surrounding code to understand the current hardcoded Beads path\n3. Import or replicate the backend detection logic in statusline.py\n4. Update the task count reading code to use the detected backend instead of hardcoding `.beads/issues.jsonl`\n5. Test with both Beads and JSONL backends to verify task counts display correctly", "assignee": "cub-20260203-221403", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.664509", "updated_at": "2026-02-03T22:21:55.120494", "closed_at": "2026-02-03T22:21:55.120463", "acceptanceCriteria": ["Statusline detects and reads from JSONL backend (`.cub/tasks.jsonl`) when Beads backend is not available", "Statusline still reads from Beads backend (`.beads/issues.jsonl`) when it exists", "Task counts display correctly (non-zero) for projects using JSONL backend", "No existing Beads backend functionality is broken", "Detection logic matches the approach used in `cub.core.tasks.backend.get_backend()`"], "notes": "[Closed: 2026-02-03T22:21:55.120498] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.1"}
{"id": "cub-orphan-21.2", "title": "Add explicit project_id to prevent task ID prefix collisions", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The current `_get_prefix()` method in jsonl.py derives task ID prefixes from the first 3 characters of the project directory name, causing collisions when multiple projects share the same prefix (e.g., both \"cub\" and \"cub-roundabout\" get prefix \"cub\"). This results in task IDs like `cub-a1x` in the roundabout project instead of the intended `rou-a1x`, making task IDs non-unique across projects. The fix requires adding an explicit `project_id` setting to `.cub/config.json` that persists a unique prefix, with `cub init` prompting users to set or auto-generating one if not provided.\n\n**Implementation Steps:**\n1. Modify `.cub.json` template to include a `project_id` field with a unique prefix (auto-generated if not provided during init)\n2. Update `src/cub/cli/init_cmd.py` to prompt for or auto-generate a project_id during initialization, ensuring uniqueness\n3. Update `src/cub/core/tasks/jsonl.py::_get_prefix()` to read the project_id from config instead of deriving from directory name\n4. Update config loading in `src/cub/core/config/loader.py` to handle the new `project_id` field\n5. Add migration logic to detect old projects without `project_id` and auto-populate based on directory name on first use\n6. Update tests to verify prefix comes from config, not directory name", "assignee": "cub-20260203-221403", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.664711", "updated_at": "2026-02-03T22:31:17.455983", "closed_at": "2026-02-03T22:31:17.455978", "acceptanceCriteria": ["`cub init` prompts for or auto-generates unique `project_id` and stores it in `.cub/config.json`", "Task IDs use the configured `project_id` prefix instead of directory name", "Existing projects without `project_id` migrate gracefully on first use", "Multiple projects with overlapping names (e.g., \"cub\" and \"cub-roundabout\") get distinct task ID prefixes", "All tests pass and cover prefix generation from config vs. directory name scenarios"], "notes": "[Closed: 2026-02-03T22:31:17.455986] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.2"}
{"id": "cub-orphan-21.3", "title": "Consolidate AGENTS.md and CLAUDE.md into single source", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The `cub init` command currently generates both AGENTS.md and CLAUDE.md as separate files with identical content, creating maintenance burden and risk of drift. This violates DRY principle and causes confusion about which file is canonical. The solution is to generate CLAUDE.md as the single source of truth and create AGENTS.md as a symlink, ensuring consistency across the codebase and simplifying future updates.\n\n**Implementation Steps:**\n1. Examine current implementation in `src/cub/cli/init_cmd.py` and `src/cub/core/instructions.py` to understand how both files are currently generated\n2. Modify `src/cub/core/instructions.py` to have a single template/function that generates CLAUDE.md content\n3. Update `src/cub/cli/init_cmd.py` to write CLAUDE.md and create AGENTS.md as a symlink pointing to CLAUDE.md instead of generating duplicate content\n4. Handle edge cases: Windows (symlinks require admin/developer mode), existing files (backup if needed), and git tracking (ensure .gitignore doesn't prevent symlink tracking)\n5. Add tests to verify symlink creation and content consistency between the two logical references", "assignee": "cub-20260203-221403", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.664762", "updated_at": "2026-02-03T22:44:29.278516", "closed_at": "2026-02-03T22:44:29.278510", "acceptanceCriteria": ["CLAUDE.md is generated with full content from single source", "AGENTS.md exists as symlink to CLAUDE.md (not duplicate file)", "`cub init` creates both files without errors on Linux/macOS", "Symlink points to correct relative path (readable from `.cub/` directory)", "Existing tests pass and no duplicate content generation remains", "Documentation updated to reflect CLAUDE.md as canonical file"], "notes": "Consolidated AGENTS.md and CLAUDE.md into single source. CLAUDE.md is now the canonical instruction file, and AGENTS.md is created as a symlink to it. Added create_agents_symlink() function, updated generate_instruction_files() to use symlinks, and updated tests.\n\n[Closed: 2026-02-03T22:44:29.278519] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.3"}
{"id": "cub-orphan-21.4", "title": "Consolidate runloop.md and PROMPT.md initialization", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The project creates two overlapping system prompt files during init (`.cub/runloop.md` and `.cub/prompt.md`), creating confusion about their purpose and proper usage. The runloop.md contains core loop instructions while PROMPT.md is a larger template with customization guidance. This dual-file approach leads to unclear ownership: cub stage should not modify prompt.md, but instead plan-level context should be injected at runtime. Clear separation between system-managed core runloop instructions and user-customizable additions is needed to prevent improper file mutations and enable proper prompt composition.\n\n**Implementation Steps:**\n1. Audit current usage: Review how init_cmd.py creates both files, how prompt.md is generated, and where prompt.md is referenced/mutated (especially in cub stage)\n2. Define file roles: Establish that `runloop.md` = system-managed core loop instructions (immutable by features), `prompt.md` = user-customizable additions or consider removal if redundant\n3. Create plan-level context: Introduce pattern for capturing plan-scoped system context (e.g., `plan-prompt-context.md` in plan directories) that gets injected at runtime rather than persisted globally\n4. Update init_cmd.py: Create only the primary file (runloop.md), remove prompt.md generation unless there's clear use case for user customization zone\n5. Remove prompt.md mutations: Audit codebase for code that writes to prompt.md (especially cub stage) and replace with plan-directory context mechanism\n6. Update CLAUDE.md: Document final file structure, roles, and context composition hierarchy (system runloop \u2192 user prompt.md if kept \u2192 plan context at runtime)", "assignee": "cub-20260203-221403", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.664812", "updated_at": "2026-02-03T22:59:23.201488", "closed_at": "2026-02-03T22:59:23.201480", "acceptanceCriteria": ["Only one system prompt template file is generated during init (runloop.md, clearly labeled for system use)", "Prompt.md is either removed or explicitly designated as user-customizable zone with clear ownership", "No code writes to prompt.md during feature/stage execution (context composition happens at runtime instead)", "Plan-level context follows a standard pattern (e.g., `plans/<name>/prompt-context.md`) that is injected into harness sessions", "CLAUDE.md section on \"Context Composition\" clearly explains: system runloop \u2192 optional user additions \u2192 plan context grafting at runtime", "All tests pass and init command still generates functional system prompts"], "notes": "[Closed: 2026-02-03T22:59:23.201491] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.4"}
{"id": "cub-orphan-21.5", "title": "Consolidate config files into single .cub/config.json", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The project has two config files with overlapping purposes: `.cub.json` (project root) for user settings like harness and budget, and `.cub/config.json` (internal state) for dev_mode flags. This split is confusing for users who don't know which file to edit. Consolidating all config into `.cub/config.json` simplifies the mental model, reduces maintenance burden, and makes configuration self-discoverable in the `.cub/` directory structure.\n\n**Implementation Steps:**\n1. Audit current config usage in `src/cub/core/config/loader.py` to identify all fields in `.cub.json` and `.cub/config.json`, document which are user-facing vs internal\n2. Design unified config schema in `.cub/config.json` with clear separation between user settings (harness, budget, state checks) and internal state (dev_mode, etc.) via top-level sections\n3. Update `src/cub/cli/init_cmd.py` to write all config to `.cub/config.json` and stop creating `.cub.json`\n4. Update `src/cub/core/config/loader.py` to read from `.cub/config.json` with fallback to `.cub.json` for backwards compatibility, issue deprecation warning if `.cub.json` is found\n5. Update template in `src/cub/templates/.cub.json` to add migration note or convert to `.cub/config.json` template\n6. Add migration logic to detect existing `.cub.json` files and warn users to run `cub init` to consolidate\n7. Write tests for backwards-compatible config loading and deprecation warnings\n8. Update CLAUDE.md documentation to explain the consolidated config structure", "assignee": "cub-20260203-221403", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.664857", "updated_at": "2026-02-03T23:12:44.556501", "closed_at": "2026-02-03T23:12:44.556496", "acceptanceCriteria": ["All config read/write operations use `.cub/config.json` as primary location", "`.cub.json` is read for backwards compatibility with deprecation warning logged", "`cub init` creates only `.cub/config.json`, no `.cub.json`", "Unified config schema documented with clear user vs internal sections", "Migration path works: existing `.cub.json` projects are readable and warned to consolidate", "All tests pass including new backwards-compatibility tests", "mypy passes in strict mode", "CLAUDE.md updated with config structure and consolidation rationale"], "notes": "Consolidated config files into single .cub/config.json. Updated loader.py with backwards compatibility fallback to .cub.json with deprecation warning. Updated init_cmd.py to write all config to .cub/config.json and migrate from legacy location. Added new tests for backwards compatibility. Updated CLAUDE.md with configuration documentation.\n\n[Closed: 2026-02-03T23:12:44.556504] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.5"}
{"id": "cub-orphan-21.6", "title": "Enhance agent.md template with richer cub workflow documentation", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The current `templates/agent.md` provides functional setup instructions but lacks comprehensive guidance for developers using cub effectively during sessions. It misses quick-start workflows, common command patterns, troubleshooting resources, and pointers to diagnostic tools like hook logs. Enriching this template will improve developer experience by providing self-contained guidance within each project's agent context, reducing friction when switching between projects and enabling better autonomous coding sessions.\n\n**Implementation Steps:**\n1. Review current `templates/agent.md` and identify gaps in workflow guidance\n2. Add a \"Quick Start Workflow\" section covering task discovery, claiming, and completion patterns\n3. Add a \"Common Command Patterns\" section with practical examples of cub task, status, and suggest commands\n4. Add a \"Troubleshooting\" section including hook verification, forensics log locations (.cub/ledger/forensics/), and common issues\n5. Add a \"Reading Task Output\" section explaining task metadata, blockers, and dependencies\n6. Add cross-references to full documentation with @.cub/agent.md links and cub docs pointers\n7. Ensure template preserves the existing structure and remains under ~500 lines total\n8. Test that generated CLAUDE.md files in new projects include the enhanced content", "assignee": "cub-20260203-221403", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.664897", "updated_at": "2026-02-03T23:16:44.313773", "closed_at": "2026-02-03T23:16:44.313767", "acceptanceCriteria": ["Template includes a \"Quick Start Workflow\" section with 3-5 key steps for claiming and completing tasks", "Template includes \"Common Command Patterns\" with at least 5 real-world command examples", "Template includes \"Troubleshooting\" section with hook verification and forensics log location (.cub/ledger/forensics/)", "Template includes \"Reading Task Output\" section explaining task metadata interpretation", "All sections reference external docs or .cub/ files appropriately using @-syntax", "Template remains well-organized and under ~500 lines (excluding existing architecture sections)", "Generated CLAUDE.md files in new projects (`cub new`) include the enhanced content", "mypy and ruff pass with no changes needed to template file itself"], "notes": "[Closed: 2026-02-03T23:16:03.897918] Enhanced templates/agent.md with Quick Start Workflow, Common Command Patterns, Troubleshooting, Reading Task Output sections, and cross-references to documentation. Template is 283 lines (under 500 limit). All acceptance criteria met.\n\n[Closed: 2026-02-03T23:16:44.313775] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.6"}
{"id": "cub-orphan-21.7", "title": "Expand constitution.md template with principles and examples", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The constitution.md template currently provides minimal guidance, making it difficult for projects to establish meaningful engineering principles. This feature adds detailed principle examples, code pattern comparisons (good vs. bad), and step-by-step customization guidance so projects can create constitutions aligned with their specific values and constraints.\n\n**Implementation Steps:**\n1. Read the current constitution.md template to understand its structure\n2. Expand the principles section with 4-5 example principles (testing, performance, security, documentation, collaboration) including descriptions and rationale\n3. Add \"Good Pattern vs. Bad Pattern\" subsections showing concrete code examples for each principle\n4. Create a \"Customizing for Your Project\" section with step-by-step guidance on identifying and defining custom principles\n5. Add an \"Anti-patterns to Avoid\" section documenting common pitfalls when establishing engineering culture\n6. Include a \"Living Document\" section explaining how to evolve the constitution over time\n7. Verify template formatting, ensure markdown is valid, and check for clarity", "assignee": "cub-20260203-221403", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.664938", "updated_at": "2026-02-03T23:16:58.433427", "closed_at": "2026-02-03T23:29:12.268378", "acceptanceCriteria": ["Template contains at least 4 detailed example principles with rationale", "Each example principle includes a \"Good Pattern\" and \"Bad Pattern\" code example", "\"Customizing for Your Project\" section provides 3+ concrete customization steps", "Template includes guidance on anti-patterns and common mistakes", "All changes are backwards compatible (existing constitution.md files still valid)", "Template is under 500 lines and remains readable and not overwhelming", "No broken markdown links or formatting issues"], "notes": "", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.7"}
{"id": "cub-orphan-21.8", "title": "Create cub:stage skill template", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The `cub stage` command exists in the CLI but lacks a corresponding skill definition in `templates/commands/`. Without this file, the skill won't appear in the skill list and users can't invoke it via `/stage`. This is a documentation/discoverability gap that prevents users from easily accessing the stage command through the skill interface.\n\n**Implementation Steps:**\n1. Research the `cub stage` command implementation to understand its purpose, arguments, and behavior\n2. Examine existing skill templates in `templates/commands/` to understand the expected format and structure\n3. Create `src/cub/templates/commands/cub:stage.md` following the established skill template pattern\n4. Document the command's purpose, usage examples, and any relevant flags or options\n5. Verify the skill file is properly formatted and references the correct CLI command", "assignee": "cub-20260204-081646", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.664996", "updated_at": "2026-02-04T08:24:00.272013", "closed_at": "2026-02-04T08:24:00.271988", "acceptanceCriteria": ["`src/cub/templates/commands/cub:stage.md` file created with complete skill definition", "Skill template follows the same format and structure as other command skills", "Skill description accurately represents the `cub stage` command functionality", "Documentation includes purpose, syntax, examples, and relevant options", "Skill can be invoked via `/stage` and appears in skill list when available"], "notes": "[Closed: 2026-02-04T08:24:00.272016] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.8"}
{"id": "cub-orphan-21.9", "title": "Document hook forensics location and add log viewing", "status": "closed", "priority": "P2", "issue_type": "task", "description": "Hook forensics are written to `.cub/ledger/forensics/{session_id}.jsonl` but users have no way to discover this location or view recent activity. This makes troubleshooting sessions difficult and leaves the feature undocumented. Adding clear documentation to the agent.md template and a `cub hooks log` command to view recent forensics would improve discoverability and usability of the symbiotic workflow feature.\n\n**Implementation Steps:**\n1. Add \"Hook Forensics Location\" section to the Symbiotic Workflow documentation in agent.md, explaining the forensics JSONL format, location, and example contents\n2. Document the forensics JSONL schema (event types, fields, timestamps) so users understand what data is captured\n3. Implement `cub hooks log` command in src/cub/cli/hooks.py to display recent hook events with options for filtering by session, event type, and time range\n4. Add usage examples to agent.md showing how to use `cub hooks log` for troubleshooting", "assignee": "cub-20260204-081646", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.665035", "updated_at": "2026-02-04T08:31:05.915185", "closed_at": "2026-02-04T08:31:05.915178", "acceptanceCriteria": ["agent.md documents the exact path where forensics are stored (`.cub/ledger/forensics/{session_id}.jsonl`)", "agent.md includes example forensics JSONL showing 3-4 event types (session_start, file_write, task_claim, session_end)", "`cub hooks log` command exists and displays recent forensics entries with timestamps and event details", "`cub hooks log` supports `--session <id>` flag to filter by specific session", "`cub hooks log` supports `--limit <n>` flag to show last N events (default 20)", "Help text and docstrings clearly explain forensics are auto-generated by hooks and not user-editable", "Troubleshooting section in agent.md references `cub hooks log` as a diagnostic tool"], "notes": "[Closed: 2026-02-04T08:45:00.000000] Completed by autonomous execution\n\n[Closed: 2026-02-04T08:31:05.915188] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.9"}
{"id": "cub-orphan-21.10", "title": "Fix plan.json generation through planning pipeline", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The planning workflow (`cub plan orient`, `cub plan architect`, `cub plan itemize`) fails to properly generate and update plan.json at each phase, breaking the downstream `cub stage` command which depends on reading a complete plan.json file. This blocks the entire planning-to-tasks pipeline. The issue spans multiple phases and requires auditing each command to ensure plan.json is created on first phase, updated by subsequent phases, and in a format that `cub stage` can consume.\n\n**Implementation Steps:**\n1. Audit `cub plan orient` command to ensure it creates `.cub/sessions/{session}/plan.json` with orient-phase output\n2. Audit `cub plan architect` command to ensure it reads the existing plan.json and appends/updates architect-phase output\n3. Audit `cub plan itemize` command to ensure it reads the existing plan.json and appends/updates itemize-phase output\n4. Verify plan.json schema is consistent and readable by `cub stage` at each phase\n5. Add integration test covering the full pipeline: orient \u2192 architect \u2192 itemize \u2192 stage\n6. Fix any serialization, path resolution, or state accumulation bugs discovered", "assignee": "cub-20260204-081646", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.665069", "updated_at": "2026-02-04T08:36:29.383647", "closed_at": "2026-02-04T08:36:29.383637", "acceptanceCriteria": ["`cub plan orient` creates `.cub/sessions/{session}/plan.json` with valid output", "`cub plan architect` reads and updates plan.json without losing orient data", "`cub plan itemize` reads and updates plan.json without losing previous phase data", "`cub stage` successfully reads plan.json and imports tasks after full pipeline", "plan.json schema is documented and validated at each phase", "Full pipeline integration test passes (orient \u2192 architect \u2192 itemize \u2192 stage)"], "notes": "[Closed: 2026-02-04T08:36:29.383651] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.10"}
{"id": "cub-orphan-21.11", "title": "Set explicit backend in cub init instead of auto-detection", "status": "closed", "priority": "P2", "issue_type": "task", "description": "Currently, `cub init` relies on auto-detection to determine the task backend, which checks for `.beads/` before `.cub/tasks.jsonl`. This can lead to unexpected behavior when both directories exist or when the detection order doesn't match user intent. By explicitly setting `backend.mode` in the config during initialization, we ensure predictable and transparent backend selection. This also makes it easier for users to understand and modify their backend choice later.\n\n**Implementation Steps:**\n1. Read the current `init_cmd.py` implementation to understand the config writing logic\n2. Modify the initialization to write an explicit `\"backend\": {\"mode\": \"jsonl\"}` to the config (or prompt user to choose between available backends)\n3. Update config model validation to accept and respect the explicit `backend.mode` setting\n4. Verify that downstream code respects the explicit setting over auto-detection\n5. Test that `cub init` correctly sets the backend and subsequent commands use the configured backend\n6. Update documentation/comments to reflect that backend is now explicitly configured", "assignee": "cub-20260204-081646", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.665105", "updated_at": "2026-02-04T08:43:19.917563", "closed_at": "2026-02-04T08:43:19.917557", "acceptanceCriteria": ["`cub init` writes `\"backend\": {\"mode\": \"jsonl\"}` (or user-selected mode) to config", "Config model validation accepts and preserves the explicit `backend.mode` setting", "Backend loading logic respects explicit config setting over auto-detection", "All existing tests pass; add tests verifying explicit backend configuration", "Running `cub init` followed by `cub task list` uses the configured backend, not auto-detection"], "notes": "[Closed: 2026-02-04T13:42:54.717600] Completed by autonomous execution\n\n[Closed: 2026-02-04T08:43:19.917567] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.11"}
{"id": "cub-orphan-21.12", "title": "Preserve user-modified prompt.md on init", "status": "closed", "priority": "P2", "issue_type": "task", "description": "The `cub init` command currently overwrites prompt.md unconditionally, destroying user customizations. Since prompt.md is intended to be user-customizable (as documented in CLAUDE.md's context composition section), this breaks the workflow where users tailor the autonomous coding experience for their project. The fix should detect when prompt.md has been modified and either skip overwriting it or prompt the user to choose.\n\n**Implementation Steps:**\n1. Read the template prompt.md from the package templates directory\n2. Check if prompt.md already exists in the project root\n3. If it exists, compare the user's version with the template version (byte-for-byte or hash-based comparison)\n4. If they differ, either: (a) skip the write with a log message, or (b) prompt the user with options to keep/replace/review\n5. Only write the template if the file doesn't exist or the user explicitly approves overwriting\n6. Add clear logging to indicate which action was taken (skipped, wrote, or prompted)", "assignee": "cub-20260204-081646", "labels": ["punchlist"], "dependsOn": [], "blocks": [], "parent": "cub-orphan-21", "created_at": "2026-02-03T22:12:53.665141", "updated_at": "2026-02-04T08:49:54.265504", "closed_at": "2026-02-04T08:49:54.265499", "acceptanceCriteria": ["prompt.md is not overwritten if it exists and differs from the template", "User is informed when prompt.md is skipped (log message or prompt)", "User can choose to overwrite if prompted (e.g., via `--force` flag or interactive prompt)", "prompt.md is still created on first init (file doesn't exist yet)", "All changes tested with pytest (existing tests updated if needed)", "mypy passes with no errors", "Documentation in CLAUDE.md accurately reflects the behavior"], "notes": "[Closed: 2026-02-04T13:49:14.406266] Completed by autonomous execution\n\n[Closed: 2026-02-04T08:49:54.265506] Completed by autonomous execution", "complexity_label": null, "model_label": null, "is_ready": false, "priority_numeric": 2, "_old_id": "cub-t44.12"}
{"id": "cub-048a-0", "title": "ledger-consolidation #1: ID System Foundation", "status": "closed", "priority": "P0", "issue_type": "epic", "description": "Establish the hierarchical ID generation system with counter-based allocation tracked on the sync branch. This is the foundation that all other phases depend on.", "assignee": null, "labels": ["phase-1", "complexity:high", "slice:id-system"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-02-04T15:37:04.553985", "updated_at": "2026-02-04T16:18:37.460806", "closed_at": "2026-02-04T16:18:37.460801", "acceptanceCriteria": [], "notes": "[Closed: 2026-02-04T16:18:37.460808] All tasks completed", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-1", "title": "ledger-consolidation #2: Ledger Consolidation", "status": "closed", "priority": "P0", "issue_type": "epic", "description": "Unify all storage into a single `.cub/ledger/` structure with `by-task/`, `by-epic/`, `by-plan/`, and `by-run/` subdirectories. Convert harness logs to JSONL and flatten the attempts/ directory structure.", "assignee": null, "labels": ["phase-2", "complexity:high", "slice:ledger"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-02-04T15:37:04.554078", "updated_at": "2026-02-04T16:50:01.604673", "closed_at": "2026-02-04T16:50:01.604669", "acceptanceCriteria": [], "notes": "[Closed: 2026-02-04T16:50:01.604675] All tasks completed", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-2", "title": "ledger-consolidation #3: Run Loop Integration", "status": "closed", "priority": "P0", "issue_type": "epic", "description": "Integrate the new ID system and consolidated ledger into the run loop. Add `--plan` flag to `cub run` and remove the separate `build-plan` command.", "assignee": null, "labels": ["phase-3", "complexity:high", "slice:run-loop"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-02-04T15:37:04.554112", "updated_at": "2026-02-04T17:09:30.435105", "closed_at": "2026-02-04T17:09:30.435100", "acceptanceCriteria": [], "notes": "[Closed: 2026-02-04T17:09:30.435107] All tasks completed", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-3", "title": "ledger-consolidation #4: Lifecycle Hooks", "status": "closed", "priority": "P1", "issue_type": "epic", "description": "Extend the hooks infrastructure with four new lifecycle events: pre-session, end-of-task, end-of-epic, end-of-plan. Each provides rich context for user-defined scripts.", "assignee": null, "labels": ["phase-4", "complexity:medium", "slice:hooks"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-02-04T15:37:04.554142", "updated_at": "2026-02-04T17:28:15.434159", "closed_at": "2026-02-04T17:28:15.434154", "acceptanceCriteria": [], "notes": "[Closed: 2026-02-04T17:28:15.434161] All tasks completed", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-048a-4", "title": "ledger-consolidation #5: New Commands", "status": "open", "priority": "P1", "issue_type": "epic", "description": "Implement five new commands: `release`, `retro`, `verify`, `learn extract`, and `sync agent`. Each has a service layer and CLI interface.", "assignee": null, "labels": ["phase-5", "complexity:medium", "slice:commands"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-02-04T15:37:04.554164", "updated_at": "2026-02-04T15:37:04.554165", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 1}
{"id": "cub-048a-5", "title": "ledger-consolidation #6: Consistency Checks & Cleanup", "status": "open", "priority": "P1", "issue_type": "epic", "description": "Add integrity checks to `cub doctor` and `cub run`, remove deprecated code paths, and finalize documentation.", "assignee": null, "labels": ["phase-6", "complexity:low", "slice:cleanup"], "dependsOn": [], "blocks": [], "parent": null, "created_at": "2026-02-04T15:37:04.554327", "updated_at": "2026-02-04T15:37:04.554329", "closed_at": null, "acceptanceCriteria": [], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 1}
{"id": "cub-048a-0.1", "title": "Create core/ids/ package with ID models", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The ID models are the foundation of the hierarchical ID system. They provide type-safe representations of spec, plan, epic, task, and standalone IDs with validation and string conversion.\n\n**Implementation Steps:**\n1. Create `src/cub/core/ids/` directory with `__init__.py`\n2. Create `models.py` with Pydantic models: `SpecId`, `PlanId`, `EpicId`, `TaskId`, `StandaloneTaskId`\n3. Implement `__str__` methods for each model following the format spec\n4. Add validation for letter/char fields (A-Z, a-z, 0-9 sequences)\n5. Export public API from `__init__.py`\n\n**Files:** `src/cub/core/ids/__init__.py`, `src/cub/core/ids/models.py`", "assignee": "cub-20260204-153949", "labels": ["phase-1", "model:sonnet", "complexity:medium", "domain:model"], "dependsOn": [], "blocks": [], "parent": "cub-048a-0", "created_at": "2026-02-04T15:37:04.560490", "updated_at": "2026-02-04T15:45:34.230535", "closed_at": "2026-02-04T15:45:34.230524", "acceptanceCriteria": ["All five ID models implemented with proper validation", "`str(SpecId(project=\"cub\", number=54))` returns `\"cub-054\"`", "`str(TaskId(...))` returns `\"cub-054A-0.1\"` format", "Invalid letter/char values raise ValidationError", "Models are immutable (frozen=True)"], "notes": "[Closed: 2026-02-04T15:45:34.230539] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-0.2", "title": "Implement ID parser and validator", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The parser converts string IDs back to typed models and validates format. This enables working with IDs from task files, ledger entries, and user input.\n\n**Implementation Steps:**\n1. Create `src/cub/core/ids/parser.py`\n2. Define regex patterns for each ID type (spec, plan, epic, task, standalone)\n3. Implement `parse_id(id_str: str) -> SpecId | PlanId | EpicId | TaskId | StandaloneTaskId`\n4. Implement `validate_id(id_str: str) -> bool` for quick format checking\n5. Implement `get_id_type(id_str: str) -> Literal[\"spec\", \"plan\", \"epic\", \"task\", \"standalone\"] | None`\n6. Implement `get_parent_id(id_str: str) -> str | None` to extract parent from hierarchy\n7. Handle backward compatibility with old random IDs (detect and pass through)\n\n**Files:** `src/cub/core/ids/parser.py`", "assignee": "cub-20260204-153949", "labels": ["phase-1", "model:sonnet", "complexity:medium", "domain:logic"], "dependsOn": [], "blocks": ["cub-048a-0.3", "cub-048a-0.4"], "parent": "cub-048a-0", "created_at": "2026-02-04T15:37:04.560534", "updated_at": "2026-02-04T15:58:15.343603", "closed_at": "2026-02-04T15:58:15.343600", "acceptanceCriteria": ["`parse_id(\"cub-054\")` returns `SpecId(project=\"cub\", number=54)`", "`parse_id(\"cub-054A-0.1\")` returns fully nested `TaskId` with parent chain", "`get_parent_id(\"cub-054A-0.1\")` returns `\"cub-054A-0\"`", "Old random IDs like `cub-k7m` are detected but not parsed (return None or raise)", "Invalid formats raise `ValueError` with descriptive message"], "notes": "[Closed: 2026-02-04T15:58:15.343606] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-0.3", "title": "Implement counter management on sync branch", "status": "closed", "priority": "P0", "issue_type": "task", "description": "Counters track the next available spec number and standalone task number. They live on the sync branch to enable collision-free allocation across worktrees. This integrates with the existing sync branch infrastructure.\n\n**Implementation Steps:**\n1. Add `CounterState` model to `src/cub/core/sync/models.py`\n2. Create `src/cub/core/ids/counters.py` for counter operations\n3. Implement `read_counters(sync_service: SyncService) -> CounterState`\n4. Implement `allocate_spec_number(sync_service: SyncService) -> int` with optimistic locking\n5. Implement `allocate_standalone_number(sync_service: SyncService) -> int`\n6. Handle case where counters.json doesn't exist (initialize with defaults)\n7. Implement retry logic for concurrent allocation conflicts\n\n**Files:** `src/cub/core/sync/models.py`, `src/cub/core/ids/counters.py`", "assignee": "cub-20260204-153949", "labels": ["phase-1", "model:opus", "complexity:high", "domain:logic", "risk:medium"], "dependsOn": [], "blocks": ["cub-048a-0.4"], "parent": "cub-048a-0", "created_at": "2026-02-04T15:37:04.560556", "updated_at": "2026-02-04T16:05:42.440799", "closed_at": "2026-02-04T16:05:42.440796", "acceptanceCriteria": ["`CounterState` model has `spec_number`, `standalone_task_number`, `updated_at`", "`allocate_spec_number()` increments counter and commits to sync branch", "Concurrent allocations don't produce duplicate numbers", "Missing counters.json is auto-initialized", "Counter reads don't require network (use local sync branch state)"], "notes": "[Closed] Implemented counter management on sync branch with CounterState model, read_counters, allocate_spec_number, and allocate_standalone_number functions. All 102 tests pass.\n\n[Closed: 2026-02-04T16:05:42.440802] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-0.4", "title": "Implement ID generator with counter integration", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The generator creates new IDs by combining counter allocation with the ID models. It provides the primary API for creating new specs, plans, epics, and tasks.\n\n**Implementation Steps:**\n1. Create `src/cub/core/ids/generator.py`\n2. Implement `generate_spec_id(project: str, sync_service: SyncService) -> SpecId`\n3. Implement `generate_plan_id(spec: SpecId, letter: str) -> PlanId` (letter is explicit)\n4. Implement `generate_epic_id(plan: PlanId, char: str) -> EpicId` (char is explicit)\n5. Implement `generate_task_id(epic: EpicId, number: int) -> TaskId` (number is explicit)\n6. Implement `generate_standalone_id(project: str, sync_service: SyncService) -> StandaloneTaskId`\n7. Add helper `next_plan_letter(existing: list[str]) -> str` for auto-selection\n8. Add helper `next_epic_char(existing: list[str]) -> str` for auto-selection\n\n**Files:** `src/cub/core/ids/generator.py`", "assignee": "cub-20260204-153949", "labels": ["phase-1", "model:sonnet", "complexity:medium", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-0", "created_at": "2026-02-04T15:37:04.560575", "updated_at": "2026-02-04T16:10:47.346852", "closed_at": "2026-02-04T16:10:47.346848", "acceptanceCriteria": ["`generate_spec_id(\"cub\", sync)` allocates counter and returns `SpecId`", "Letter/char helpers follow sequence rules (A-Z, a-z, 0-9 for plans)", "Generator validates inputs (e.g., letter must be single char)", "All generators return properly typed ID models"], "notes": "Completed by autonomous execution\n\n[Closed: 2026-02-04T16:10:47.346855] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-0.5", "title": "Create pre-push hook and update cub init", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The pre-push hook verifies that locally-used spec/standalone numbers don't conflict with the remote sync branch. This catches collisions before they're pushed. The hook is installed by `cub init`.\n\n**Implementation Steps:**\n1. Create `src/cub/core/ids/hooks.py` with hook logic\n2. Implement `verify_counters_before_push() -> tuple[bool, str]` that:\n3. Create shell script template `templates/hooks/pre-push` that calls Python\n4. Update `cub init` to install pre-push hook to `.git/hooks/pre-push`\n5. Make hook skip gracefully if sync branch not initialized\n6. Add `--no-verify` documentation for bypassing\n\n**Files:** `src/cub/core/ids/hooks.py`, `templates/hooks/pre-push`, `src/cub/cli/init_cmd.py`", "assignee": "cub-20260204-153949", "labels": ["phase-1", "model:sonnet", "complexity:medium", "domain:setup"], "dependsOn": [], "blocks": ["cub-048a-1.1"], "parent": "cub-048a-0", "created_at": "2026-02-04T15:37:04.560592", "updated_at": "2026-02-04T16:18:37.451869", "closed_at": "2026-02-04T16:18:37.451865", "acceptanceCriteria": ["`cub init` installs pre-push hook (executable)", "Hook blocks push if local counters conflict with remote", "Hook passes silently if no conflicts", "Hook skips gracefully if sync branch not set up", "Tests verify hook installation and conflict detection"], "notes": "[Closed: 2026-02-04T16:18:37.451871] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-1.1", "title": "Add PlanEntry and RunEntry models", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The ledger needs new models for plan-level and run-level aggregation. These complement the existing `LedgerEntry` and `EpicEntry` models.\n\n**Implementation Steps:**\n1. Add `PlanEntry` model to `src/cub/core/ledger/models.py`\n2. Add `RunEntry` model to `src/cub/core/ledger/models.py`\n3. Ensure models have all fields from architecture spec\n4. Add `model_config` for JSON serialization compatibility\n5. Export new models from package `__init__.py`\n\n**Files:** `src/cub/core/ledger/models.py`, `src/cub/core/ledger/__init__.py`", "assignee": "cub-20260204-161852", "labels": ["phase-2", "model:sonnet", "complexity:low", "domain:model"], "dependsOn": [], "blocks": [], "parent": "cub-048a-1", "created_at": "2026-02-04T15:37:04.560609", "updated_at": "2026-02-04T16:21:48.133346", "closed_at": "2026-02-04T16:21:48.133332", "acceptanceCriteria": ["`PlanEntry` has: plan_id, spec_id, title, epics, status, timestamps, cost/token totals", "`RunEntry` has: run_id, timestamps, status, config, task lists, cost/token totals", "Both models serialize to JSON cleanly", "Status fields use Literal types for validation"], "notes": "[Closed: 2026-02-04T16:21:48.133349] Completed by autonomous execution", "complexity_label": "low", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-1.2", "title": "Extend LedgerWriter with plan and run methods", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The LedgerWriter needs methods to create and update plan-level and run-level entries, following the same patterns as task and epic entries.\n\n**Implementation Steps:**\n1. Add `create_plan_entry(entry: PlanEntry) -> None` to `LedgerWriter`\n2. Add `update_plan_entry(plan_id: str, updates: dict) -> None`\n3. Add `create_run_entry(entry: RunEntry) -> None`\n4. Add `update_run_entry(run_id: str, updates: dict) -> None`\n5. Create `by-plan/{plan_id}/entry.json` directory structure\n6. Create `by-run/{run_id}.json` file structure\n7. Update index.jsonl with plan/run entries if needed\n\n**Files:** `src/cub/core/ledger/writer.py`", "assignee": "cub-20260204-161852", "labels": ["phase-2", "model:sonnet", "complexity:medium", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-1", "created_at": "2026-02-04T15:37:04.560625", "updated_at": "2026-02-04T16:25:50.066378", "closed_at": "2026-02-04T16:25:50.066374", "acceptanceCriteria": ["`create_plan_entry()` writes to `.cub/ledger/by-plan/{plan_id}/entry.json`", "`create_run_entry()` writes to `.cub/ledger/by-run/{run_id}.json`", "Updates use atomic write pattern (temp file + rename)", "Missing parent directories are created automatically"], "notes": "[Closed: 2026-02-04T16:25:50.066381] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-1.3", "title": "Create HarnessLogWriter for JSONL format", "status": "closed", "priority": "P0", "issue_type": "task", "description": "Harness logs should be JSONL for structured queries instead of plaintext. This enables filtering, searching, and aggregating log data programmatically.\n\n**Implementation Steps:**\n1. Create `src/cub/core/ledger/harness_log.py`\n2. Define `HarnessLogEvent` model with timestamp, event_type, data fields\n3. Implement `HarnessLogWriter` class with:\n4. Implement `HarnessLogReader` class with:\n5. Write to `by-task/{task_id}/{attempt:03d}-harness.jsonl`\n\n**Files:** `src/cub/core/ledger/harness_log.py`", "assignee": "cub-20260204-161852", "labels": ["phase-2", "model:sonnet", "complexity:medium", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-1", "created_at": "2026-02-04T15:37:04.560645", "updated_at": "2026-02-04T16:31:06.258511", "closed_at": "2026-02-04T16:31:06.258508", "acceptanceCriteria": ["Log events are valid JSONL (one JSON object per line)", "Reader can parse logs written by writer", "Large logs can be streamed without loading all into memory", "Timestamps are ISO 8601 format"], "notes": "[Closed: 2026-02-04T16:31:06.258514] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-1.4", "title": "Create ArtifactManager for flattened numbering", "status": "closed", "priority": "P0", "issue_type": "task", "description": "Artifacts should be numbered at task level (001-prompt.md, 002-prompt.md) without the attempts/ subdirectory. This simplifies the directory structure.\n\n**Implementation Steps:**\n1. Create `src/cub/core/ledger/artifacts.py`\n2. Implement `ArtifactManager` class with:\n3. Artifact types: \"prompt\", \"harness\", \"patch\"\n4. Path format: `by-task/{task_id}/{attempt:03d}-{type}.{ext}`\n5. Auto-detect next attempt number from existing files\n\n**Files:** `src/cub/core/ledger/artifacts.py`", "assignee": "cub-20260204-161852", "labels": ["phase-2", "model:sonnet", "complexity:low", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-1", "created_at": "2026-02-04T15:37:04.560661", "updated_at": "2026-02-04T16:35:01.807624", "closed_at": "2026-02-04T16:35:01.807621", "acceptanceCriteria": ["`get_artifact_path(\"cub-048a-0.1\", 1, \"prompt\")` returns correct Path", "Attempt numbers auto-increment based on existing files", "No `attempts/` subdirectory created", "Works with both new hierarchical IDs and old random IDs"], "notes": "[Closed: 2026-02-04T16:35:01.807626] Completed by autonomous execution", "complexity_label": "low", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-1.5", "title": "Remove runs/ and run-sessions/ writes, fix epic title", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The run loop currently writes to `.cub/runs/` and `.cub/run-sessions/`. These writes need to be redirected to the new ledger structure. Also fix the bug where epic entries capture ID instead of title.\n\n**Implementation Steps:**\n1. Update `StatusWriter` to write to `ledger/by-run/` instead of `runs/`\n2. Update `RunSessionManager` to write to `ledger/by-run/` instead of `run-sessions/`\n3. Remove `runs/` directory creation code\n4. Remove `run-sessions/` directory creation code\n5. Find epic entry creation and pass title instead of ID\n6. Update any code that reads from old locations to use new paths\n7. Add deprecation warnings if old directories are detected\n\n**Files:** `src/cub/core/status/writer.py`, `src/cub/core/session/manager.py`, `src/cub/core/ledger/writer.py`", "assignee": "cub-20260204-161852", "labels": ["phase-2", "model:sonnet", "complexity:medium", "domain:logic", "risk:medium"], "dependsOn": [], "blocks": [], "parent": "cub-048a-1", "created_at": "2026-02-04T15:37:04.560679", "updated_at": "2026-02-04T16:45:12.338995", "closed_at": "2026-02-04T16:45:12.338992", "acceptanceCriteria": ["`cub run` no longer creates `.cub/runs/` directory", "`cub run` no longer creates `.cub/run-sessions/` directory", "Run data appears in `.cub/ledger/by-run/`", "Epic entries have `title` field with actual title, not ID", "Existing code that reads run data still works"], "notes": "[Closed: 2026-02-04T16:45:12.338998] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-1.6", "title": "Extend LedgerReader with plan and run queries", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The LedgerReader needs methods to query plan-level and run-level entries, enabling commands like `cub ledger show --plans` and run history queries.\n\n**Implementation Steps:**\n1. Add `get_plan(plan_id: str) -> PlanEntry | None` to `LedgerReader`\n2. Add `list_plans(filters: PlanFilters | None) -> list[PlanEntry]`\n3. Add `get_run(run_id: str) -> RunEntry | None`\n4. Add `list_runs(filters: RunFilters | None) -> list[RunEntry]`\n5. Create `PlanFilters` and `RunFilters` dataclasses\n6. Support filtering by status, date range, spec_id\n\n**Files:** `src/cub/core/ledger/reader.py`, `src/cub/core/ledger/models.py`", "assignee": "cub-20260204-161852", "labels": ["phase-2", "model:sonnet", "complexity:medium", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-1", "created_at": "2026-02-04T15:37:04.560705", "updated_at": "2026-02-04T16:50:01.595489", "closed_at": "2026-02-04T16:50:01.595486", "acceptanceCriteria": ["`get_plan()` returns PlanEntry or None", "`list_plans()` returns all plans, optionally filtered", "`list_runs()` supports date range filtering", "Empty results return empty list, not None"], "notes": "[Closed: 2026-02-04T21:49:39.129875+00:00] Completed by autonomous execution\n\n[Closed: 2026-02-04T16:50:01.595492] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-2.1", "title": "Add --plan flag and plan iteration logic", "status": "closed", "priority": "P0", "issue_type": "task", "description": "The `--plan` flag enables `cub run` to execute an entire plan by iterating through its epics. This replaces the separate `build-plan` command with integrated functionality.\n\n**Implementation Steps:**\n1. Add `plan: str | None` field to `RunConfig` model\n2. Add `--plan` flag to `cub run` CLI command\n3. Extract plan iteration logic from `build_plan.py`\n4. Add `execute_plan(plan_slug: str)` method to `RunLoop` or `RunService`\n5. Implement epic ordering and iteration\n6. Handle epic completion detection (all tasks in epic done)\n7. Support `--start-epic` and `--only-epic` options for partial runs\n\n**Files:** `src/cub/core/run/models.py`, `src/cub/core/run/loop.py`, `src/cub/cli/run.py`", "assignee": "cub-20260204-165022", "labels": ["phase-3", "model:opus", "complexity:high", "domain:logic", "risk:medium"], "dependsOn": [], "blocks": [], "parent": "cub-048a-2", "created_at": "2026-02-04T15:37:04.560721", "updated_at": "2026-02-04T16:57:22.330990", "closed_at": "2026-02-04T16:57:22.330979", "acceptanceCriteria": ["`cub run --plan my-plan` executes all epics in order", "Plan execution creates/updates PlanEntry in ledger", "Epic completion triggers EpicEntry creation", "Partial run options work (--start-epic, --only-epic)", "Plan execution respects budget limits"], "notes": "[Closed: 2026-02-04T17:15:00] Completed by autonomous execution - Added --plan, --start-epic, --only-epic flags to cub run command with full plan iteration logic\n\n[Closed: 2026-02-04T16:57:22.330993] Completed by autonomous execution", "complexity_label": "high", "model_label": "opus", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-2.2", "title": "Update ledger commit timing", "status": "closed", "priority": "P0", "issue_type": "task", "description": "Ledger entries should be committed alongside code changes, not as a separate cleanup step. This ensures artifacts are always in sync with the code they describe.\n\n**Implementation Steps:**\n1. Identify where task completion commits happen in run loop\n2. Add ledger entry write before commit (so it's included)\n3. Update commit message to mention ledger update\n4. Ensure epic entry is written before epic completion commit\n5. Remove any \"cleanup\" commits that only contain ledger files\n6. Test that ledger files appear in same commit as code changes\n\n**Files:** `src/cub/core/run/loop.py`, `src/cub/core/ledger/writer.py`", "assignee": "cub-20260204-165022", "labels": ["phase-3", "model:sonnet", "complexity:medium", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-2", "created_at": "2026-02-04T15:37:04.560738", "updated_at": "2026-02-04T17:02:07.555294", "closed_at": "2026-02-04T17:02:07.555291", "acceptanceCriteria": ["Task completion commit includes `by-task/{id}.json`", "Epic completion commit includes `by-epic/{id}/entry.json`", "No separate \"ledger cleanup\" commits", "Git log shows ledger files with corresponding code changes"], "notes": "[Closed: 2026-02-04T17:02:07.555298] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-2.3", "title": "Remove build-plan command", "status": "closed", "priority": "P0", "issue_type": "task", "description": "With plan execution integrated into `cub run --plan`, the separate `build-plan` command is redundant and should be removed.\n\n**Implementation Steps:**\n1. Remove `cli/build_plan.py` module\n2. Remove build-plan registration from CLI app\n3. Remove build-plan from bash delegated commands if present\n4. Update CLAUDE.md to document `cub run --plan` instead\n5. Remove any build-plan related templates or scripts\n6. Add migration note to UPGRADING.md\n\n**Files:** `src/cub/cli/build_plan.py` (delete), `src/cub/cli/__init__.py`, `CLAUDE.md`, `UPGRADING.md`", "assignee": "cub-20260204-165022", "labels": ["phase-3", "model:haiku", "complexity:low", "domain:setup"], "dependsOn": [], "blocks": [], "parent": "cub-048a-2", "created_at": "2026-02-04T15:37:04.560753", "updated_at": "2026-02-04T17:04:31.303099", "closed_at": "2026-02-04T17:04:31.303096", "acceptanceCriteria": ["`cub build-plan` returns \"unknown command\" error", "Documentation references `cub run --plan` not `build-plan`", "No dead code referencing build-plan remains", "UPGRADING.md documents the change"], "notes": "[Closed: 2026-02-04T17:04:31.303102] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 0}
{"id": "cub-048a-2.4", "title": "Tests for run loop changes", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The run loop changes need comprehensive tests to ensure plan execution, ledger timing, and ID integration work correctly.\n\n**Implementation Steps:**\n1. Create `tests/test_run_plan.py` for plan execution tests\n2. Test `cub run --plan` happy path (mock harness)\n3. Test epic ordering and completion detection\n4. Test ledger entries created at correct times\n5. Test partial run options (--start-epic, --only-epic)\n6. Test budget enforcement during plan execution\n7. Test error handling (epic failure, harness timeout)\n\n**Files:** `tests/test_run_plan.py`", "assignee": "cub-20260204-165022", "labels": ["phase-3", "model:sonnet", "complexity:medium", "domain:test"], "dependsOn": [], "blocks": [], "parent": "cub-048a-2", "created_at": "2026-02-04T15:37:04.560770", "updated_at": "2026-02-04T17:09:30.425437", "closed_at": "2026-02-04T17:09:30.425433", "acceptanceCriteria": ["Plan execution test with multiple epics passes", "Ledger timing test verifies files in same commit", "Partial run tests verify correct epic selection", "Error handling tests verify graceful degradation", "All tests pass with `pytest tests/test_run_plan.py`"], "notes": "[Closed: 2026-02-04T17:09:30.425439] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-048a-3.1", "title": "Create core/hooks/ package with context models", "status": "closed", "priority": "P1", "issue_type": "task", "description": "A new hooks package consolidates hook functionality and defines the context models that carry data to hook scripts.\n\n**Implementation Steps:**\n1. Create `src/cub/core/hooks/` directory with `__init__.py`\n2. Create `models.py` with context models from architecture:\n3. Create `HookResult` model for hook execution results\n4. Create `HookConfig` model for hook configuration\n5. Ensure all context models serialize to JSON for env var passing\n\n**Files:** `src/cub/core/hooks/__init__.py`, `src/cub/core/hooks/models.py`", "assignee": "cub-20260204-170945", "labels": ["phase-4", "model:sonnet", "complexity:medium", "domain:model"], "dependsOn": [], "blocks": [], "parent": "cub-048a-3", "created_at": "2026-02-04T15:37:04.560786", "updated_at": "2026-02-04T17:09:45.523293", "closed_at": "2026-02-04T22:13:14.%f", "acceptanceCriteria": ["All four context models implemented with fields from architecture", "Context models can serialize to JSON string", "HookResult captures success/failure, output, duration", "Models exported from package `__init__.py`"], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-048a-3.2", "title": "Implement hook executor and discovery", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The hook executor runs user scripts with context passed via environment variables. Discovery finds scripts in project and global hook directories.\n\n**Implementation Steps:**\n1. Create `src/cub/core/hooks/discovery.py`\n2. Implement `discover_hooks(hook_name: str) -> list[Path]`\n3. Create `src/cub/core/hooks/executor.py`\n4. Implement `HookExecutor.run(hook_name: str, context: BaseModel) -> HookResult`\n\n**Files:** `src/cub/core/hooks/discovery.py`, `src/cub/core/hooks/executor.py`", "assignee": "cub-20260204-170945", "labels": ["phase-4", "model:sonnet", "complexity:medium", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-3", "created_at": "2026-02-04T15:37:04.560800", "updated_at": "2026-02-04T17:20:50.383357", "closed_at": "2026-02-04T17:20:50.383340", "acceptanceCriteria": ["Discovery finds scripts in both project and global directories", "Only executable files are returned", "Executor passes context via `CUB_HOOK_CONTEXT` env var", "Hook timeout is configurable (default 30s)", "Failed hooks don't block execution (configurable)"], "notes": "[Closed: 2026-02-04T17:20:50.383360] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-048a-3.3", "title": "Integrate lifecycle hooks into run loop", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The run loop needs to invoke lifecycle hooks at the appropriate points: before session starts, after task completion, after epic completion, after plan completion.\n\n**Implementation Steps:**\n1. Create `src/cub/core/hooks/lifecycle.py` with hook point definitions\n2. Add hook invocation before harness session (pre-session)\n3. Add hook invocation after task completion (end-of-task)\n4. Add hook invocation after epic completion (end-of-epic)\n5. Add hook invocation after plan completion (end-of-plan)\n6. Build context objects from run loop state\n7. Log hook execution results\n8. Make hooks optional (check config before running)\n\n**Files:** `src/cub/core/hooks/lifecycle.py`, `src/cub/core/run/loop.py`", "assignee": "cub-20260204-170945", "labels": ["phase-4", "model:sonnet", "complexity:medium", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-3", "created_at": "2026-02-04T15:37:04.560820", "updated_at": "2026-02-04T17:25:45.134960", "closed_at": "2026-02-04T17:25:45.134957", "acceptanceCriteria": ["`pre-session` hook runs before harness invocation", "`end-of-task` hook runs after task marked complete", "`end-of-epic` hook runs after last task in epic", "`end-of-plan` hook runs after last epic in plan", "Hooks can be disabled via config"], "notes": "[Closed: 2026-02-04T17:25:45.134964] Completed by autonomous execution", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-048a-3.4", "title": "Update cub init for hook directories and tests", "status": "closed", "priority": "P1", "issue_type": "task", "description": "`cub init` should create the hook directories so users know where to place their scripts. Tests verify hook functionality.\n\n**Implementation Steps:**\n1. Update `cub init` to create `.cub/hooks/` directory\n2. Create subdirectories for each hook point\n3. Add README.md in hooks directory explaining usage\n4. Create `tests/test_hooks_lifecycle.py`\n5. Test hook discovery with mock scripts\n6. Test hook execution with context passing\n7. Test hook failure handling\n\n**Files:** `src/cub/cli/init_cmd.py`, `templates/hooks/README.md`, `tests/test_hooks_lifecycle.py`", "assignee": "cub-20260204-170945", "labels": ["phase-4", "model:haiku", "complexity:low", "domain:setup", "domain:test"], "dependsOn": [], "blocks": [], "parent": "cub-048a-3", "created_at": "2026-02-04T15:37:04.560836", "updated_at": "2026-02-04T17:28:08.602734", "closed_at": "2026-02-04T17:28:08.602731", "acceptanceCriteria": ["`cub init` creates `.cub/hooks/{pre-session,end-of-task,end-of-epic,end-of-plan}/`", "README.md explains hook usage and context fields", "Hook discovery tests pass", "Hook execution tests verify context in env vars"], "notes": "[Closed: 2026-02-04T17:28:08.602735] Completed by autonomous execution", "complexity_label": "low", "model_label": "haiku", "is_ready": false, "priority_numeric": 1}
{"id": "cub-048a-4.1", "title": "Implement cub release command", "status": "closed", "priority": "P1", "issue_type": "task", "description": "The release command marks a plan as released, updates CHANGELOG, creates a git tag, and moves specs to the released/ directory.\n\n**Implementation Steps:**\n1. Create `src/cub/core/release/` package with `service.py`\n2. Implement `ReleaseService` with methods:\n3. Create `src/cub/cli/release.py` with Typer command\n4. Add `--dry-run` flag to preview changes\n5. Add `--no-tag` flag to skip git tag creation\n\n**Files:** `src/cub/core/release/__init__.py`, `src/cub/core/release/service.py`, `src/cub/cli/release.py`", "assignee": "cub-20260204-172822", "labels": ["phase-5", "model:sonnet", "complexity:medium", "domain:logic", "domain:api"], "dependsOn": [], "blocks": [], "parent": "cub-048a-4", "created_at": "2026-02-04T15:37:04.560854", "updated_at": "2026-02-04T22:34:30.230892+00:00", "closed_at": "2026-02-04T22:34:30.230876+00:00", "acceptanceCriteria": ["`cub release cub-048a v0.30` updates ledger status to \"released\"", "CHANGELOG.md is updated with release notes from plan", "Git tag is created (unless --no-tag)", "Spec file is moved to specs/released/", "Dry-run shows what would happen without changes"], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": false, "priority_numeric": 1}
{"id": "cub-048a-4.2", "title": "Implement cub retro command", "status": "open", "priority": "P1", "issue_type": "task", "description": "The retro command generates a retrospective report for a completed plan or epic, summarizing what went well, what didn't, and lessons learned.\n\n**Implementation Steps:**\n1. Create `src/cub/core/retro/` package with `service.py`\n2. Implement `RetroService` with methods:\n3. Create `RetroReport` model with sections\n4. Create `src/cub/cli/retro.py` with Typer command\n5. Output as markdown to stdout or file\n6. Support `--epic` flag for epic-level retro\n\n**Files:** `src/cub/core/retro/__init__.py`, `src/cub/core/retro/service.py`, `src/cub/cli/retro.py`", "assignee": null, "labels": ["phase-5", "model:sonnet", "complexity:medium", "domain:logic", "domain:api"], "dependsOn": [], "blocks": [], "parent": "cub-048a-4", "created_at": "2026-02-04T15:37:04.560870", "updated_at": "2026-02-04T15:37:04.560872", "closed_at": null, "acceptanceCriteria": ["`cub retro cub-048a` generates markdown report", "Report includes: summary, metrics, issues, timeline", "`--output` flag writes to file instead of stdout", "Epic-level retro works with `--epic` flag"], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 1}
{"id": "cub-048a-4.3", "title": "Implement cub verify command", "status": "open", "priority": "P1", "issue_type": "task", "description": "The verify command checks ledger consistency, ID integrity, and counter sync status. It's useful for diagnosing issues and ensuring data health.\n\n**Implementation Steps:**\n1. Create `src/cub/core/verify/` package with `service.py`\n2. Implement `VerifyService` with checks:\n3. Create `Issue` model with severity, message, fix suggestion\n4. Create `src/cub/cli/verify.py` with Typer command\n5. Support `--fix` flag to auto-fix simple issues\n6. Support filtering: `--ledger`, `--ids`, `--counters`\n\n**Files:** `src/cub/core/verify/__init__.py`, `src/cub/core/verify/service.py`, `src/cub/cli/verify.py`", "assignee": null, "labels": ["phase-5", "model:sonnet", "complexity:medium", "domain:logic", "domain:api"], "dependsOn": [], "blocks": [], "parent": "cub-048a-4", "created_at": "2026-02-04T15:37:04.560886", "updated_at": "2026-02-04T15:37:04.560888", "closed_at": null, "acceptanceCriteria": ["`cub verify` runs all checks and reports issues", "Exit code is non-zero if issues found", "`--fix` attempts to repair simple issues", "Output is clear about what's checked and what failed"], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 1}
{"id": "cub-048a-4.4", "title": "Implement cub learn extract command", "status": "open", "priority": "P1", "issue_type": "task", "description": "The learn extract command analyzes ledger entries to extract patterns and lessons, updating guardrails.md and CLAUDE.md with discovered knowledge.\n\n**Implementation Steps:**\n1. Create `src/cub/core/learn/` package with `service.py`\n2. Implement `LearnService` with methods:\n3. Create `Pattern` model for extracted patterns\n4. Create `src/cub/cli/learn.py` with Typer command\n5. Support `--dry-run` to preview changes\n6. Support `--since` to limit analysis window\n\n**Files:** `src/cub/core/learn/__init__.py`, `src/cub/core/learn/service.py`, `src/cub/cli/learn.py`", "assignee": null, "labels": ["phase-5", "model:opus", "complexity:high", "domain:logic", "domain:api"], "dependsOn": [], "blocks": [], "parent": "cub-048a-4", "created_at": "2026-02-04T15:37:04.560903", "updated_at": "2026-02-04T15:37:04.560905", "closed_at": null, "acceptanceCriteria": ["`cub learn extract` analyzes recent ledger entries", "Patterns are identified (repeated failures, cost outliers, etc.)", "Suggested guardrails are actionable", "`--dry-run` shows suggestions without modifying files"], "notes": "", "complexity_label": "high", "model_label": "opus", "is_ready": true, "priority_numeric": 1}
{"id": "cub-048a-4.5", "title": "Implement cub sync agent command", "status": "open", "priority": "P1", "issue_type": "task", "description": "The sync agent command manually syncs managed sections in agent.md/CLAUDE.md across worktrees and branches, pulling from or pushing to the sync branch.\n\n**Implementation Steps:**\n1. Extend `SyncService` in `src/cub/core/sync/service.py`:\n2. Implement managed section parsing (find markers, extract content)\n3. Implement managed section injection (replace between markers)\n4. Add `sync agent` subcommand to `src/cub/cli/sync.py`\n5. Support `--push` and `--pull` directions\n6. Default to pull if no direction specified\n\n**Files:** `src/cub/core/sync/service.py`, `src/cub/cli/sync.py`", "assignee": null, "labels": ["phase-5", "model:sonnet", "complexity:medium", "domain:logic", "domain:api"], "dependsOn": [], "blocks": [], "parent": "cub-048a-4", "created_at": "2026-02-04T15:37:04.561204", "updated_at": "2026-02-04T15:37:04.561206", "closed_at": null, "acceptanceCriteria": ["`cub sync agent` pulls managed sections from sync branch", "`cub sync agent --push` pushes local sections to sync branch", "Managed section markers are preserved", "Non-managed content is not affected", "Conflict detection if both sides changed"], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 1}
{"id": "cub-048a-5.1", "title": "Add consistency checks to cub doctor", "status": "open", "priority": "P1", "issue_type": "task", "description": "`cub doctor` should include checks for ledger consistency, ID integrity, and counter sync status, reusing the verify service.\n\n**Implementation Steps:**\n1. Import `VerifyService` in `src/cub/cli/doctor.py`\n2. Add \"Ledger Health\" section to doctor output\n3. Run `check_ledger_consistency()` and report issues\n4. Add \"ID System\" section\n5. Run `check_id_integrity()` and report issues\n6. Add \"Counter Sync\" section\n7. Run `check_counter_sync()` and report issues\n8. Use Rich formatting for clear output\n\n**Files:** `src/cub/cli/doctor.py`", "assignee": null, "labels": ["phase-6", "model:sonnet", "complexity:medium", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-5", "created_at": "2026-02-04T15:37:04.561231", "updated_at": "2026-02-04T15:37:04.561233", "closed_at": null, "acceptanceCriteria": ["`cub doctor` shows ledger health status", "Issues are displayed with severity and suggestions", "Passing checks show green checkmarks", "Failing checks show red X with details"], "notes": "", "complexity_label": "medium", "model_label": "sonnet", "is_ready": true, "priority_numeric": 1}
{"id": "cub-048a-5.2", "title": "Add pre-run consistency check", "status": "open", "priority": "P1", "issue_type": "task", "description": "`cub run` should optionally check consistency before starting, catching issues early. This should be fast and skippable.\n\n**Implementation Steps:**\n1. Add `--skip-checks` flag to `cub run`\n2. Before run loop starts, call fast consistency checks\n3. Check: ledger directory exists, counters readable, no obvious corruption\n4. Skip expensive checks (full integrity scan)\n5. Warn but don't block on minor issues\n6. Block on critical issues (corrupted counter state)\n\n**Files:** `src/cub/cli/run.py`, `src/cub/core/run/loop.py`", "assignee": null, "labels": ["phase-6", "model:haiku", "complexity:low", "domain:logic"], "dependsOn": [], "blocks": [], "parent": "cub-048a-5", "created_at": "2026-02-04T15:37:04.561251", "updated_at": "2026-02-04T15:37:04.561253", "closed_at": null, "acceptanceCriteria": ["`cub run` performs quick sanity check by default", "`cub run --skip-checks` bypasses pre-run checks", "Check completes in <1 second", "Critical issues block with clear error message"], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 1}
{"id": "cub-048a-5.3", "title": "Remove deprecated code paths", "status": "open", "priority": "P1", "issue_type": "task", "description": "With the new ledger structure in place, code that reads from or writes to the old directories should be removed.\n\n**Implementation Steps:**\n1. Search for references to `.cub/runs/` and remove\n2. Search for references to `.cub/run-sessions/` and remove\n3. Search for references to `.cub/logs/` and remove\n4. Remove `attempts/` directory handling in artifact code\n5. Remove any backward-compatibility shims added during migration\n6. Run tests to ensure nothing breaks\n\n**Files:** Various (search and remove)", "assignee": null, "labels": ["phase-6", "model:haiku", "complexity:low", "domain:cleanup"], "dependsOn": [], "blocks": [], "parent": "cub-048a-5", "created_at": "2026-02-04T15:37:04.561268", "updated_at": "2026-02-04T15:37:04.561269", "closed_at": null, "acceptanceCriteria": ["No code references `runs/` directory", "No code references `run-sessions/` directory", "No code references `logs/` directory", "All tests pass after removal"], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 1}
{"id": "cub-048a-5.4", "title": "Update documentation and gitignore", "status": "open", "priority": "P1", "issue_type": "task", "description": "Documentation needs to reflect the new storage structure, ID system, and commands. The gitignore template needs updating for new paths.\n\n**Implementation Steps:**\n1. Update CLAUDE.md with new ledger structure\n2. Update CLAUDE.md with new ID format documentation\n3. Update CLAUDE.md with new commands (release, retro, verify, learn, sync agent)\n4. Remove references to build-plan, runs/, run-sessions/\n5. Update `.gitignore` template in templates/\n6. Add `.cub/ledger/by-run/` to gitignore (if run data shouldn't be committed)\n7. Update README.md if needed\n8. Update UPGRADING.md with migration notes\n\n**Files:** `CLAUDE.md`, `README.md`, `UPGRADING.md`, `templates/.gitignore`", "assignee": null, "labels": ["phase-6", "model:haiku", "complexity:low", "domain:docs"], "dependsOn": [], "blocks": [], "parent": "cub-048a-5", "created_at": "2026-02-04T15:37:04.561288", "updated_at": "2026-02-04T15:37:04.561290", "closed_at": null, "acceptanceCriteria": ["CLAUDE.md documents current state accurately", "New commands are documented", "Deprecated commands/paths are removed from docs", "UPGRADING.md has clear migration instructions"], "notes": "", "complexity_label": "low", "model_label": "haiku", "is_ready": true, "priority_numeric": 1}
