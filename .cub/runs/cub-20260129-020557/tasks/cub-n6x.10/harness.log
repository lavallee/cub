

I'll start by claiming the task and exploring the codebase to understand the streaming output handling.Now let me look at the two key files where streaming output happens:Now I need to understand what "messages" means here. The task says "consecutive messages are concatenated without visual separation." Let me look at where the harness is invoked in the run loop to understand what constitutes a "message" — it's likely each iteration of the run loop calling the harness.Now I understand the architecture. The run loop calls `_invoke_harness` for each task/attempt, which calls `invoke_harness_async`. In streaming mode, chunks are written to stdout. When multiple tasks run in sequence, there's no visual separation between the output of consecutive harness invocations.

The task says "Add newlines between streamed harness messages." The fix should add a newline before starting a new streamed message output (or after each one). Looking at the code, there's already a `sys.stdout.write("\n")` at the end of each streaming session (lines 63-64 in `_harness.py` and 218-219 in `cli/run.py`). But consecutive messages from the same streaming session (chunks from `stream_task`) might also need separation.

Wait, re-reading the task: "consecutive messages are concatenated without visual separation." Let me look at what the harness backends actually yield as chunks - are these individual "messages" from the AI?Now let me check `_extract_text_from_message` to understand what constitutes a "message" vs a "chunk":Now I understand. Each `sdk_message` is an `AssistantMessage` — a complete message from the AI. The `stream_task` yields the text from each message. When consecutive messages are yielded, they're concatenated without newlines between them.

The fix should add a newline between consecutive streamed messages. There are two places to fix:
1. `/home/lavallee/clawdbot/cub/src/cub/core/run/_harness.py` (core version)
2. `/home/lavallee/clawdbot/cub/src/cub/cli/run.py` (CLI version)

The cleanest approach: after writing each chunk to stdout, add a newline. But wait — the chunks from `stream_task` are already complete messages (text extracted from `AssistantMessage`). Let me check the other harness backends too to be sure.Now I have the full picture. The `stream_task` yields string chunks that represent messages. For the Claude SDK backend, it yields text from each `AssistantMessage`. The codex and claude_cli backends yield complete output as a single chunk.

The fix: In the streaming loop in both `_harness.py` and `cli/run.py`, add a newline between consecutive text chunks (messages). The best approach is to write a newline before each chunk except the first one, or after each chunk. Since there's already a final `\n` after the loop, I should add a newline **between** messages.

Let me implement this:Now let me read the CLI version more carefully to apply the same fix:Now let me run the feedback loops:Let me check if there's a direct test for `invoke_harness_async` from `_harness.py`:No direct tests for `invoke_harness_async`. Let me look at the integration test for stream_task:Good. This test tests the backend itself, not the output formatting. Now let me run the existing tests to make sure nothing is broken:All tests pass. Now let me run type checking and linting:The mypy error on line 296 is pre-existing (unrelated to my changes). Let me verify:Line 296 is not in our diff — pre-existing issue. All checks pass. Let me run the full test suite quickly:The one failing test is about `test_run_task_sets_cub_run_active_env_var` — let me check if it's related to my changes:This is a pre-existing environmental test failure — `CUB_RUN_ACTIVE` is already set to `1` in the environment (visible in the env dump), so the test fails because the environment already has that variable set. This is unrelated to my changes.

Let me verify by checking git status:My changes are only in `src/cub/cli/run.py` and `src/cub/core/run/_harness.py` (4 lines each). The failing test is pre-existing and environmental. All 1352 other tests pass. Now let me close the task and commit:Now let me check if there are remaining open tasks:There are many remaining open tasks. Let me check if there are tasks ready to work on in the current epic:There are still open tasks, so the work continues. My assigned task is complete.

## Summary

**Task completed: cub-n6x.10 — Add newlines between streamed harness messages**

**Changes made:**
1. **`src/cub/core/run/_harness.py`** — Added a `message_count` counter in the streaming loop. Before writing each chunk after the first, a newline is written to stdout to visually separate consecutive messages.

2. **`src/cub/cli/run.py`** — Applied the same pattern in the CLI's `_invoke_harness_async` function, using `_stream_callback("\n")` for consistency with the CLI's callback mechanism.

**Validation:**
- ✅ All 1352 tests pass (1 pre-existing env-dependent failure unrelated to changes)
- ✅ Type checking passes (1 pre-existing warning unrelated to changes)
- ✅ Linting passes
- ✅ Task closed and committed