# Project Prompt

This file provides context for AI coding agents working on this project.

## Overview


Plan releases 0.21-0.25 for Cub, focusing on migrating performance-critical Bash code to Python (not Go initially), adding visibility via a live dashboard, enabling parallel development with git worktrees, and providing safe autonomous execution via Docker-based sandboxing. The goal is to establish the technical foundation that enables confident overnight autonomous operation.

## Problem Statement

## Problem Statement


Cub is currently ~9,400 lines of Bash with significant jq subprocess overhead (~10-50ms per JSON operation). This limits performance, maintainability, and the ability to add advanced features like parallel execution and real-time dashboards. Users need confidence to run cub autonomously overnight, which requires visibility (dashboard) and safety (sandbox).

## Refined Vision

## Technical Approach


Cub 0.21-0.25 migrates from a Bash-based CLI to a full Python CLI while maintaining the existing pluggable architecture for task backends, AI harnesses, and adding new pluggable systems for sandbox providers.

The architecture uses modern Python tooling:
- **Typer** for type-safe CLI with auto-generated help and shell completion
- **Pydantic v2** for all data models with validation and serialization
- **Rich** for terminal output, progress bars, and live dashboard rendering
- **Protocol classes** for pluggable interfaces ensuring extensibility

The design prioritizes pluggability across all major subsystems (harnesses, task backends, sandbox providers, hooks) while keeping the implementation focused on the immediate needs (existing harnesses, Docker sandbox).

## Architecture


```
┌─────────────────────────────────────────────────────────────────┐
│                         cub (Python CLI)                         │
│                    typer + rich + pydantic                       │
├─────────────────────────────────────────────────────────────────┤
│  cub run       │  cub status    │  cub audit   │  cub sandbox   │
│  cub monitor   │  cub worktree  │  cub init    │  cub doctor    │
└────────────────┴────────────────┴──────────────┴────────────────┘
                              │
┌─────────────────────────────┴───────────────────────────────────┐
│                       cub.core (library)                         │
├───────────────┬───────────────┬───────────────┬─────────────────┤
│   tasks/      │   config/     │   harness/    │   sandbox/      │
│  (backends)   │  (pydantic)   │  (backends)   │  (providers)    │
├───────────────┼───────────────┼───────────────┼─────────────────┤
│  • beads      │               │  • claude     │  • docker       │
│  • json       │               │  • codex      │  • (future)     │
│  • (future)   │               │  • gemini     │                 │
│               │               │  • opencode   │                 │

## Requirements

### P0 (Must Have)

- **Python Core (0.21):** Migrate tasks, config, and harness layers to Python
  - Eliminates jq subprocess overhead (10-50x performance improvement expected)
  - Python chosen over Go for flexibility, library ecosystem, and developer familiarity
  - Harness layer in Python enables easier prompt iteration

## Constraints


- **Solo developer:** Scope must be realistic for one person
- **No backward compatibility needed:** Only user is the developer
- **Modern Bash acceptable:** Can require Bash 5.x via Homebrew if needed, but likely moot after Python migration
- **Docker required for sandbox:** Sprites and other providers deferred

---

Generated by cub prep. Session artifacts in .cub/sessions/
