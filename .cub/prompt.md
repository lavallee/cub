# Project Prompt

This file provides context for AI coding agents working on this project.

## Overview

Cub currently has fragmented tracking: beads handles task state, the dashboard has its own DB, and there's no persistent record of development attempts, costs, or workflow progression. Users lack visibility into how tasks were completed (attempts, escalations, model usage) and cannot track work through post-development stages (review, validation, release).

## Requirements

### P0 - Must Have

| ID | Requirement | Rationale |
|----|-------------|-----------|
| P0.1 | Run session tracking (`.cub/run-sessions/`, `active-run.json` symlink) | Know what's currently running, detect orphaned runs |
| P0.2 | Task ledger creation on task start | Begin tracking immediately when work begins |
| P0.3 | Prompt file writing with frontmatter (`NNN-prompt.md`) | Preserve exact context sent to harness |
| P0.4 | Attempt tracking (append to `attempts[]` after each execution) | Record all tries, costs, outcomes |
| P0.5 | Task ledger finalization on close (outcome, task_changed, stage) | Complete the development record |
| P0.6 | `cub ledger show <id>` command | Basic ledger inspection |

## Components

### 1. Run Session Manager (New)

**Location:** `src/cub/core/session/manager.py`

- **Purpose:** Track active `cub run` executions with symlink-based detection
- **Responsibilities:**
  - Create run session file on `cub run` start
  - Manage `active-run.json` symlink
  - Detect and mark orphaned runs
  - Update run progress (tasks completed, budget used)
- **Dependencies:** None (standalone component)
- **Interface:**
  ```python
  class RunSessionManager:
      def start_session(harness: str, budget: Budget) -> RunSession

## Constraints

| Constraint | Impact |
|------------|--------|
| Single-writer assumption | No parallel `cub run` support; simplifies file locking |
| Local dashboard only | No authentication required for API |
| Python 3.10+ | Can use modern language features |

---

Generated by cub stage from plan: unified-tracking-model
