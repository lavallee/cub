
## Task: cub-q2j.1 - Add branch binding to JSON task backend

**Completed**: Successfully implemented branch binding for JSON backend

**Key Implementation Points**:
1. Created `JsonBranchStore` class mirroring the beads `BranchStore` pattern
2. Used `.cub/branches.json` for storage (JSON format instead of YAML)
3. Implemented atomic writes using temp file + `os.replace()` pattern
4. All key methods: `get_binding()`, `get_binding_by_branch()`, `add_binding()`, `remove_binding()`, `update_pr()`, `update_status()`
5. Branch binding model includes: `epic_id`, `branch_name`, `base_branch`, `status`, `created_at`, `pr_number`, `merged`

**Testing Strategy**:
- Added comprehensive test class `TestBindBranch` to `tests/test_tasks_json.py`
- Tested duplicate prevention, directory creation, file format, custom base branches
- All 63 existing tests still pass + 6 new tests for branch binding
- Integration test confirms real-world usage works correctly

**Code Quality**:
- Passes `mypy --strict` type checking
- Passes `ruff` linting
- Fixed deprecation warnings: replaced `datetime.utcnow()` with `datetime.now(timezone.utc)`
- Applied fix to both `json_store.py` and existing `store.py` and `models.py`

**Important Design Decisions**:
1. Used JSON format for consistency with JSON backend (not YAML like beads)
2. Storage in `.cub/branches.json` (not `.cub/tasks.json`) to separate concerns
3. Automatic `.cub` directory creation if needed
4. Same error handling pattern as beads: returns `False` on duplicate/error instead of raising

**Files Modified**:
- `src/cub/core/branches/json_store.py` (new)
- `src/cub/core/tasks/json.py` (updated `bind_branch()` method)
- `tests/test_tasks_json.py` (added `TestBindBranch` class)
- `src/cub/core/branches/models.py` (fixed deprecation warning)
- `src/cub/core/branches/store.py` (fixed deprecation warning)

**Integration Points**:
- `cub run` with `--epic` flag already calls `backend.bind_branch()`
- `cub branch` and `cub branches` commands delegate to bash (use beads store for beads backend, will use JSON store for JSON backend)
- PR service uses BranchStore for binding lookups
