# Cub Project Progress

## Session: Quick-Start Guide (cub-eke.16)

### Task Completed
Created standalone quick-start guide for Cub - a focused 5-minute onboarding document.

### What Was Implemented

**QUICK_START.md** - A separate quick-start guide covering:

1. **Prerequisites (1 min)**
   - Bash 4+, jq, Claude Code CLI
   - Optional: beads CLI

2. **Installation (1 min)**
   - Clone to tools directory
   - Add to PATH or create symlinks
   - Verification with `cub --version`

3. **Global Setup (1 min)**
   - `cub init --global`
   - Explains what's created

4. **Project Initialization (1 min)**
   - `cub init` in project directory
   - Lists created files

5. **Task Setup (1 min)**
   - Two options: prd.json or beads
   - Simple task examples for both

6. **Running Cub (1 min)**
   - Basic commands: `cub run`, `cub run --once`
   - What Cub does step-by-step

7. **Additional Sections**
   - Check Status (cub status, cub explain, cub artifacts)
   - Common Commands table
   - Beads Commands reference
   - Practical Tips for success
   - Next Steps (links to detailed docs)
   - Getting Help

### Design Philosophy

- **Minimal and focused**: 5-minute target, no overwhelming detail
- **Separate from README**: Complements rather than duplicates
- **Action-oriented**: Shows exact commands to run
- **Two paths**: Both prd.json and beads support
- **Quick feedback**: `run --once` option for testing
- **Clear progression**: Setup → Initialize → Add Tasks → Run → Check

### Why This Works

1. **New users can get started immediately** without reading 30KB of documentation
2. **Practical examples** (e.g., sample task in prd.json) reduce friction
3. **Time estimates** (1 min per step) set expectations
4. **Two-path approach** respects user preference (prd.json vs beads)
5. **Safety valves** (`run --once`) let users test before committing

### Files Created
- `QUICK_START.md` - Standalone quick-start guide (182 lines)

### Commit
af4e7d9 task(cub-eke.16): Quick-start guide

---

## Session: Project Structure Validation (cub-eke.14)

### Task Completed
Implemented comprehensive project structure validation in 'cub doctor' command.

### What Was Implemented

1. **Symlink Validation (`_doctor_check_symlinks`)**
   - Validates root-level symlinks for new layout projects
   - Checks CLAUDE.md, AGENTS.md, AGENT.md → .cub/agent.md
   - Checks PROMPT.md → .cub/prompt.md
   - Detects and reports:
     - Valid symlinks (passing checks)
     - Broken symlinks (pointing to wrong target)
     - Regular files instead of symlinks
     - Missing symlinks (optional warnings)
   - Uses `readlink` to verify symlink targets

2. **.gitignore Validation (`_doctor_check_gitignore`)**
   - Validates .gitignore exists
   - Checks for required patterns:
     - `.cub/runs` - Session run artifacts
     - `.bv/` - Beads viewer cache
   - Detects missing patterns and reports them
   - Uses grep with `^` anchor to ensure patterns are at line start

3. **Integration into cub doctor**
   - Both validations integrated into `_doctor_check_project()`
   - Outputs clear [OK] and [!!] status indicators
   - Non-blocking warnings (project can work without perfect symlinks/gitignore)

### Testing

- Added 8 new tests to tests/doctor.bats
- All 40 tests passing in doctor.bats
- Tests cover:
  - Valid symlinks (single and multiple)
  - Broken/incorrect symlinks
  - Regular files instead of symlinks
  - Missing .gitignore
  - Missing patterns in .gitignore
  - Complete .gitignore validation
  - Edge cases (leading whitespace in patterns)

### Implementation Details

**Symlink Validation:**
1. Only runs for new layout (`_PROJECT_LAYOUT == "new"`)
2. Uses bash `-L` test to check if path is symlink
3. Uses `readlink` to get actual target
4. String comparison of targets (avoiding path resolution complexity)

**Gitignore Validation:**
1. Checks for file existence first
2. Uses `grep -q "^${pattern}"` for exact line matching
3. Accumulates missing patterns in array
4. Provides detailed report of what's missing

### How to Use

```bash
# Run standard diagnostics including structure validation
cub doctor

# Show detailed information
cub doctor --verbose

# View what would be fixed (currently informational only)
cub doctor --dry-run

# Check specific validations by examining output
cub doctor | grep -A 10 "Project Structure"
```

### Future Enhancements

The implementation provides foundation for:
1. Auto-fix of broken symlinks (--fix flag)
2. Auto-generation of missing symlinks
3. Auto-addition of missing .gitignore patterns
4. Validation of symlink targets existence
5. .gitignore comment/whitespace handling improvements

### Files Modified
- `lib/cmd_doctor.sh`: Added `_doctor_check_symlinks()` and `_doctor_check_gitignore()` functions, integrated into `_doctor_check_project()`
- `tests/doctor.bats`: Added 8 comprehensive tests for new validation functions

### Commit
e17d239 task(cub-eke.14): Project structure validation

---

## Session: Config Validation (cub-eke.13)

### Task Completed
Implemented comprehensive configuration validation for the 'cub doctor' command.

### What Was Implemented

1. **JSON Validation**
   - `_doctor_validate_json()`: Checks if config files are valid JSON using jq
   - Handles both global (~/.config/cub/config.json) and project (.cub.json) configs

2. **Required Fields Check**
   - `_doctor_check_required_fields()`: Validates presence of required config keys
   - Uses jq's `has()` function to check top-level fields
   - Outputs list of missing fields on failure

3. **Deprecated Options Detection**
   - `_doctor_check_deprecated_options()`: Scans for deprecated config options
   - Maps deprecated keys to migration instructions
   - Initial deprecated options:
     - `harness.priority` → Use `harness.default` instead
     - `budget.tokens` → Use `budget.max_tokens_per_task` instead
     - `state.clean` → Use `state.require_clean` instead

4. **Integration into cub doctor**
   - Config validation runs as part of standard diagnostics
   - Outputs clear [OK], [!!], or [XX] status indicators
   - `--verbose` flag shows detailed deprecation messages

### Testing

- Added 9 new tests to tests/doctor.bats
- All tests passing (32 total in doctor.bats)
- Tests cover:
  - Valid/invalid JSON detection
  - Empty objects and arrays
  - Deprecated option detection (single and multiple)
  - Required fields checking (missing and present)

### Implementation Details

**Key Design Decisions:**
1. Used jq's `has()` function to check for keys with dots (e.g., "harness.priority")
   - Avoids treating dots as path separators
   - Quoted field names properly in jq expressions

2. Deprecated options stored as JSON map in function:
   ```json
   {
     "harness.priority": "Use 'harness.default' instead",
     "budget.tokens": "Use 'budget.max_tokens_per_task' instead",
     "state.clean": "Use 'state.require_clean' instead"
   }
   ```

3. Functions output results to stdout for consumption by tests/shell scripts
   - Returns exit code 0 on success, 1 on validation failure
   - Missing fields printed one per line

### How to Use

```bash
# Run standard diagnostics including config validation
cub doctor

# Show detailed config issues
cub doctor --verbose

# Dry-run any fixes (not applicable to config validation yet)
cub doctor --dry-run

# See what would be fixed
cub doctor --fix
```

### Future Enhancements

The implementation provides the foundation for:
1. Auto-fixing deprecated options (could write migration advice to .cub.json)
2. Config file generation during `cub init`
3. Config schema validation against expected structure
4. Runtime config consistency checks

### Files Modified
- `lib/cmd_doctor.sh`: Added 3 helper functions and integrated into main check
- `tests/doctor.bats`: Added 9 comprehensive tests

### Commit
e3b4d04 task(cub-eke.13): Config validation
