diff --git a/.beads/issues.jsonl b/.beads/issues.jsonl
index 35a505c..867a07d 100644
--- a/.beads/issues.jsonl
+++ b/.beads/issues.jsonl
@@ -101,7 +101,7 @@
 {"id":"curb-rvl","title":"Add budget enforcement to main loop","description":"## Context\nMain loop needs to stop when budget is exceeded.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 20m\n**Approach:** After each task, record usage and check budget. Exit gracefully if over.\n\n## Implementation Steps\n1. After harness completes, get token usage\n2. Call budget_record with usage\n3. Call budget_check - if returns 1, exit loop\n4. Log budget status in task_end event\n5. Final message showing total tokens used\n\n## Acceptance Criteria\n- [ ] Loop stops when budget exceeded\n- [ ] Clear message: \"Budget exceeded (used X of Y tokens)\"\n- [ ] Remaining budget logged after each task\n- [ ] Graceful exit (not error code)\n\n## Files Likely Involved\n- curb (main script)\n- lib/budget.sh\n- lib/logger.sh\n\n## Notes\nExit with 0 (success) when stopping for budget - it's expected behavior\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:47.056855-05:00","created_by":"lavallee","updated_at":"2026-01-09T23:52:40.07845-05:00","closed_at":"2026-01-09T23:52:40.07845-05:00","close_reason":"Implemented budget enforcement in main loop - extracts token usage, records to budget, checks after each iteration, logs budget status, exits gracefully when exceeded","labels":["complexity:medium","logic","model:sonnet","phase-2"],"dependencies":[{"issue_id":"curb-rvl","depends_on_id":"curb-0ub","type":"blocks","created_at":"2026-01-09T16:26:47.215943-05:00","created_by":"lavallee"},{"issue_id":"curb-rvl","depends_on_id":"curb-0hz","type":"blocks","created_at":"2026-01-09T16:26:47.262362-05:00","created_by":"lavallee"},{"issue_id":"curb-rvl","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.683682-05:00","created_by":"lavallee"}]}
 {"id":"curb-tew","title":"Extract doctor command to lib/doctor.sh","description":"## What to extract\nLines ~1177-1727 from curb:\n- cmd_doctor_help()\n- _doctor_ok(), _doctor_warn(), _doctor_info(), _doctor_fail()\n- _doctor_check_env()\n- _doctor_check_project()  \n- _doctor_check_git()\n- _doctor_check_tasks()\n- _doctor_fix()\n- cmd_doctor()\n\n## Size\n~550 lines → lib/doctor.sh\n\n## Approach\n1. Create lib/doctor.sh with all doctor-related functions\n2. Add source statement in main curb script\n3. Remove functions from main script\n4. Test: curb doctor should work identically\n\n## Acceptance Criteria\n- [ ] lib/doctor.sh created with all doctor functions\n- [ ] Main script sources lib/doctor.sh\n- [ ] curb doctor works correctly\n- [ ] tests/doctor.bats passes","status":"open","priority":2,"issue_type":"task","owner":"mlavallee@gmail.com","created_at":"2026-01-13T09:32:09.366707-05:00","created_by":"Marc Lavallee","updated_at":"2026-01-13T09:32:09.366707-05:00","labels":["refactor"]}
 {"id":"curb-tw9","title":"Update harness priority configuration","description":"## Context\nUsers should be able to configure which harness to prefer.\n\n## Implementation Hints\n\n**Recommended Model:** haiku\n**Estimated Duration:** 15m\n**Approach:** Read priority array from config, update harness_detect to respect it.\n\n## Implementation Steps\n1. Read harness.priority from config\n2. Update harness_detect() to check in priority order\n3. Document configuration in README\n4. Add example to default config\n\n## Acceptance Criteria\n- [ ] Config priority respected: [\"gemini\", \"claude\", \"codex\", \"opencode\"]\n- [ ] Falls through list until one is available\n- [ ] Documented in config schema\n\n## Files Likely Involved\n- lib/harness.sh\n- lib/config.sh\n\n## Notes\nDefault priority: claude, gemini, codex, opencode\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:27:06.070367-05:00","created_by":"lavallee","updated_at":"2026-01-10T06:07:22.35464-05:00","closed_at":"2026-01-10T06:07:22.35464-05:00","close_reason":"Implemented harness priority configuration with full test coverage, documentation, and examples. All 327 tests passing.","labels":["complexity:low","model:haiku","phase-3","setup"],"dependencies":[{"issue_id":"curb-tw9","depends_on_id":"curb-kod","type":"blocks","created_at":"2026-01-09T16:27:06.181875-05:00","created_by":"lavallee"},{"issue_id":"curb-tw9","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:35.296238-05:00","created_by":"lavallee"}]}
-{"id":"curb-ulr","title":"Refactor curb: Extract modules from main script","description":"## Problem\nThe main `curb` script is 108KB / 3250 lines, which:\n- Exceeds what LLMs can load in a single context window\n- Makes testing individual components difficult\n- Increases cognitive load for developers\n\n## Goal\nBreak the main script into focused modules under `lib/`, following the pattern already established for harness.sh, tasks.sh, git.sh, etc.\n\n## Current breakdown (lines):\n- cmd_doctor + helpers: ~550 lines\n- run_iteration: ~620 lines  \n- cmd_init: ~365 lines\n- cmd_run (parsing): ~235 lines\n- cmd_explain: ~185 lines\n- show_status/show_ready: ~170 lines\n- run_loop: ~160 lines\n- cmd_artifacts: ~120 lines\n- generate_*_prompt: ~90 lines\n\n## Target\nMain script should be \u003c1000 lines, primarily containing:\n- Argument parsing\n- Command dispatch\n- Global initialization","status":"closed","priority":2,"issue_type":"epic","assignee":"shearwater","owner":"mlavallee@gmail.com","created_at":"2026-01-13T09:31:51.04373-05:00","created_by":"Marc Lavallee","updated_at":"2026-01-13T09:59:44.443287-05:00","closed_at":"2026-01-13T09:59:44.443287-05:00","close_reason":"Completed","labels":["refactor"]}
+{"id":"curb-ulr","title":"Refactor curb: Extract modules from main script","description":"## Problem\nThe main `curb` script is 108KB / 3250 lines, which:\n- Exceeds what LLMs can load in a single context window\n- Makes testing individual components difficult\n- Increases cognitive load for developers\n\n## Goal\nBreak the main script into focused modules under `lib/`, following the pattern already established for harness.sh, tasks.sh, git.sh, etc.\n\n## Current breakdown (lines):\n- cmd_doctor + helpers: ~550 lines\n- run_iteration: ~620 lines  \n- cmd_init: ~365 lines\n- cmd_run (parsing): ~235 lines\n- cmd_explain: ~185 lines\n- show_status/show_ready: ~170 lines\n- run_loop: ~160 lines\n- cmd_artifacts: ~120 lines\n- generate_*_prompt: ~90 lines\n\n## Target\nMain script should be \u003c1000 lines, primarily containing:\n- Argument parsing\n- Command dispatch\n- Global initialization","status":"closed","priority":2,"issue_type":"epic","assignee":"shearwater","owner":"mlavallee@gmail.com","created_at":"2026-01-13T09:31:51.04373-05:00","created_by":"Marc Lavallee","updated_at":"2026-01-13T10:03:50.385459-05:00","closed_at":"2026-01-13T10:03:50.385459-05:00","close_reason":"Closed","labels":["refactor"]}
 {"id":"curb-vdw","title":"Integrate clean state check into main loop","description":"## Context\nThe main loop needs to call state checks after each harness invocation.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 20m\n**Approach:** After harness returns, call state_ensure_clean. If fails, handle based on config.\n\n## Implementation Steps\n1. Source lib/state.sh in curb\n2. After harness_invoke completes, call state_ensure_clean\n3. If returns non-zero, log error and decide: continue or abort\n4. Add --require-clean flag override\n\n## Acceptance Criteria\n- [ ] Uncommitted changes detected after harness run\n- [ ] Loop aborts if require_commit and changes exist\n- [ ] Tests run if configured\n- [ ] Behavior overridable with CLI flag\n\n## Files Likely Involved\n- curb (main script)\n- lib/state.sh\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T16:26:46.366583-05:00","created_by":"lavallee","updated_at":"2026-01-09T23:37:16.37626-05:00","closed_at":"2026-01-09T23:37:16.37626-05:00","close_reason":"Integrated clean state check into main loop. Sources lib/state.sh, calls state_ensure_clean and state_run_tests after harness invocation. Handles failures appropriately. Added --require-clean and --no-require-clean CLI flags to override config. All 263 tests pass.","labels":["complexity:medium","logic","model:sonnet","phase-2"],"dependencies":[{"issue_id":"curb-vdw","depends_on_id":"curb-g21","type":"blocks","created_at":"2026-01-09T16:26:46.475689-05:00","created_by":"lavallee"},{"issue_id":"curb-vdw","depends_on_id":"curb-0pb","type":"parent-child","created_at":"2026-01-09T19:57:34.476566-05:00","created_by":"lavallee"}]}
 {"id":"curb-wzk","title":"Extract artifacts command to lib/artifacts_cmd.sh","description":"## What to extract\nLines ~928-1047 from curb:\n- cmd_artifacts_help()\n- cmd_artifacts()\n\n## Size\n~120 lines → lib/artifacts_cmd.sh (or add to existing lib/artifacts.sh)\n\n## Notes\nlib/artifacts.sh already exists with artifact management functions.\nConsider adding cmd_artifacts* to that file.\n\n## Approach\n1. Add command functions to lib/artifacts.sh\n2. Remove functions from main script\n3. Test: curb artifacts should work\n\n## Acceptance Criteria\n- [ ] Command functions in lib/artifacts.sh\n- [ ] curb artifacts works\n- [ ] curb artifacts \u003ctask-id\u003e works\n- [ ] curb artifacts --latest works","status":"open","priority":3,"issue_type":"task","owner":"mlavallee@gmail.com","created_at":"2026-01-13T09:32:59.113789-05:00","created_by":"Marc Lavallee","updated_at":"2026-01-13T09:32:59.113789-05:00","labels":["refactor"]}
 {"id":"curb-xo3","title":"Implement hooks.sh framework","description":"## Context\nHooks allow users to extend curb behavior without modifying core code.\n\n## Implementation Hints\n\n**Recommended Model:** sonnet\n**Estimated Duration:** 30m\n**Approach:** Hook points are directories containing executable scripts. Run all scripts in order.\n\n## Implementation Steps\n1. Create lib/hooks.sh\n2. Add hooks_run(hook_name) - runs all scripts in hook_name.d/\n3. Export context variables before running\n4. Capture output and exit codes\n5. Log hook execution results\n\n## Acceptance Criteria\n- [ ] hooks_run \"pre-task\" executes scripts in pre-task.d/\n- [ ] Scripts receive context via environment vars\n- [ ] Hook failure logged but doesn't stop loop (configurable)\n- [ ] Scripts run in sorted order (01-first.sh before 02-second.sh)\n\n## Files Likely Involved\n- lib/hooks.sh (new)\n\n## Notes\nPattern: ~/.config/curb/hooks/pre-task.d/*.sh and .curb/hooks/pre-task.d/*.sh\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-09T16:27:04.480413-05:00","created_by":"lavallee","updated_at":"2026-01-10T04:45:04.462735-05:00","closed_at":"2026-01-10T04:45:04.462735-05:00","close_reason":"Implemented hooks.sh framework with 21 comprehensive tests. All acceptance criteria met.","labels":["complexity:medium","logic","model:sonnet","phase-3"],"dependencies":[{"issue_id":"curb-xo3","depends_on_id":"curb-fxr","type":"blocks","created_at":"2026-01-09T16:27:04.594492-05:00","created_by":"lavallee"},{"issue_id":"curb-xo3","depends_on_id":"curb-htk","type":"parent-child","created_at":"2026-01-09T19:57:34.837336-05:00","created_by":"lavallee"}]}
